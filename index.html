<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bill Layne Insurance - Document Generator & Resources</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <!-- PDF.js for PDF viewing (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  
  <!-- Authentication Check -->
  <script>
    // Check if user is authenticated
    if (sessionStorage.getItem('authenticated') !== 'true') {
      // Redirect to login page
      window.location.href = 'login.html';
    }
  </script>
</head>
<body>
  <!-- Navigation Tabs -->
  <div class="navigation-tabs">
    <button class="tab-button active" onclick="showTab('dashboard')">Dashboard</button>
    <button class="tab-button" onclick="showTab('generator')">Document Generator</button>
    <button class="tab-button" onclick="showTab('templates')">PDF Templates</button>
    <button class="tab-button" onclick="showTab('resources')">Resources</button>
    <button class="tab-button" onclick="showTab('prompts')">Prompt Manager</button>
    <button class="tab-button" onclick="showTab('snl')">SNL</button>
    <button class="tab-button" onclick="showTab('cancellation')">Cancellation</button>
    <button class="tab-button" onclick="logout()" style="float: right; background: linear-gradient(180deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226;">Logout</button>
  </div>

  <!-- Dashboard Tab (default active) -->
  <div id="dashboard-tab" class="tab-content active">
    <style>
      /* Dashboard specific styles */
      #dashboard-tab .dashboard-container{
        display:grid;
        grid-template-columns:1fr;
        gap:20px;
        max-width:1400px;
        margin:0 auto;
        padding:20px;
      }

      #dashboard-tab .dashboard-header{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 2px 4px rgba(0,0,0,0.1);
        padding:16px 20px;
        display:flex;
        align-items:center;
        justify-content:space-between;
        border:1px solid #e2e8f0;
      }

      #dashboard-tab .brand{
        display:flex;
        align-items:center;
        gap:12px;
      }

      #dashboard-tab .brand-logo{
        width:40px;
        height:40px;
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        border-radius:10px;
        display:flex;
        align-items:center;
        justify-content:center;
        color:white;
        font-weight:700;
        font-size:18px;
      }

      #dashboard-tab .main-content{
        display:grid;
        grid-template-columns:1fr 380px;
        gap:20px;
      }

      @media (max-width:1024px){
        #dashboard-tab .main-content{
          grid-template-columns:1fr;
        }
      }

      #dashboard-tab .search-card{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 4px 6px rgba(0,0,0,0.1);
        padding:24px;
        border:1px solid #e2e8f0;
        position:relative;
      }

      #dashboard-tab .search-card::before{
        content:'';
        position:absolute;
        top:0;
        left:0;
        right:0;
        height:4px;
        background:linear-gradient(90deg, #0f4c75, #3282b8, #0db4f3);
      }

      #dashboard-tab .mode-selector{
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
        gap:8px;
        margin-bottom:20px;
      }

      #dashboard-tab .mode-btn{
        border:2px solid #e2e8f0;
        background:#ffffff;
        color:#64748b;
        border-radius:8px;
        padding:12px 16px;
        font-weight:600;
        cursor:pointer;
        transition:all 0.2s;
        display:flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        font-size:14px;
      }

      #dashboard-tab .mode-btn:hover{
        transform:translateY(-2px);
        box-shadow:0 4px 6px rgba(0,0,0,0.1);
        border-color:#3282b8;
      }

      #dashboard-tab .mode-btn.active{
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        color:white;
        border-color:transparent;
      }

      #dashboard-tab .search-input{
        width:100%;
        border:2px solid #e2e8f0;
        background:#f8fafc;
        border-radius:8px;
        padding:14px 16px;
        font-size:15px;
        outline:none;
        transition:all 0.2s;
        margin-bottom:16px;
      }

      #dashboard-tab .search-input:focus{
        border-color:#0f4c75;
        background:#ffffff;
      }

      #dashboard-tab .search-actions{
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
        gap:10px;
      }

      #dashboard-tab .btn{
        border:none;
        cursor:pointer;
        font-weight:600;
        padding:12px 20px;
        border-radius:8px;
        transition:all 0.2s;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        font-size:14px;
      }

      #dashboard-tab .btn-primary{
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        color:white;
      }

      #dashboard-tab .btn-secondary{
        background:#f8fafc;
        color:#1e293b;
        border:2px solid #e2e8f0;
      }

      #dashboard-tab .stats-row{
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
        gap:12px;
        margin-top:20px;
        padding-top:20px;
        border-top:1px solid #e2e8f0;
      }

      #dashboard-tab .stat-card{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:12px;
        text-align:center;
      }

      #dashboard-tab .stat-value{
        font-size:24px;
        font-weight:700;
        color:#0f4c75;
      }

      #dashboard-tab .stat-label{
        font-size:12px;
        color:#64748b;
        text-transform:uppercase;
        letter-spacing:0.5px;
      }

      #dashboard-tab .portals-card{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 2px 4px rgba(0,0,0,0.1);
        padding:20px;
        border:1px solid #e2e8f0;
      }

      #dashboard-tab .portals-grid{
        display:grid;
        grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
        gap:12px;
      }

      #dashboard-tab .portal-tile{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:14px;
        cursor:pointer;
        transition:all 0.2s;
      }

      #dashboard-tab .portal-tile:hover{
        transform:translateY(-3px);
        box-shadow:0 4px 6px rgba(0,0,0,0.1);
        border-color:#3282b8;
      }

      #dashboard-tab .quick-panel{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 2px 4px rgba(0,0,0,0.1);
        padding:20px;
        border:1px solid #e2e8f0;
      }

      #dashboard-tab .quick-btn{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:12px 16px;
        cursor:pointer;
        transition:all 0.2s;
        display:flex;
        align-items:center;
        gap:12px;
        text-align:left;
        width:100%;
        margin-bottom:10px;
      }

      #dashboard-tab .quick-btn:hover{
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        border-color:transparent;
        transform:translateX(4px);
      }

      #dashboard-tab .quick-btn:hover * {
        color:white !important;
      }

      #dashboard-tab .quick-btn-title {
        color: #1e293b;
      }

      #dashboard-tab .quick-btn-desc {
        color: #64748b;
      }

      #dashboard-tab .favorites-grid{
        display:grid;
        gap:10px;
      }

      #dashboard-tab .favorite-item{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:12px;
        display:flex;
        align-items:center;
        gap:12px;
        cursor:pointer;
        transition:all 0.2s;
      }

      #dashboard-tab .favorite-item:hover{
        background:#ffffff;
        border-color:#3282b8;
        padding-left:16px;
      }
    </style>

    <div class="dashboard-container">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <div class="brand">
          <div class="brand-logo">BL</div>
          <div class="brand-text">
            <div style="font-size:18px;font-weight:700;color:#1e293b">Customer Matrix Pro</div>
            <div style="font-size:12px;color:#64748b">Bill Layne Insurance Command Center</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
          <button class="icon-btn" id="dash-toolsToggle" title="AI Tools" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:8px 12px;cursor:pointer;transition:all 0.2s;font-size:12px;font-weight:600;display:inline-flex;align-items:center;gap:6px">
            <i class="fas fa-robot"></i> AI Tools
          </button>
          <div style="display:flex;align-items:center;gap:8px;padding:6px 12px;background:#f8fafc;border-radius:999px;border:1px solid #e2e8f0">
            <div style="width:8px;height:8px;border-radius:50%;background:#10b981;animation:pulse 2s infinite"></div>
            <span style="font-size:12px;font-weight:600">Systems Online</span>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="main-content">
        <!-- Primary Section -->
        <div class="primary-section">
          <!-- Enhanced Search Hub -->
          <div class="search-card">
            <div style="margin-bottom:20px">
              <h2 style="font-size:20px;font-weight:700;margin:0 0 8px 0;display:flex;align-items:center;gap:10px">
                <i class="fas fa-search"></i>
                Unified Customer Search
                <span style="background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px">Pro</span>
              </h2>
              <div style="font-size:13px;color:#64748b">
                Quick access: Press <kbd style="background:#f8fafc;border:1px solid #e2e8f0;padding:2px 6px;border-radius:4px;font-family:monospace;font-size:11px">/</kbd> to focus search
              </div>
            </div>

            <!-- Mode Selector -->
            <div class="mode-selector" id="dash-modeBar">
              <button class="mode-btn active" data-mode="agency">
                <i class="fas fa-shield-alt"></i> Agency Matrix
              </button>
              <button class="mode-btn" data-mode="web">
                <i class="fab fa-google"></i> Web Search
              </button>
              <button class="mode-btn" data-mode="realestate">
                <i class="fas fa-home"></i> Real Estate
              </button>
              <button class="mode-btn" data-mode="people">
                <i class="fas fa-user"></i> People
              </button>
              <button class="mode-btn" data-mode="onedrive">
                <i class="fas fa-cloud"></i> OneDrive
              </button>
            </div>

            <!-- Search Input -->
            <input id="dash-search" class="search-input" placeholder="Search Agency Matrix by name or address…" autocomplete="off"/>

            <!-- Action Buttons -->
            <div class="search-actions">
              <button class="btn btn-primary" id="dash-goBtn">
                <i class="fas fa-search"></i> Search
              </button>
              <button class="btn btn-secondary" id="dash-openAM">
                <i class="fas fa-external-link-alt"></i> Open Matrix
              </button>
              <button class="btn btn-secondary" id="dash-addCustomer">
                <i class="fas fa-user-plus"></i> Add Customer
              </button>
              <button class="btn btn-secondary" id="dash-taxBtn" style="display:none">
                <i class="fas fa-map-pin"></i> Tax GIS
              </button>
            </div>

            <!-- Quick Stats -->
            <div class="stats-row">
              <div class="stat-card">
                <div class="stat-value" id="dash-searchCount">0</div>
                <div class="stat-label">Searches Today</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">7</div>
                <div class="stat-label">Active Portals</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dash-favoriteCount">0</div>
                <div class="stat-label">Favorites</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">--</div>
                <div class="stat-label">Last Sync</div>
              </div>
            </div>
          </div>

          <!-- Insurance Company Portals -->
          <div class="portals-card">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
              <h3 style="font-size:16px;font-weight:700;margin:0">
                <i class="fas fa-building"></i> Insurance Company Portals
              </h3>
            </div>
            <div class="portals-grid" id="dash-portalGrid">
              <!-- Portals will be dynamically added here -->
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Quick Actions - Claude AI Projects -->
          <div class="quick-panel">
            <h3 style="font-size:16px;font-weight:700;margin:0 0 16px 0">
              <i class="fas fa-robot"></i> Quick AI Actions
              <span style="font-size:10px;background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;padding:2px 6px;border-radius:999px;margin-left:8px">CLAUDE</span>
            </h3>
            <div class="quick-actions">
              <button class="quick-btn" onclick="window.open('https://claude.ai/project/01993948-a57c-7166-ae81-c547e60fe8fa','_blank')">
                <div style="width:36px;height:36px;background:linear-gradient(135deg, #dc2626, #ef4444);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0">
                  <i class="fas fa-file-pdf"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Create PDF Document</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">Claude PDF generator project</div>
                </div>
              </button>
              <button class="quick-btn" onclick="window.open('https://claude.ai/project/0198f624-8a25-73be-a9e1-98389bc44b2c','_blank')">
                <div style="width:36px;height:36px;background:linear-gradient(135deg, #059669, #10b981);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0">
                  <i class="fas fa-home"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Home Address Research</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">Property & address analysis</div>
                </div>
              </button>
              <button class="quick-btn" onclick="window.open('https://claude.ai/project/0197c35a-7c70-72f7-8d5c-83df3286f0a4','_blank')">
                <div style="width:36px;height:36px;background:linear-gradient(135deg, #7c3aed, #a855f7);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0">
                  <i class="fas fa-car"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Auto Quote Template</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">Generate auto insurance quotes</div>
                </div>
              </button>
              <button class="quick-btn" onclick="window.open('https://agents.agencymatrix.com/#/reports','_blank')">
                <div style="width:36px;height:36px;background:#e2e8f0;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#0f4c75;flex-shrink:0">
                  <i class="fas fa-chart-bar"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Reports</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">View analytics</div>
                </div>
              </button>
            </div>
          </div>

          <!-- Favorites -->
          <div class="quick-panel">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
              <h3 style="font-size:16px;font-weight:700;margin:0">
                <i class="fas fa-star"></i> Quick Access Favorites
              </h3>
              <div style="display:flex;gap:8px">
                <button class="icon-btn" id="dash-addFav" title="Add Favorite" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s;font-size:11px;display:inline-flex;align-items:center;gap:4px">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="icon-btn" id="dash-exportFavs" title="Export" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s;font-size:11px;display:inline-flex;align-items:center;gap:4px">
                  <i class="fas fa-download"></i>
                </button>
                <button class="icon-btn" id="dash-importFavs" title="Import" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s;font-size:11px;display:inline-flex;align-items:center;gap:4px">
                  <i class="fas fa-upload"></i>
                </button>
              </div>
            </div>
            <div class="favorites-grid" id="dash-favGrid">
              <div style="text-align:center;padding:20px;color:#64748b" id="dash-no-favs">
                No favorites yet. Add your frequently accessed links.
              </div>
            </div>
            <input type="file" id="dash-favFile" accept=".json" style="display:none"/>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Dashboard specific JavaScript
      (function(){
        // Dashboard search mode handling
        let dashSearchMode = "agency";
        const dashModeMeta = {
          agency: { placeholder:"Search Agency Matrix by name or address…", showTax:false },
          web: { placeholder:"Search the web…", showTax:false },
          realestate: { placeholder:"Enter full address (City, NC)…", showTax:true },
          people: { placeholder:"Enter name, phone, or address…", showTax:false },
          onedrive: { placeholder:"Search OneDrive files…", showTax:false }
        };

        function setDashMode(mode){
          dashSearchMode = mode;
          document.querySelectorAll("#dash-modeBar button").forEach(b=>{
            b.classList.toggle("active", b.dataset.mode===mode);
          });
          const q = document.getElementById("dash-search");
          q.placeholder = dashModeMeta[mode].placeholder;
          document.getElementById("dash-taxBtn").style.display = dashModeMeta[mode].showTax ? "" : "none";
          q.focus();
        }

        document.querySelectorAll("#dash-modeBar button").forEach(btn=>
          btn.addEventListener("click", ()=>setDashMode(btn.dataset.mode))
        );

        // Dashboard search function
        function dashSearch(){
          const val = document.getElementById("dash-search").value.trim();
          if(!val){
            alert("Please enter a search term");
            return;
          }

          // Update search count
          let searchesToday = parseInt(localStorage.getItem("searchesToday")||"0") + 1;
          localStorage.setItem("searchesToday", searchesToday.toString());
          document.getElementById("dash-searchCount").textContent = searchesToday;

          if(dashSearchMode==="agency"){
            const isAddress = /\d+/.test(val) || /(street|st|ave|avenue|road|rd|drive|dr|lane|ln|blvd|boulevard|court|ct|circle|cir|way|wy)/i.test(val);
            const selection = isAddress ? "Address" : "Name";
            const url = `https://agents.agencymatrix.com/#/customer/search?selection=${selection}&query=${encodeURIComponent(val)}`;
            window.open(url, "_blank");
            document.getElementById("dash-search").value="";
            return;
          }
          if(dashSearchMode==="web"){
            window.open(`https://www.google.com/search?q=${encodeURIComponent(val)}`, "_blank");
            return;
          }
          if(dashSearchMode==="realestate"){
            window.open(`https://www.zillow.com/homes/${encodeURIComponent(val)}_rb/`, "_blank");
            return;
          }
          if(dashSearchMode==="people"){
            window.open(`https://www.truepeoplesearch.com/results?name=${encodeURIComponent(val)}`, "_blank");
            return;
          }
          if(dashSearchMode==="onedrive"){
            window.open(`https://onedrive.live.com/?id=root&qt=search&q=${encodeURIComponent(val)}&scope=drive`, "_blank");
            return;
          }
        }

        document.getElementById("dash-goBtn").addEventListener("click", dashSearch);
        document.getElementById("dash-search").addEventListener("keydown", e=>{
          if(e.key==="Enter") dashSearch();
        });

        // Quick buttons
        document.getElementById("dash-openAM").addEventListener("click", ()=>
          window.open("https://agents.agencymatrix.com/#/", "_blank")
        );
        document.getElementById("dash-addCustomer").addEventListener("click", ()=>
          window.open("https://agents.agencymatrix.com/customerEdit.php?id=0", "_blank")
        );

        // Keyboard shortcut for search focus
        document.addEventListener("keydown", (e)=>{
          if(e.key==="/" && !e.ctrlKey && !e.metaKey && !e.altKey && document.getElementById("dashboard-tab").style.display !== "none"){
            e.preventDefault();
            document.getElementById("dash-search").focus();
            document.getElementById("dash-search").select();
          }
        });

        // Render portals
        function renderDashPortals(){
          const defaultPortals = [
            { name:"Agency Matrix", url:"https://agents.agencymatrix.com/#/", icon:"fas fa-shield-alt", description:"Primary agent portal" },
            { name:"Nationwide", url:"https://agentcenter.nationwide.com/home", icon:"fas fa-flag-usa", description:"Agent center portal" },
            { name:"National General", url:"https://natgenagency.com/MainMenu.aspx", icon:"fas fa-globe", description:"Agency portal" },
            { name:"Progressive", url:"https://www.foragentsonly.com/home/?Welcome=400", icon:"fas fa-chart-line", description:"For agents only portal" },
            { name:"Foremost", url:"https://www.foremostagent.com/ia/portal/login", icon:"fas fa-house-user", description:"Agent portal login" },
            { name:"Alamance", url:"https://alamance.britecore.com/agent/misc/ko_dashboard", icon:"fas fa-shield-alt", description:"BriteCore dashboard" },
            { name:"NC Grange", url:"https://ncgm.com/", icon:"fas fa-leaf", description:"NC Grange portal" }
          ];

          const grid = document.getElementById("dash-portalGrid");
          grid.innerHTML = defaultPortals.map(p=>`
            <div class="portal-tile" onclick="window.open('${p.url}','_blank')" title="Open ${p.name}">
              <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
                <div style="width:32px;height:32px;background:linear-gradient(135deg, #0f4c75, #3282b8);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-size:14px">
                  <i class="${p.icon}"></i>
                </div>
              </div>
              <h4 style="font-weight:600;font-size:14px;color:#1e293b;margin:0">${p.name}</h4>
              <p style="font-size:12px;color:#64748b;margin:0;line-height:1.4">${p.description}</p>
            </div>
          `).join("");
        }

        // Initialize dashboard
        renderDashPortals();

        // Update counts
        let searchesToday = parseInt(localStorage.getItem("searchesToday")||"0");
        document.getElementById("dash-searchCount").textContent = searchesToday;

        let favorites = JSON.parse(localStorage.getItem("matrixFavorites_v2")||"[]");
        document.getElementById("dash-favoriteCount").textContent = favorites.length;

        // Reset search count daily
        const today = new Date().toDateString();
        if(localStorage.getItem("searchDate") !== today){
          localStorage.setItem("searchDate", today);
          localStorage.setItem("searchesToday", "0");
          document.getElementById("dash-searchCount").textContent = "0";
        }

        // Favorites Management
        function renderDashFavorites(){
          const grid = document.getElementById("dash-favGrid");
          const favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          document.getElementById("dash-favoriteCount").textContent = favs.length;

          if(favs.length === 0){
            grid.innerHTML = `<div style="text-align:center;padding:20px;color:#64748b">
              No favorites yet. Add your frequently accessed links.
            </div>`;
            return;
          }

          grid.innerHTML = favs.map(f=>`
            <div class="favorite-item" onclick="window.open('${f.url}','_blank')" title="Open ${f.name}" style="position:relative">
              <div style="width:30px;height:30px;background:linear-gradient(135deg, #0f4c75, #3282b8);border-radius:6px;display:flex;align-items:center;justify-content:center;color:white;font-size:12px;flex-shrink:0">
                <i class="fas fa-star"></i>
              </div>
              <div style="flex:1;min-width:0">
                <div style="font-weight:600;font-size:13px;margin:0 0 2px 0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${f.name}</div>
                <div style="font-size:11px;color:#64748b;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${f.description||f.url}</div>
              </div>
              <button onclick="removeDashFavorite('${f.id}');event.stopPropagation();" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:#64748b;cursor:pointer;padding:4px;opacity:0;transition:all 0.2s" onmouseover="this.style.opacity='1';this.style.color='#ef4444'" onmouseout="this.style.opacity='0'">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `).join("");

          // Add hover effect to show delete button
          grid.querySelectorAll('.favorite-item').forEach(item => {
            item.addEventListener('mouseenter', () => {
              const btn = item.querySelector('button');
              if(btn) btn.style.opacity = '1';
            });
            item.addEventListener('mouseleave', () => {
              const btn = item.querySelector('button');
              if(btn) btn.style.opacity = '0';
            });
          });
        }

        function removeDashFavorite(id){
          let favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          favs = favs.filter(f=>f.id!==id);
          localStorage.setItem("dashFavorites", JSON.stringify(favs));
          renderDashFavorites();
        }

        // Add favorite button handler
        document.getElementById("dash-addFav").addEventListener("click", ()=>{
          const name = prompt("Favorite name:");
          if(!name) return;
          const url = prompt("URL:");
          if(!url) return;
          const desc = prompt("Description (optional):") || "";
          const cleanUrl = url.startsWith("http") ? url : `https://${url}`;
          try{ new URL(cleanUrl); }catch{ alert("Invalid URL"); return; }
          const fav = {
            id: String(Date.now()),
            name: name.trim(),
            url: cleanUrl.trim(),
            description: desc.trim()
          };
          let favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          favs.push(fav);
          localStorage.setItem("dashFavorites", JSON.stringify(favs));
          renderDashFavorites();
        });

        // Export favorites
        document.getElementById("dash-exportFavs").addEventListener("click", ()=>{
          const favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          const searchesToday = localStorage.getItem("searchesToday")||"0";
          const data = {
            favorites: favs,
            searchesToday: searchesToday,
            exportDate: new Date().toISOString(),
            version: "1.0"
          };
          const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `dashboard-favorites-${new Date().toISOString().split("T")[0]}.json`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        });

        // Import favorites
        document.getElementById("dash-importFavs").addEventListener("click", ()=>
          document.getElementById("dash-favFile").click()
        );

        document.getElementById("dash-favFile").addEventListener("change", (e)=>{
          const file = e.target.files[0];
          if(!file) return;
          const reader = new FileReader();
          reader.onload = ()=>{
            try{
              const data = JSON.parse(reader.result);
              if(!data.favorites || !Array.isArray(data.favorites)){
                throw new Error("Invalid file format");
              }
              const replace = confirm("Replace existing favorites?\nOK = Replace, Cancel = Merge");
              let favs = replace ? [] : JSON.parse(localStorage.getItem("dashFavorites")||"[]");
              if(!replace){
                const urls = new Set(favs.map(f=>f.url));
                const newFavs = data.favorites.filter(f=>!urls.has(f.url));
                favs = [...favs, ...newFavs];
              } else {
                favs = data.favorites;
              }
              localStorage.setItem("dashFavorites", JSON.stringify(favs));
              renderDashFavorites();
              alert("Favorites imported successfully!");
            }catch(err){
              alert("Failed to import file: " + err.message);
            }
            e.target.value = "";
          };
          reader.readAsText(file);
        });

        // AI Tools Panel
        document.getElementById("dash-toolsToggle").addEventListener("click", function(){
          // Create AI tools panel if it doesn't exist
          let panel = document.getElementById("dash-aiToolsPanel");
          if(!panel){
            panel = document.createElement("div");
            panel.id = "dash-aiToolsPanel";
            panel.style.cssText = `
              position:fixed;
              right:20px;
              top:80px;
              width:400px;
              max-height:80vh;
              background:#ffffff;
              border-radius:12px;
              box-shadow:0 10px 25px rgba(0,0,0,0.2);
              border:1px solid #e2e8f0;
              padding:20px;
              z-index:9999;
              overflow-y:auto;
              display:none;
            `;
            panel.innerHTML = `
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                <h3 style="font-size:16px;font-weight:700;margin:0">
                  <i class="fas fa-robot"></i> AI Insurance Assistant
                </h3>
                <button onclick="document.getElementById('dash-aiToolsPanel').style.display='none'" style="background:transparent;border:none;cursor:pointer;font-size:18px;color:#64748b">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <div style="margin-bottom:16px">
                <label style="font-size:12px;color:#64748b;font-weight:600;display:block;margin-bottom:8px">QUICK TEMPLATES</label>
                <div style="display:grid;gap:6px">
                  <button class="template-btn" onclick="setAITemplate('quote')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-file-invoice-dollar"></i> Generate Quote Comparison
                  </button>
                  <button class="template-btn" onclick="setAITemplate('coverage')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-shield-alt"></i> Explain Coverage
                  </button>
                  <button class="template-btn" onclick="setAITemplate('claim')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-file-contract"></i> Draft Claim Letter
                  </button>
                  <button class="template-btn" onclick="setAITemplate('email')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-envelope"></i> Customer Email
                  </button>
                </div>
              </div>

              <textarea id="dash-aiPrompt" style="width:100%;border:1px solid #e2e8f0;background:#f8fafc;border-radius:8px;padding:12px;font-size:14px;min-height:100px;resize:vertical;font-family:inherit;margin-bottom:12px" placeholder="Type your custom prompt or select a template above..."></textarea>

              <div style="display:grid;gap:8px">
                <button onclick="openAIWithPrompt()" style="background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;border:none;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">
                  <i class="fas fa-robot"></i> Open Claude with Prompt
                </button>
                <button onclick="copyAIPrompt()" style="background:#f8fafc;color:#1e293b;border:2px solid #e2e8f0;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">
                  <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
              </div>
            `;
            document.body.appendChild(panel);
          }

          // Toggle panel visibility
          panel.style.display = panel.style.display === "none" ? "block" : "none";
        });

        // AI Template functions
        window.setAITemplate = function(type){
          const templates = {
            quote: "I need to create a comprehensive insurance quote comparison for a customer. Please help me analyze and present the following options:\n\nCustomer Details:\n[Enter customer name, age, location]\n\nCoverage Needed:\n[Auto/Home/Life/etc.]\n\nCarriers to Compare:\n- Nationwide\n- Progressive\n- [Other carriers]\n\nPlease provide a clear comparison table with coverage limits, deductibles, and annual premiums. Include pros/cons for each option and a recommendation based on the customer's needs.\n\nAgency: Bill Layne Insurance, Elkin NC",
            coverage: "Please explain the following insurance coverage in simple, customer-friendly terms:\n\nCoverage Type: [Enter coverage type]\n\nCustomer Situation: [Brief description]\n\nInclude:\n1. What this coverage protects\n2. Common scenarios when it's used\n3. What's NOT covered\n4. Typical cost factors\n5. NC-specific requirements\n\nAgency: Bill Layne Insurance, Elkin NC",
            claim: "Help me draft a professional claim letter/email:\n\nClaim Type: [Auto accident/Property damage/etc.]\n\nCarrier: [Insurance company name]\n\nSituation:\n[Describe the incident]\n\nDesired Outcome:\n[What resolution we're seeking]\n\nTone: Professional but firm, representing Bill Layne Insurance Agency.",
            email: "Draft a professional email to a customer:\n\nPurpose: [Renewal reminder/Policy change/Follow-up/etc.]\n\nCustomer: [Name and brief context]\n\nKey Points to Cover:\n[List main points]\n\nBill Layne Insurance Agency\n336-835-1993\nSave@BillLayneInsurance.com"
          };
          const textarea = document.getElementById("dash-aiPrompt");
          if(textarea && templates[type]){
            textarea.value = templates[type];
          }
        };

        window.openAIWithPrompt = function(){
          const prompt = document.getElementById("dash-aiPrompt").value.trim();
          if(!prompt){
            alert("Please enter or select a prompt");
            return;
          }
          navigator.clipboard.writeText(prompt).then(()=>{
            window.open("https://claude.ai/new", "_blank");
          }).catch(()=>{
            const ta = document.createElement("textarea");
            ta.value = prompt;
            ta.style.position = "fixed";
            ta.style.opacity = "0";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            window.open("https://claude.ai/new", "_blank");
          });
        };

        window.copyAIPrompt = function(){
          const prompt = document.getElementById("dash-aiPrompt").value.trim();
          if(!prompt){
            alert("Nothing to copy");
            return;
          }
          navigator.clipboard.writeText(prompt).then(()=>{
            alert("Prompt copied to clipboard!");
          }).catch(()=>{
            const ta = document.createElement("textarea");
            ta.value = prompt;
            ta.style.position = "fixed";
            ta.style.opacity = "0";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            alert("Prompt copied to clipboard!");
          });
        };

        window.removeDashFavorite = removeDashFavorite;

        // Initialize favorites
        renderDashFavorites();

        // Tax GIS Modal and Functionality
        const countyTax = {
          "mecklenburg":{name:"Mecklenburg County",url:"https://property.spatialest.com/nc/mecklenburg/"},
          "wake":{name:"Wake County",url:"https://services.wake.gov/realestate/"},
          "guilford":{name:"Guilford County",url:"https://guilford.county-taxes.com/public/search/property_address"},
          "forsyth":{name:"Forsyth County",url:"https://gis.forsyth.cc/parcelviewer/"},
          "iredell":{name:"Iredell County",url:"https://taxweb.iredellcountync.gov/PublicAccess/RealEstate.aspx"},
          "cabarrus":{name:"Cabarrus County",url:"https://tax.cabarruscounty.us/"},
          "rowan":{name:"Rowan County",url:"https://rowan.county-taxes.com/public/search/property_address"},
          "union":{name:"Union County",url:"https://www.co.union.nc.us/departments/tax_administration/real_estate_search.php"},
          "gaston":{name:"Gaston County",url:"https://gaston.county-taxes.com/public/search/property_address"},
          "davidson":{name:"Davidson County",url:"https://davidson.county-taxes.com/public/search/property_address"},
          "surry":{name:"Surry County",url:"http://www.gis.surryinfo.net/"},
          "yadkin":{name:"Yadkin County",url:"https://www.bttaxpayerportal.com/ITSPublicYK/"},
          "wilkes":{name:"Wilkes County",url:"https://wilkes.county-taxes.com/public/search/property_address"},
          "stokes":{name:"Stokes County",url:"https://stokes.county-taxes.com/public/search/property_address"},
          "lee":{name:"Lee County",url:"https://taxaccess.leecountync.gov/pt/search/commonsearch.aspx?mode=realprop"},
          "chatham":{name:"Chatham County",url:"https://chatham.county-taxes.com/public/search/property_address"},
          "moore":{name:"Moore County",url:"https://moore.county-taxes.com/public/search/property_address"},
          "harnett":{name:"Harnett County",url:"https://harnett.county-taxes.com/public/search/property_address"}
        };

        const cityToCounty = {
          "charlotte":"mecklenburg","raleigh":"wake","greensboro":"guilford","winston-salem":"forsyth",
          "statesville":"iredell","mooresville":"iredell","concord":"cabarrus","kannapolis":"cabarrus",
          "salisbury":"rowan","monroe":"union","gastonia":"gaston","lexington":"davidson",
          "mount airy":"surry","pilot mountain":"surry","dobson":"surry","elkin":"surry",
          "yadkinville":"yadkin","boonville":"yadkin","east bend":"yadkin","jonesville":"yadkin",
          "wilkesboro":"wilkes","north wilkesboro":"wilkes","danbury":"stokes","walnut cove":"stokes","king":"stokes"
        };

        function guessCounty(address){
          const s = address.toLowerCase();
          for(const [city,county] of Object.entries(cityToCounty)){
            if(s.includes(city)) return county;
          }
          for(const c of Object.keys(countyTax)){
            if(s.includes(c+" county")||s.includes(c)) return c;
          }
          return null;
        }

        // Create Tax Modal if it doesn't exist
        if(!document.getElementById("dash-taxModal")){
          const modal = document.createElement("div");
          modal.id = "dash-taxModal";
          modal.style.cssText = `
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.5);
            display:none;
            align-items:center;
            justify-content:center;
            z-index:9998;
            backdrop-filter:blur(4px);
          `;
          modal.innerHTML = `
            <div style="background:#ffffff;border-radius:12px;box-shadow:0 20px 25px rgba(0,0,0,0.2);padding:24px;max-width:500px;width:90%;animation:modalIn 0.3s ease">
              <h3 style="font-size:18px;font-weight:700;margin:0 0 16px 0">Tax GIS Search</h3>
              <div id="dash-taxBody" style="margin-bottom:20px;color:#64748b"></div>
              <div style="display:flex;gap:10px;justify-content:flex-end">
                <button class="btn btn-primary" id="dash-openCounty" style="background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;border:none;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">
                  <i class="fas fa-external-link-alt"></i> Open County Site
                </button>
                <button class="btn btn-secondary" id="dash-closeTax" style="background:#f8fafc;color:#1e293b;border:2px solid #e2e8f0;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">Cancel</button>
              </div>
            </div>
          `;
          document.body.appendChild(modal);

          // Add modal close handlers
          document.getElementById("dash-closeTax").addEventListener("click", ()=>{
            document.getElementById("dash-taxModal").style.display = "none";
          });

          document.getElementById("dash-taxModal").addEventListener("click", (e)=>{
            if(e.target.id === "dash-taxModal"){
              document.getElementById("dash-taxModal").style.display = "none";
            }
          });
        }

        // Tax Button Handler
        document.getElementById("dash-taxBtn").addEventListener("click", ()=>{
          const addr = document.getElementById("dash-search").value.trim();
          if(!addr){
            alert("Enter an address first");
            document.getElementById("dash-search").focus();
            return;
          }
          const c = guessCounty(addr);
          const body = document.getElementById("dash-taxBody");
          let info, url;
          if(c && countyTax[c]){
            info = `<strong>Address:</strong> ${addr}<br><strong>County:</strong> ${countyTax[c].name}`;
            url = countyTax[c].url;
          } else {
            info = `Could not determine county from:<br><em>${addr}</em><br><br>Please ensure the address includes the city name or county.`;
            url = null;
          }
          body.innerHTML = info;
          const openBtn = document.getElementById("dash-openCounty");
          openBtn.disabled = !url;
          openBtn.onclick = ()=>{ if(url) window.open(url, "_blank"); };
          document.getElementById("dash-taxModal").style.display = "flex";
        });
      })();
    </script>
  </div>

  <!-- Document Generator Tab (main content) -->
  <div id="generator-tab" class="tab-content" style="display: none;">
    <div class="form-container">
      <h2>Insurance Document Generator - Multi-Template</h2>
      
      <!-- Template Selector -->
      <div class="template-selector">
        <label for="documentType">Select Document Type:</label>
        <select id="documentType" onchange="switchTemplate()">
          <option value="closing">Home Closing Package (Declaration & Invoice)</option>
          <option value="binder">Binder Letter</option>
          <option value="mortgagee-change">Mortgagee Change Letter</option>
          <option value="cancellation">Cancellation Notice</option>
          <option value="renewal">Renewal Notice</option>
          <option value="coverage-change">Coverage Change Confirmation</option>
          <option value="payment-receipt">Payment Receipt</option>
          <option value="claim-info">Claim Information Sheet</option>
          <option value="dl123">DL-123 Driver License Insurance Certification</option>
          <option value="underwriting">Underwriting Email Template</option>
          <option value="letterhead">Professional Letterhead</option>
          <option value="envelope">Envelope</option>
          <option value="auto-id-card">Auto ID Card Maker</option>
        </select>
      </div>

      <!-- Template Description -->
      <div id="templateDescription" class="template-description">
        Select a document type above to begin. Each template is designed for specific insurance documentation needs.
      </div>
      
      <!-- Save/Load buttons -->
      <div class="no-print" style="text-align: right; margin-bottom: 20px;">
        <button type="button" onclick="saveFormData()" class="save-btn">💾 Save Form Data</button>
        <button type="button" onclick="loadFormData()" class="load-btn">📂 Load Saved Data</button>
        <button type="button" onclick="clearForm()" class="clear-btn">🗑️ Clear Form</button>
      </div>

      <!-- Common Fields Section (shown for all templates) -->
      <div class="form-section active" id="commonFields">
        <div class="section-title">Agency & Company Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insurance Company</label>
            <select id="insuranceCompany" onchange="updateAgencyCodeDL123()">
              <option value="">Select Company</option>
              <option value="Nationwide">Nationwide</option>
              <option value="Progressive">Progressive</option>
              <option value="National General">National General</option>
              <option value="Alamance">Alamance</option>
              <option value="Travelers">Travelers</option>
              <option value="NC Grange Mutual">NC Grange Mutual</option>
              <option value="Universal Property">Universal Property</option>
              <option value="Dairyland">Dairyland</option>
              <option value="Allstate">Allstate</option>
              <option value="Foremost">Foremost</option>
              <option value="JSA">JSA</option>
              <option value="NCJUA">NCJUA</option>
            </select>
          </div>
          <div class="form-group">
            <label>Policy Number</label>
            <input type="text" id="policyNumber" />
          </div>
        </div>
      </div>

      <!-- Insured Information (most templates) -->
      <div class="form-section" id="insuredSection">
        <div class="section-title">Insured Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Policyholder Name</label>
            <input type="text" id="policyholderName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Address Line 1</label>
            <input type="text" id="addressLine1" />
          </div>
          <div class="form-group">
            <label>Address Line 2</label>
            <input type="text" id="addressLine2" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="city" />
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="state" value="NC" />
          </div>
          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" id="zipCode" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" id="phoneNumber" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="emailAddress" />
          </div>
        </div>
      </div>

      <!-- Policy Dates Section -->
      <div class="form-section" id="policyDatesSection">
        <div class="section-title">Policy Dates</div>
        <div class="form-row">
          <div class="form-group">
            <label>Effective Date</label>
            <input type="date" id="effectiveDate" onchange="updateExpirationDate()" />
          </div>
          <div class="form-group">
            <label>Expiration Date</label>
            <input type="date" id="expirationDate" />
          </div>
        </div>
      </div>

      <!-- Coverage Information (for closing, binder, renewal, coverage change) -->
      <div class="form-section" id="coverageSection">
        <div class="section-title">Coverage Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Coverage A - Dwelling</label>
            <input type="number" id="coverageA" min="0" step="1000" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Deductible</label>
            <input type="number" id="deductible" min="0" step="100" />
          </div>
          <div class="form-group">
            <label>Annual Premium</label>
            <input type="number" id="annualPremium" min="0" step="0.01" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Wind and Hail Deductible</label>
            <input type="text" id="windHailDeductible" placeholder="e.g., 1% or $2500" />
          </div>
          <div class="form-group">
            <label>Replacement Cost</label>
            <select id="replacementCost">
              <option value="100%">100%</option>
              <option value="125%">125%</option>
              <option value="150%">150%</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Mortgage Information -->
      <div class="form-section" id="mortgageeSection">
        <div class="section-title">Mortgage Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Mortgagee Name</label>
            <input type="text" id="mortgageeName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Mortgagee Address Line 1</label>
            <input type="text" id="mortgageeAddressLine1" />
          </div>
          <div class="form-group">
            <label>Mortgagee Address Line 2</label>
            <input type="text" id="mortgageeAddressLine2" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="mortgageeCity" />
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="mortgageeState" value="NC" />
          </div>
          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" id="mortgageeZipCode" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Loan Number</label>
            <input type="text" id="loanNumber" />
          </div>
        </div>
      </div>

      <!-- Attorney Information (for closing) -->
      <div class="form-section" id="attorneySection">
        <div class="section-title">Closing Attorney Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Attorney/Law Firm Name</label>
            <input type="text" id="attorneyName" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="attorneyEmail" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Address Line 1</label>
            <input type="text" id="attorneyAddressLine1" />
          </div>
          <div class="form-group">
            <label>Address Line 2</label>
            <input type="text" id="attorneyAddressLine2" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="attorneyCity" />
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="attorneyState" value="NC" />
          </div>
          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" id="attorneyZipCode" />
          </div>
        </div>
      </div>

      <!-- Cancellation Specific Fields -->
      <div class="form-section" id="cancellationSection">
        <div class="section-title">Cancellation Details</div>
        <div class="form-row">
          <div class="form-group">
            <label>Cancellation Date</label>
            <input type="date" id="cancellationDate" />
          </div>
          <div class="form-group">
            <label>Cancellation Reason</label>
            <select id="cancellationReason">
              <option value="">Select Reason</option>
              <option value="nonpayment">Non-Payment</option>
              <option value="insured-request">Insured Request</option>
              <option value="underwriting">Underwriting Decision</option>
              <option value="sold">Property Sold</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Additional Notes</label>
            <textarea id="cancellationNotes" rows="3"></textarea>
          </div>
        </div>
      </div>

      <!-- Renewal Specific Fields -->
      <div class="form-section" id="renewalSection">
        <div class="section-title">Renewal Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Current Premium</label>
            <input type="number" id="currentPremium" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>Renewal Premium</label>
            <input type="number" id="renewalPremium" min="0" step="0.01" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Renewal Date</label>
            <input type="date" id="renewalDate" />
          </div>
          <div class="form-group">
            <label>Payment Due Date</label>
            <input type="date" id="paymentDueDate" />
          </div>
        </div>
      </div>

      <!-- Coverage Change Fields -->
      <div class="form-section" id="coverageChangeSection">
        <div class="section-title">Coverage Change Details</div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Change Description</label>
            <textarea id="changeDescription" rows="3" placeholder="Describe the coverage changes..."></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Previous Premium</label>
            <input type="number" id="previousPremium" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>New Premium</label>
            <input type="number" id="newPremium" min="0" step="0.01" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Change Effective Date</label>
            <input type="date" id="changeEffectiveDate" />
          </div>
        </div>
      </div>

      <!-- Payment Receipt Fields -->
      <div class="form-section" id="paymentSection">
        <div class="section-title">Payment Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Payment Amount</label>
            <input type="number" id="paymentAmount" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>Payment Date</label>
            <input type="date" id="paymentDate" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Payment Method</label>
            <select id="paymentMethod">
              <option value="">Select Method</option>
              <option value="check">Check</option>
              <option value="cash">Cash</option>
              <option value="card">Credit/Debit Card</option>
              <option value="eft">Electronic Transfer</option>
              <option value="escrow">Escrow Payment</option>
            </select>
          </div>
          <div class="form-group">
            <label>Reference Number</label>
            <input type="text" id="referenceNumber" placeholder="Check # or Transaction ID" />
          </div>
        </div>
      </div>

      <!-- Claim Information Fields -->
      <div class="form-section" id="claimSection">
        <div class="section-title">Claim Contact Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Claim Phone Number</label>
            <input type="tel" id="claimPhone" />
          </div>
          <div class="form-group">
            <label>Claim Email</label>
            <input type="email" id="claimEmail" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Special Instructions</label>
            <textarea id="claimInstructions" placeholder="Enter any special claim filing instructions..."></textarea>
          </div>
        </div>
      </div>

      <!-- DL-123 Specific Fields -->
      <div class="form-section" id="dl123Section">
        <div class="section-title">DL-123 Driver Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insured Driver Name</label>
            <input type="text" id="insuredDriverName" />
          </div>
          <div class="form-group">
            <label>Date of Birth</label>
            <input type="date" id="driverDateOfBirth" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Agency Code #</label>
            <input type="text" id="agencyCode" />
          </div>
          <div class="form-group">
            <label>Agent Signature Name</label>
            <input type="text" id="agentSignatureName" placeholder="Agent's printed name" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Date of Certification</label>
            <input type="date" id="certificationDate" />
          </div>
        </div>
      </div>

      <!-- Letterhead Specific Fields -->
      <div class="form-section" id="letterheadSection">
        <div class="section-title">Professional Letter Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Recipient Name</label>
            <input type="text" id="letterRecipientName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Recipient Company (Optional)</label>
            <input type="text" id="letterRecipientCompany" placeholder="ABC Corporation" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Recipient Address</label>
            <input type="text" id="letterRecipientAddress" placeholder="123 Main Street" />
          </div>
          <div class="form-group">
            <label>City, State ZIP</label>
            <input type="text" id="letterRecipientCityStateZip" placeholder="New York, NY 10001" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Letter Date</label>
            <input type="date" id="letterDate" />
          </div>
          <div class="form-group">
            <label>Letter Subject</label>
            <input type="text" id="letterSubject" placeholder="RE: Insurance Policy Update" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Sender Name</label>
            <input type="text" id="letterSenderName" placeholder="Jane Smith" />
          </div>
          <div class="form-group">
            <label>Sender Position</label>
            <input type="text" id="letterSenderPosition" placeholder="Insurance Agent" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Letter Content</label>
            <textarea id="letterContent" rows="8" placeholder="Dear [Recipient],

Thank you for your interest in our insurance services. I am writing to provide you with important information regarding your policy...

Please feel free to contact me if you have any questions or need additional information."></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Closing</label>
            <select id="letterClosing">
              <option value="Sincerely">Sincerely</option>
              <option value="Best Regards">Best Regards</option>
              <option value="Respectfully">Respectfully</option>
              <option value="Thank you">Thank you</option>
              <option value="Cordially">Cordially</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Envelope Specific Fields -->
      <div class="form-section" id="envelopeSection">
        <div class="section-title">Envelope Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Envelope Size</label>
            <select id="envelopeSize">
              <option value="10">#10 Standard (9.5" × 4.125")</option>
              <option value="9">#9 Business (8.875" × 3.875")</option>
              <option value="a7">A7 Announcement (7.25" × 5.25")</option>
            </select>
          </div>
          <div class="form-group">
            <label>Include Return Address</label>
            <select id="envelopeIncludeReturn">
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Recipient Address</label>
            <textarea id="envelopeRecipientAddress" rows="4" placeholder="John Doe
123 Main Street
New York, NY 10001"></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Return Address (Optional - Leave blank to use default)</label>
            <textarea id="envelopeReturnAddress" rows="3" placeholder="Bill Layne Insurance
PO Box 827
Elkin, NC 28621"></textarea>
          </div>
        </div>
      </div>

      <!-- Underwriting Document Fields -->
      <div class="form-section" id="underwritingSection">
        <div class="section-title">Underwriting Information Request</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insurance Company</label>
            <select id="underwritingCompany">
              <option value="">Select Company</option>
              <option value="Nationwide">Nationwide</option>
              <option value="Progressive">Progressive</option>
              <option value="National General">National General</option>
              <option value="Travelers">Travelers</option>
              <option value="NC Grange Mutual">NC Grange Mutual</option>
              <option value="Alamance">Alamance</option>
              <option value="Universal Property">Universal Property</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Underwriter Email</label>
            <input type="email" id="underwriterEmail" placeholder="underwriter@insurance.com" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Subject Line</label>
            <input type="text" id="underwritingSubject" placeholder="Underwriting Request - Policy #123456" />
          </div>
          <div class="form-group">
            <label>Policy/Quote Number</label>
            <input type="text" id="underwritingPolicyNumber" placeholder="Enter policy or quote number" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Insured Name</label>
            <input type="text" id="underwritingInsuredName" placeholder="John and Jane Doe" />
          </div>
          <div class="form-group">
            <label>Property Address</label>
            <input type="text" id="underwritingPropertyAddress" placeholder="123 Main St, Elkin, NC 28621" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Request Type</label>
            <select id="underwritingRequestType" onchange="updateUnderwritingTemplate()">
              <option value="new">New Business Quote</option>
              <option value="renewal">Renewal</option>
              <option value="endorsement">Endorsement/Change</option>
              <option value="inspection">Inspection Photos</option>
              <option value="claims">Claims History</option>
              <option value="documentation">Additional Documentation</option>
              <option value="custom">Custom Request</option>
            </select>
          </div>
          <div class="form-group">
            <label>Priority Level</label>
            <select id="underwritingPriority">
              <option value="normal">Normal</option>
              <option value="urgent">Urgent - Closing/Time Sensitive</option>
              <option value="high">High Priority</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label>Documents/Information Needed</label>
            <textarea id="underwritingDocumentsNeeded" rows="4" placeholder="Please provide:
- 4-point inspection report
- Wind mitigation form
- Photos of roof (all sides)
- Proof of roof replacement"></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label>Additional Notes/Context</label>
            <textarea id="underwritingNotes" rows="3" placeholder="Any additional information or special circumstances..."></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Response Needed By</label>
            <input type="date" id="underwritingDeadline" />
          </div>
          <div class="form-group">
            <label>Agent Name</label>
            <input type="text" id="underwritingAgentName" placeholder="Your name" value="Bill Layne" />
          </div>
        </div>
      </div>

      <!-- Auto ID Card Specific Fields -->
      <div class="form-section" id="autoIDCardSection">
        <div class="section-title">Auto Insurance ID Card Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insurance Company</label>
            <select id="idCardCompany" onchange="updateIDCardCompanyInfo()">
              <option value="">Select Company</option>
              <option value="Nationwide">Nationwide</option>
              <option value="Progressive">Progressive</option>
              <option value="National General">National General</option>
              <option value="Travelers">Travelers</option>
              <option value="NC Grange Mutual">NC Grange Mutual</option>
              <option value="Alamance">Alamance</option>
              <option value="Universal Property">Universal Property</option>
              <option value="Dairyland">Dairyland</option>
            </select>
          </div>
          <div class="form-group">
            <label>Number of Vehicles</label>
            <select id="idCardVehicleCount" onchange="updateVehicleFields()">
              <option value="1">1 Vehicle</option>
              <option value="2">2 Vehicles</option>
              <option value="3">3 Vehicles</option>
              <option value="4">4 Vehicles</option>
            </select>
          </div>
        </div>
        
        <!-- Vehicle 1 Information -->
        <div id="vehicle1Section">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 1 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle1Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle1Make" placeholder="Honda" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle1Model" placeholder="Accord" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle1VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Vehicle 2 Information (Hidden by default) -->
        <div id="vehicle2Section" style="display: none;">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 2 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle2Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle2Make" placeholder="Toyota" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle2Model" placeholder="Camry" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle2VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Vehicle 3 Information (Hidden by default) -->
        <div id="vehicle3Section" style="display: none;">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 3 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle3Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle3Make" placeholder="Ford" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle3Model" placeholder="F-150" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle3VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Vehicle 4 Information (Hidden by default) -->
        <div id="vehicle4Section" style="display: none;">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 4 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle4Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle4Make" placeholder="Chevrolet" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle4Model" placeholder="Silverado" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle4VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Driver Information -->
        <div class="form-row" style="margin-top: 20px;">
          <div class="form-group">
            <label>Primary Driver Name</label>
            <input type="text" id="idCardDriverName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Additional Driver (Optional)</label>
            <input type="text" id="idCardAdditionalDriver" placeholder="Jane Doe" />
          </div>
        </div>

        <!-- Policy Information for ID Card -->
        <div class="form-row">
          <div class="form-group">
            <label>Policy Number</label>
            <input type="text" id="idCardPolicyNumber" placeholder="Enter Policy Number" />
          </div>
          <div class="form-group">
            <label>NAIC #</label>
            <input type="text" id="idCardNAIC" placeholder="Auto-filled based on company" readonly style="background-color: #f0f0f0;" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Effective Date</label>
            <input type="date" id="idCardEffectiveDate" />
          </div>
          <div class="form-group">
            <label>Expiration Date</label>
            <input type="date" id="idCardExpirationDate" />
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" onclick="generateDocuments()">Generate Documents</button>
      </div>

      <!-- Preview Section -->
      <div id="previewSection" style="display: none;">
        <h2>Generated Documents</h2>
        <div id="documentPreviewContainer"></div>
      </div>
    </div>
  </div>

  <!-- PDF Templates Tab -->
  <div id="templates-tab" class="tab-content" style="display: none;">
    <div class="pdf-templates-container">
      <h2>PDF Template Library</h2>
      <p style="margin-bottom: 20px;">Browse and download commonly used insurance forms and templates.</p>
      <div class="pdf-category-selector">
        <label for="pdfCategory">Filter by Category:</label>
        <select id="pdfCategory" onchange="loadPDFCategory()">
          <option value="all">All Templates</option>
          <option value="acord">ACORD Forms</option>
          <option value="state">State Forms</option>
          <option value="company">Company Forms</option>
        </select>
      </div>
      <div id="pdfGrid" class="pdf-grid">
        <!-- PDF cards will be dynamically loaded here -->
      </div>
    </div>
  </div>

  <!-- Resources Tab -->
  <div id="resources-tab" class="tab-content" style="display: none;">
    <div class="resources-container">
      <h2>Quick Links & Resources</h2>
      <div class="resource-grid">
        <div class="resource-card">
          <h4>📞 Contact Information</h4>
          <p><strong>Bill Layne Insurance Agency</strong><br>
          1283 N Bridge St<br>
          Elkin, NC 28621<br>
          Phone: (336) 835-1993<br>
          Email: Save@BillLayneInsurance.com</p>
        </div>
        
        <div class="resource-card">
          <h4>🏢 Insurance Companies</h4>
          <p>Quick links to carrier websites:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://www.nationwide.com" target="_blank">Nationwide</a></li>
            <li><a href="https://www.progressive.com" target="_blank">Progressive</a></li>
            <li><a href="https://www.travelers.com" target="_blank">Travelers</a></li>
            <li><a href="https://www.nationalgeneral.com" target="_blank">National General</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>📋 NC DMV Resources</h4>
          <p>North Carolina DMV forms and information:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://www.ncdot.gov/dmv" target="_blank">NC DMV Website</a></li>
            <li><a href="https://www.ncdot.gov/dmv/insurance" target="_blank">Insurance Requirements</a></li>
            <li><a href="https://www.ncdot.gov/dmv/forms" target="_blank">DMV Forms</a></li>
            <li><a href="https://vehicle-search.ncshp.org/accidents" target="_blank">NC Highway Patrol Crash Reports</a></li>
            <li><a href="https://payments.ncdot.gov/" target="_blank">Pay DMV Fines</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>📧 Company Email Addresses</h4>
          <p>Important email contacts for submissions:</p>
          <ul style="list-style: none; padding: 0;">
            <li><strong>NC Grange Underwriting:</strong><br>
                <a href="mailto:data4apps@ncgm.com">data4apps@ncgm.com</a></li>
            <li style="margin-top: 10px;"><strong>Progressive Uploads:</strong><br>
                <a href="mailto:upload@progressiveagent.com">upload@progressiveagent.com</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>🔧 Tools & Calculators</h4>
          <p>Helpful insurance tools:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://billlayne.github.io/coi-generator/" target="_blank">Certificate Maker</a></li>
            <li><a href="https://billlayne.github.io/NC-Grange-Home-Insurance-Photo-Guide/" target="_blank">NC Grange Photo Guide</a></li>
            <li><a href="https://billlayne.github.io/insurance-image-upload/link-generator.html" target="_blank">Customer Photos</a></li>
            <li><a href="#" onclick="alert('Coming soon!')">Premium Calculator</a></li>
            <li><a href="#" onclick="alert('Coming soon!')">Coverage Estimator</a></li>
            <li><a href="#" onclick="alert('Coming soon!')">Deductible Comparison</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>📰 Newsletters</h4>
          <p>Stay informed with our latest updates:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://billlayne.github.io/Newsletter/" target="_blank">Bill Layne Insurance Newsletter</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Prompt Manager Tab -->
  <div id="prompts-tab" class="tab-content" style="display: none;">
    <style>
      .prompts-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .prompts-header {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        text-align: center;
      }
      
      .prompts-toolbar {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }
      
      .prompt-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
      }
      
      .prompt-btn:hover {
        background: #5a67d8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      
      .prompt-btn.secondary {
        background: #48bb78;
      }
      
      .prompt-btn.secondary:hover {
        background: #38a169;
      }
      
      .prompt-search-box {
        flex: 1;
        min-width: 200px;
      }
      
      .prompt-search-box input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
      }
      
      .prompt-filter-bar {
        background: white;
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
      }
      
      .prompt-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .prompt-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.3s;
        position: relative;
      }
      
      .prompt-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      }
      
      .favorite-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.2s;
      }
      
      .favorite-btn:hover {
        transform: scale(1.2);
      }
      
      .favorite-btn.active {
        color: #f6ad55;
      }
      
      .prompt-title {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        padding-right: 40px;
      }
      
      .prompt-content {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
        max-height: 100px;
        overflow: hidden;
      }
      
      .prompt-card-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      
      .card-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }
      
      .copy-btn {
        background: #667eea;
        color: white;
      }
      
      .copy-btn:hover {
        background: #5a67d8;
      }
      
      .edit-btn {
        background: #4299e1;
        color: white;
      }
      
      .edit-btn:hover {
        background: #3182ce;
      }
      
      .delete-btn {
        background: #f56565;
        color: white;
      }
      
      .delete-btn:hover {
        background: #e53e3e;
      }
      
      .prompt-empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .prompt-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        padding: 20px;
      }
      
      .prompt-modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .prompt-modal-content {
        background: white;
        border-radius: 12px;
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      .prompt-modal-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .prompt-modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
      }
      
      .prompt-modal-body {
        padding: 20px;
      }
      
      .prompt-form-group {
        margin-bottom: 20px;
      }
      
      .prompt-form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }
      
      .prompt-form-group input,
      .prompt-form-group textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
      }
      
      .prompt-form-group textarea {
        min-height: 150px;
        resize: vertical;
        font-family: inherit;
      }
      
      .prompt-modal-footer {
        padding: 20px;
        border-top: 1px solid #e2e8f0;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      
      .prompt-toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #48bb78;
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: none;
        animation: slideInPrompt 0.3s ease;
        z-index: 1001;
      }
      
      .prompt-toast.show {
        display: block;
      }
      
      .prompt-toast.error {
        background: #f56565;
      }
      
      @keyframes slideInPrompt {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>
    
    <div class="prompts-container">
      <!-- Header -->
      <div class="prompts-header">
        <h1>📝 Prompt Manager</h1>
        <p>Save and organize your AI prompts in one place</p>
      </div>
      
      <!-- Toolbar -->
      <div class="prompts-toolbar">
        <button class="prompt-btn" onclick="openAddPromptModal()">➕ Add New Prompt</button>
        <button class="prompt-btn secondary" onclick="exportPrompts()">📥 Download All</button>
        <button class="prompt-btn secondary" onclick="document.getElementById('importPromptFile').click()">📤 Upload Prompts</button>
        <input type="file" id="importPromptFile" accept=".json" style="display: none;" onchange="importPrompts(event)">
        <div class="prompt-search-box">
          <input type="text" id="promptSearchInput" placeholder="🔍 Search prompts..." oninput="renderPrompts()">
        </div>
      </div>
      
      <!-- Filter Bar -->
      <div class="prompt-filter-bar">
        <label>Sort by:</label>
        <select id="promptSortSelect" onchange="renderPrompts()">
          <option value="alphabetical">A-Z (Title)</option>
          <option value="newest">Newest First</option>
          <option value="category">Category</option>
        </select>
        
        <label class="checkbox-label">
          <input type="checkbox" id="promptFavoritesOnly" onchange="renderPrompts()">
          Show Favorites Only
        </label>
      </div>
      
      <!-- Prompts Container -->
      <div id="promptsContainer"></div>
      
      <!-- Empty State -->
      <div class="prompt-empty-state" id="promptEmptyState" style="display: none;">
        <h3>No prompts yet</h3>
        <p>Click "Add New Prompt" to get started!</p>
      </div>
    </div>
    
    <!-- Add/Edit Modal -->
    <div class="prompt-modal" id="promptModal">
      <div class="prompt-modal-content">
        <div class="prompt-modal-header">
          <h2 id="promptModalTitle">Add New Prompt</h2>
          <button class="prompt-modal-close" onclick="closePromptModal()">✕</button>
        </div>
        <div class="prompt-modal-body">
          <div class="prompt-form-group">
            <label>Prompt Title *</label>
            <input type="text" id="promptTitleInput" placeholder="Give your prompt a name...">
          </div>
          <div class="prompt-form-group">
            <label>Prompt Content *</label>
            <textarea id="promptContentInput" placeholder="Enter your prompt here..."></textarea>
          </div>
          <div class="prompt-form-group">
            <label>Category (optional)</label>
            <input type="text" id="promptCategoryInput" placeholder="e.g., Email, Social Media, Reports">
          </div>
        </div>
        <div class="prompt-modal-footer">
          <button class="prompt-btn" onclick="closePromptModal()">Cancel</button>
          <button class="prompt-btn" onclick="savePrompt()">Save Prompt</button>
        </div>
      </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="prompt-toast" id="promptToast"></div>
    
    <script>
      // Prompt Manager Data and Functions
      let prompts = [];
      let currentEditPromptId = null;
      
      // Load prompts from localStorage
      function loadPromptsFromStorage() {
        try {
          const stored = localStorage.getItem('simplePrompts');
          if (stored) {
            prompts = JSON.parse(stored);
            console.log(`Loaded ${prompts.length} prompts from localStorage`);
          } else {
            prompts = [];
            console.log('No prompts found in localStorage, starting fresh');
          }
        } catch (error) {
          console.error('Error loading prompts from localStorage:', error);
          prompts = [];
        }
      }
      
      // Save prompts to localStorage
      function savePromptsToStorage() {
        try {
          localStorage.setItem('simplePrompts', JSON.stringify(prompts));
          console.log(`Saved ${prompts.length} prompts to localStorage`);
        } catch (error) {
          console.error('Error saving prompts to localStorage:', error);
          showPromptToast('Failed to save prompts locally', true);
        }
      }
      
      // Initialize prompts when tab is shown
      function initializePrompts() {
        loadPromptsFromStorage();
        renderPrompts();
      }
      
      // Load prompts on page load
      loadPromptsFromStorage();
      
      function renderPrompts() {
        const container = document.getElementById('promptsContainer');
        const emptyState = document.getElementById('promptEmptyState');
        const searchTerm = document.getElementById('promptSearchInput').value.toLowerCase();
        const sortBy = document.getElementById('promptSortSelect').value;
        const favoritesOnly = document.getElementById('promptFavoritesOnly').checked;
        
        // Filter prompts
        let filtered = prompts.filter(p => {
          const matchesSearch = p.title.toLowerCase().includes(searchTerm) || 
            p.content.toLowerCase().includes(searchTerm) ||
            (p.category || '').toLowerCase().includes(searchTerm);
          const matchesFavorite = !favoritesOnly || p.isFavorite;
          return matchesSearch && matchesFavorite;
        });
        
        // Sort prompts
        filtered.sort((a, b) => {
          if (sortBy === 'alphabetical') {
            return a.title.localeCompare(b.title);
          } else if (sortBy === 'newest') {
            return new Date(b.createdAt) - new Date(a.createdAt);
          } else if (sortBy === 'category') {
            const catA = a.category || 'zzz';
            const catB = b.category || 'zzz';
            if (catA === catB) {
              return a.title.localeCompare(b.title);
            }
            return catA.localeCompare(catB);
          }
          return 0;
        });
        
        if (filtered.length === 0) {
          container.innerHTML = '';
          emptyState.style.display = 'block';
          if (favoritesOnly) {
            emptyState.querySelector('h3').textContent = 'No favorite prompts yet';
            emptyState.querySelector('p').textContent = 'Star some prompts to see them here!';
          } else if (searchTerm) {
            emptyState.querySelector('h3').textContent = 'No prompts found';
            emptyState.querySelector('p').textContent = 'Try a different search term';
          } else {
            emptyState.querySelector('h3').textContent = 'No prompts yet';
            emptyState.querySelector('p').textContent = 'Click "Add New Prompt" to get started!';
          }
          return;
        }
        
        emptyState.style.display = 'none';
        
        container.innerHTML = '<div class="prompt-grid">' + 
          filtered.map(prompt => `
            <div class="prompt-card">
              <button class="favorite-btn ${prompt.isFavorite ? 'active' : ''}" onclick="togglePromptFavorite('${prompt.id}')">
                ${prompt.isFavorite ? '⭐' : '☆'}
              </button>
              <div class="prompt-title">${escapeHtmlPrompt(prompt.title)}</div>
              ${prompt.category ? `<div style="color: #667eea; font-size: 0.9rem; margin-bottom: 10px;">📁 ${escapeHtmlPrompt(prompt.category)}</div>` : ''}
              <div class="prompt-content">${escapeHtmlPrompt(prompt.content)}</div>
              <div class="prompt-card-actions">
                <button class="card-btn copy-btn" onclick="copyPrompt('${prompt.id}')">📋 Copy</button>
                <button class="card-btn edit-btn" onclick="editPrompt('${prompt.id}')">✏️ Edit</button>
                <button class="card-btn delete-btn" onclick="deletePrompt('${prompt.id}')">🗑️ Delete</button>
              </div>
            </div>
          `).join('') + '</div>';
      }
      
      function togglePromptFavorite(id) {
        const prompt = prompts.find(p => p.id === id);
        if (!prompt) return;
        
        prompt.isFavorite = !prompt.isFavorite;
        savePromptsToStorage();
        renderPrompts();
        showPromptToast(prompt.isFavorite ? 'Added to favorites!' : 'Removed from favorites');
      }
      
      function openAddPromptModal() {
        document.getElementById('promptModalTitle').textContent = 'Add New Prompt';
        document.getElementById('promptTitleInput').value = '';
        document.getElementById('promptContentInput').value = '';
        document.getElementById('promptCategoryInput').value = '';
        currentEditPromptId = null;
        document.getElementById('promptModal').classList.add('active');
      }
      
      function editPrompt(id) {
        const prompt = prompts.find(p => p.id === id);
        if (!prompt) return;
        
        document.getElementById('promptModalTitle').textContent = 'Edit Prompt';
        document.getElementById('promptTitleInput').value = prompt.title;
        document.getElementById('promptContentInput').value = prompt.content;
        document.getElementById('promptCategoryInput').value = prompt.category || '';
        currentEditPromptId = id;
        document.getElementById('promptModal').classList.add('active');
      }
      
      function closePromptModal() {
        document.getElementById('promptModal').classList.remove('active');
      }
      
      function savePrompt() {
        const title = document.getElementById('promptTitleInput').value.trim();
        const content = document.getElementById('promptContentInput').value.trim();
        const category = document.getElementById('promptCategoryInput').value.trim();
        
        if (!title || !content) {
          showPromptToast('Please fill in all required fields', true);
          return;
        }
        
        if (currentEditPromptId) {
          // Edit existing
          const index = prompts.findIndex(p => p.id === currentEditPromptId);
          prompts[index] = { ...prompts[index], title, content, category };
          showPromptToast('Prompt updated successfully!');
        } else {
          // Add new
          const newPrompt = {
            id: Date.now().toString(),
            title,
            content,
            category,
            isFavorite: false,
            createdAt: new Date().toISOString()
          };
          prompts.unshift(newPrompt);
          showPromptToast('Prompt added successfully!');
        }
        
        savePromptsToStorage();
        renderPrompts();
        closePromptModal();
      }
      
      function copyPrompt(id) {
        const prompt = prompts.find(p => p.id === id);
        if (!prompt) return;
        
        navigator.clipboard.writeText(prompt.content).then(() => {
          showPromptToast('Prompt copied to clipboard!');
        }).catch(() => {
          showPromptToast('Failed to copy', true);
        });
      }
      
      function deletePrompt(id) {
        if (!confirm('Are you sure you want to delete this prompt?')) return;
        
        prompts = prompts.filter(p => p.id !== id);
        savePromptsToStorage();
        renderPrompts();
        showPromptToast('Prompt deleted');
      }
      
      function exportPrompts() {
        const dataStr = JSON.stringify(prompts, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
        const link = document.createElement('a');
        link.href = dataUri;
        link.download = `prompts-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        showPromptToast('Prompts downloaded!');
      }
      
      function importPrompts(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const imported = JSON.parse(e.target.result);
            if (Array.isArray(imported)) {
              imported.forEach(p => {
                if (p.isFavorite === undefined) p.isFavorite = false;
              });
              prompts = [...imported, ...prompts];
              savePromptsToStorage();
              renderPrompts();
              showPromptToast(`Imported ${imported.length} prompts!`);
            }
          } catch (err) {
            showPromptToast('Invalid file format', true);
          }
        };
        reader.readAsText(file);
        event.target.value = '';
      }
      
      function showPromptToast(message, isError = false) {
        const toast = document.getElementById('promptToast');
        toast.textContent = message;
        toast.className = 'prompt-toast show' + (isError ? ' error' : '');
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
      
      function escapeHtmlPrompt(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // Close modal on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.getElementById('promptModal').classList.contains('active')) {
          closePromptModal();
        }
      });
      
      // Auto-save prompts before page unload
      window.addEventListener('beforeunload', () => {
        if (prompts.length > 0) {
          savePromptsToStorage();
        }
      });
      
      // Verify localStorage is working
      window.addEventListener('DOMContentLoaded', () => {
        // Test localStorage availability
        try {
          const testKey = '__localStorageTest__';
          localStorage.setItem(testKey, 'test');
          localStorage.removeItem(testKey);
          console.log('✅ localStorage is available and working');
        } catch (e) {
          console.error('❌ localStorage is not available:', e);
          showPromptToast('Warning: Cannot save prompts locally. Your browser may have storage disabled.', true);
        }
      });
    </script>
  </div>

<!-- SNL Tab (Statement of No Loss Generator) -->
<div id="snl-tab" class="tab-content" style="display: none;">
    <style>
        .snl-container * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        .snl-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .snl-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        
        .snl-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .snl-header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        /* Instructions Box */
        .snl-instructions-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .snl-instructions-box h3 {
            color: #d63384;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .snl-instructions-box ol {
            margin-left: 20px;
            color: #333;
            line-height: 1.8;
        }
        
        .snl-instructions-box li {
            margin-bottom: 8px;
        }
        
        .snl-instructions-box .important {
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
        }
        
        .snl-instructions-box .highlight {
            color: #dc3545;
            font-weight: 600;
        }
        
        .snl-language-selector {
            background: #e7f3ff;
            border: 2px solid #0066cc;
            border-radius: 8px;
            padding: 15px;
            margin: 0 20px 20px 20px;
            text-align: center;
        }
        
        .snl-language-label {
            color: #0066cc;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }
        
        .snl-lang-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .snl-lang-btn {
            padding: 10px 30px;
            border: 2px solid #0066cc;
            background: white;
            color: #0066cc;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            max-width: 200px;
        }
        
        .snl-lang-btn.active {
            background: #0066cc;
            color: white;
        }
        
        .snl-lang-btn:hover:not(.active) {
            background: #e7f3ff;
        }
        
        .snl-form-container {
            padding: 20px;
        }
        
        .snl-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .snl-form-group {
            margin-bottom: 0;
        }
        
        .snl-form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .snl-form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .snl-form-group input[type="text"],
        .snl-form-group input[type="email"],
        .snl-form-group input[type="tel"],
        .snl-form-group input[type="date"],
        .snl-form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .snl-form-group input:focus,
        .snl-form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }
        
        .snl-button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .snl-btn {
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .snl-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .snl-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .snl-btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .snl-btn-secondary:hover {
            background: #5a6268;
        }
        
        .snl-output-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .snl-output-section.show {
            display: block;
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .snl-output-group {
            margin-bottom: 20px;
        }
        
        .snl-output-label {
            font-weight: 600;
            color: #2a5298;
            margin-bottom: 10px;
            display: block;
            font-size: 14px;
        }
        
        .snl-output-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            position: relative;
            word-break: break-all;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .snl-copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .snl-copy-btn:hover {
            background: #5568d3;
        }
        
        .snl-copy-btn.copied {
            background: #4CAF50;
        }
        
        .snl-action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .snl-action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            color: white;
        }
        
        .snl-action-btn.copy-open {
            background: #28a745;
            grid-column: 1 / -1;
        }
        
        .snl-action-btn.copy-open:hover {
            background: #218838;
        }
        
        .snl-action-btn.send-email {
            background: #17a2b8;
        }
        
        .snl-action-btn.send-email:hover {
            background: #138496;
        }
        
        .snl-action-btn.open-matrix {
            background: #ffc107;
            color: #333;
        }
        
        .snl-action-btn.open-matrix:hover {
            background: #e0a800;
        }
        
        .snl-action-btn.copy-link {
            background: #6c757d;
        }
        
        .snl-action-btn.copy-link:hover {
            background: #5a6268;
        }
        
        .snl-action-btn.blank-form {
            background: #dc3545;
        }
        
        .snl-action-btn.blank-form:hover {
            background: #c82333;
        }
        
        .snl-success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            display: none;
        }
        
        .snl-success-message.show {
            display: block;
            animation: slideDown 0.5s ease-out;
        }
        
        .snl-footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }
        
        .snl-footer p {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .snl-footer a {
            color: #2a5298;
            text-decoration: none;
            font-weight: 600;
        }
        
        .snl-footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 600px) {
            .snl-form-row {
                grid-template-columns: 1fr;
            }
            
            .snl-action-buttons {
                grid-template-columns: 1fr;
            }
            
            .snl-action-btn.copy-open {
                grid-column: 1;
            }
            
            .snl-button-group {
                flex-direction: column;
            }
            
            .snl-lang-buttons {
                flex-direction: column;
            }
        }
    </style>
    
    <div class="snl-container">
        <div class="snl-header">
            <h1>📋 No Loss Statement Link Generator</h1>
            <p>Bill Layne Insurance Agency - Staff Tool</p>
        </div>
        
        <div class="snl-instructions-box">
            <h3>⚡ Quick Instructions:</h3>
            <ol>
                <li>Fill in customer's information below</li>
                <li><span class="highlight">Select customer's language preference</span> (English or Español)</li>
                <li>Click "Generate Link"</li>
                <li>Copy the link or use email/text templates</li>
                <li>Send to customer - they just need to sign!</li>
                <li>⚠️ This sends to <strong>Docs@BillLayneInsurance.com</strong></li>
            </ol>
            <div style="margin-top: 15px; padding: 10px; background: #ffeaa7; border-radius: 5px;">
                <strong>Note:</strong> The form below stays in English for staff. Only the customer's messages and form will be in their selected language.
            </div>
        </div>
        
        <div class="snl-language-selector">
            <span class="snl-language-label">🌐 Customer's Preferred Language:</span>
            <div class="snl-lang-buttons">
                <button class="snl-lang-btn active" onclick="snlSetLanguage('en')">English</button>
                <button class="snl-lang-btn" onclick="snlSetLanguage('es')">Español</button>
            </div>
        </div>
        
        <div class="snl-form-container">
            <form id="snlLinkGenerator">
                <div class="snl-form-row">
                    <div class="snl-form-group">
                        <label for="snlCompany">Insurance Company</label>
                        <select id="snlCompany" required>
                            <option value="">Select Company</option>
                            <option value="Nationwide">Nationwide</option>
                            <option value="Progressive">Progressive</option>
                            <option value="National General">National General</option>
                            <option value="Alamance">Alamance</option>
                            <option value="Travelers">Travelers</option>
                            <option value="Foremost">Foremost</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="snl-form-group">
                        <label for="snlPolicyNumber">Policy Number</label>
                        <input type="text" id="snlPolicyNumber" required>
                    </div>
                </div>
                
                <div class="snl-form-row">
                    <div class="snl-form-group full-width">
                        <label for="snlInsuredName">Insured Name</label>
                        <input type="text" id="snlInsuredName" required>
                    </div>
                </div>
                
                <div class="snl-form-row">
                    <div class="snl-form-group">
                        <label for="snlEmail">Email Address</label>
                        <input type="email" id="snlEmail" required>
                    </div>
                    
                    <div class="snl-form-group">
                        <label for="snlPhone">Phone Number</label>
                        <input type="tel" id="snlPhone" required placeholder="(336) 555-1234">
                    </div>
                </div>
                
                <div class="snl-form-row">
                    <div class="snl-form-group">
                        <label for="snlPolicyType">Policy Type</label>
                        <select id="snlPolicyType" required>
                            <option value="">Select Type</option>
                            <option value="Auto">Auto Insurance</option>
                            <option value="Home">Homeowners</option>
                            <option value="Renters">Renters</option>
                            <option value="Life">Life</option>
                            <option value="Business">Business</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="snl-form-group">
                        <label for="snlAmountPaid">Amount Paid</label>
                        <input type="text" id="snlAmountPaid" required placeholder="$0.00">
                    </div>
                </div>
                
                <div class="snl-form-row">
                    <div class="snl-form-group">
                        <label for="snlCancelDate">Cancellation Date</label>
                        <input type="date" id="snlCancelDate" required>
                    </div>
                    
                    <div class="snl-form-group">
                        <label for="snlReinstateDate">Reinstatement Date</label>
                        <input type="date" id="snlReinstateDate" required>
                    </div>
                </div>
                
                <div class="snl-button-group">
                    <button type="submit" class="snl-btn snl-btn-primary">Generate Link</button>
                    <button type="button" class="snl-btn snl-btn-secondary" onclick="snlClearForm()">Clear Form</button>
                </div>
            </form>
            
            <div id="snlOutput" class="snl-output-section">
                <div class="snl-output-group">
                    <label class="snl-output-label">Generated Link</label>
                    <div class="snl-output-content">
                        <span id="snlGeneratedLink"></span>
                        <button class="snl-copy-btn" onclick="snlCopyToClipboard('snlGeneratedLink')">Copy</button>
                    </div>
                </div>
                
                <div class="snl-output-group">
                    <label class="snl-output-label">Text Message Template</label>
                    <div class="snl-output-content">
                        <span id="snlTextTemplate"></span>
                        <button class="snl-copy-btn" onclick="snlCopyToClipboard('snlTextTemplate')">Copy</button>
                    </div>
                </div>
                
                <div class="snl-output-group">
                    <label class="snl-output-label">Email Template</label>
                    <div class="snl-output-content">
                        <span id="snlEmailTemplate"></span>
                        <button class="snl-copy-btn" onclick="snlCopyToClipboard('snlEmailTemplate')">Copy</button>
                    </div>
                </div>
                
                <div class="snl-action-buttons">
                    <button class="snl-action-btn copy-open" onclick="snlCopyAndOpenMatrix()">
                        📋 Copy Text & Open Agency Matrix
                    </button>
                    <a href="#" id="snlEmailLink" class="snl-action-btn send-email" onclick="snlOpenGmailCompose(event)">
                        ✉️ Send Email (Gmail)
                    </a>
                    <button class="snl-action-btn open-matrix" onclick="snlOpenMatrix()">
                        🚀 Open Agency Matrix
                    </button>
                    <button class="snl-action-btn copy-link" onclick="snlCopyLinkOnly()">
                        🔗 Copy Link Only
                    </button>
                    <a href="https://billlayne.github.io/no-loss-statement/" target="_blank" class="snl-action-btn blank-form">
                        📝 Blank Form
                    </a>
                    <a href="https://www.BillLayneInsurance.com" target="_blank" class="snl-action-btn" style="background: #563d7c;">
                        🌐 Agency Website
                    </a>
                </div>
                
                <div id="snlSuccessMessage" class="snl-success-message">
                    ✅ Text copied! Opening Agency Matrix to customer search...
                </div>
            </div>
        </div>
        
        <div class="snl-footer">
            <p>
                Bill Layne Insurance Agency<br>
                1283 N Bridge St, Elkin NC 28621<br>
                📞 336-835-1993 | ✉️ Save@BillLayneInsurance.com
            </p>
            <a href="https://www.BillLayneInsurance.com" target="_blank">www.BillLayneInsurance.com</a>
        </div>
    </div>

    <script>
        let snlCustomerLanguage = 'en';
        let snlGeneratedData = {};
        
        // Language switching function - ONLY for customer messages, not the interface
        function snlSetLanguage(lang) {
            snlCustomerLanguage = lang;
            
            // Update button states
            document.querySelectorAll('.snl-lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Re-generate output if it exists with new language
            if (snlGeneratedData.link) {
                snlGenerateLink();
            }
        }
        
        // Auto-format phone number
        document.getElementById('snlPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = '(' + value;
                } else if (value.length <= 6) {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
                } else {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
                }
            }
            e.target.value = value;
        });
        
        // Auto-format amount
        document.getElementById('snlAmountPaid').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^\d.]/g, '');
            if (value && !e.target.value.startsWith('$')) {
                e.target.value = '$' + value;
            }
        });
        
        // Form submission
        document.getElementById('snlLinkGenerator').addEventListener('submit', function(e) {
            e.preventDefault();
            snlGenerateLink();
        });
        
        function snlGenerateLink() {
            // Get form values
            const company = document.getElementById('snlCompany').value;
            const policyNumber = document.getElementById('snlPolicyNumber').value;
            const name = document.getElementById('snlInsuredName').value;
            const email = document.getElementById('snlEmail').value;
            const phone = document.getElementById('snlPhone').value;
            const policyType = document.getElementById('snlPolicyType').value;
            const cancelDate = document.getElementById('snlCancelDate').value;
            const reinstateDate = document.getElementById('snlReinstateDate').value;
            const amount = document.getElementById('snlAmountPaid').value;
            
            // Build URL with parameters
            const baseUrl = 'https://billlayne.github.io/no-loss-statement/';
            const params = new URLSearchParams({
                company: company,
                policy: policyNumber,
                name: name,
                email: email,
                phone: phone,
                type: policyType,
                cancelDate: cancelDate,
                reinstateDate: reinstateDate,
                amount: amount.replace('$', '')
            });
            
            // Add language parameter if Spanish is selected
            const langParam = snlCustomerLanguage === 'es' ? '&lang=es' : '';
            const link = `${baseUrl}?${params.toString()}${langParam}`;
            
            // Store data globally (including clean phone for Agency Matrix)
            snlGeneratedData = {
                link: link,
                name: name,
                phone: phone,
                phoneClean: phone.replace(/\D/g, ''), // Remove all non-digits for Agency Matrix URL
                email: email,
                company: company,
                policyNumber: policyNumber
            };
            
            // Display output
            snlDisplayOutput();
            
            // Show output section
            document.getElementById('snlOutput').classList.add('show');
        }
        
        function snlDisplayOutput() {
            // Display link
            document.getElementById('snlGeneratedLink').textContent = snlGeneratedData.link;
            
            // Generate text template based on CUSTOMER language
            let textTemplate;
            if (snlCustomerLanguage === 'es') {
                // Spanish version
                const firstName = snlGeneratedData.name.split(' ')[0];
                const cancelDateFormatted = new Date(document.getElementById('snlCancelDate').value).toLocaleDateString();
                textTemplate = `Hola ${firstName}

Para reinstalar su póliza de seguro #${snlGeneratedData.policyNumber}, complete la Declaración de No Pérdida:

Cantidad: ${document.getElementById('snlAmountPaid').value}
Cancelado: ${cancelDateFormatted}

Haga clic aquí:
${snlGeneratedData.link}

Solo verifique la información y firme. Toma 2 minutos
¿Preguntas? Llame al 336-835-1993
Bill Layne Insurance`;
            } else {
                // English version - YOUR EXACT FORMAT
                const firstName = snlGeneratedData.name.split(' ')[0];
                const cancelDateFormatted = new Date(document.getElementById('snlCancelDate').value).toLocaleDateString();
                textTemplate = `Hi ${firstName}

To reinstate your insurance policy #${snlGeneratedData.policyNumber}, please complete the No Loss Statement:

Amount: ${document.getElementById('snlAmountPaid').value}
Cancelled: ${cancelDateFormatted}

Click here:
${snlGeneratedData.link}

Just verify info & sign. Takes 2 minutes
Questions? Call 336-835-1993
Bill Layne Insurance`;
            }
            document.getElementById('snlTextTemplate').textContent = textTemplate;
            
            // Generate email template based on CUSTOMER language
            let emailSubject, emailBody;
            if (snlCustomerLanguage === 'es') {
                emailSubject = `Declaración de No Pérdida - ${snlGeneratedData.company} Póliza ${snlGeneratedData.policyNumber}`;
                emailBody = `Estimado/a ${snlGeneratedData.name},

Según lo solicitado, aquí está el enlace para completar su Declaración de No Pérdida para reinstalar su póliza con ${snlGeneratedData.company}.

Número de Póliza: ${snlGeneratedData.policyNumber}

Por favor haga clic en el siguiente enlace para completar el formulario:
${snlGeneratedData.link}

Este formulario requiere su firma electrónica. Una vez completado, recibirá una confirmación.

Si tiene alguna pregunta, no dude en contactarnos.

Saludos cordiales,
Bill Layne Insurance Agency
336-835-1993
Save@BillLayneInsurance.com`;
            } else {
                emailSubject = `Statement of No Loss - ${snlGeneratedData.company} Policy ${snlGeneratedData.policyNumber}`;
                emailBody = `Dear ${snlGeneratedData.name},

As requested, here is the link to complete your Statement of No Loss to reinstate your policy with ${snlGeneratedData.company}.

Policy Number: ${snlGeneratedData.policyNumber}

Please click the following link to complete the form:
${snlGeneratedData.link}

This form requires your electronic signature. Once completed, you will receive a confirmation.

If you have any questions, please don't hesitate to contact us.

Best regards,
Bill Layne Insurance Agency
336-835-1993
Save@BillLayneInsurance.com`;
            }
            
            document.getElementById('snlEmailTemplate').textContent = emailBody;
            
            // Store email data for Gmail compose
            snlGeneratedData.emailSubject = emailSubject;
            snlGeneratedData.emailBody = emailBody;
        }
        
        function snlCopyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                // Update button text
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
        
        // Copy text message and open Agency Matrix to specific customer phone
        function snlCopyAndOpenMatrix() {
            // Get the text template content
            const textTemplate = document.getElementById('snlTextTemplate').textContent;
            
            // Copy to clipboard
            navigator.clipboard.writeText(textTemplate).then(() => {
                // Show success message
                const successMsg = document.getElementById('snlSuccessMessage');
                successMsg.classList.add('show');
                
                // Open Agency Matrix with phone number search
                const phoneNumber = snlGeneratedData.phoneClean;
                const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneNumber}`;
                window.open(agencyMatrixUrl, '_blank');
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy text. Please try again.');
            });
        }
        
        function snlOpenMatrix() {
            // Open Agency Matrix with phone number search
            const phoneNumber = snlGeneratedData.phoneClean;
            const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneNumber}`;
            window.open(agencyMatrixUrl, '_blank');
        }
        
        function snlOpenGmailCompose(event) {
            event.preventDefault();
            
            // Copy email body to clipboard for easy pasting
            navigator.clipboard.writeText(snlGeneratedData.emailBody).then(() => {
                // Build Gmail compose URL
                const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(snlGeneratedData.email)}&su=${encodeURIComponent(snlGeneratedData.emailSubject)}&body=${encodeURIComponent(snlGeneratedData.emailBody)}`;
                
                // Open Gmail compose in new window
                window.open(gmailUrl, '_blank');
                
                // Show brief success message
                const successMsg = document.getElementById('snlSuccessMessage');
                successMsg.textContent = '✅ Opening Gmail with email ready to send...';
                successMsg.classList.add('show');
                
                setTimeout(() => {
                    successMsg.classList.remove('show');
                    successMsg.textContent = '✅ Text copied! Opening Agency Matrix to customer search...';
                }, 2000);
            });
        }
        
        function snlCopyLinkOnly() {
            navigator.clipboard.writeText(snlGeneratedData.link).then(() => {
                const successMsg = document.getElementById('snlSuccessMessage');
                successMsg.textContent = '✅ Link copied to clipboard!';
                successMsg.classList.add('show');
                
                setTimeout(() => {
                    successMsg.classList.remove('show');
                    successMsg.textContent = '✅ Text copied! Opening Agency Matrix to customer search...';
                }, 3000);
            });
        }
        
        function snlClearForm() {
            document.getElementById('snlLinkGenerator').reset();
            document.getElementById('snlOutput').classList.remove('show');
            snlGeneratedData = {};
        }
    </script>
</div>  <!-- Cancellation Tab (ACORD 35 Cancellation Generator) -->
  <div id="cancellation-tab" class="tab-content" style="display: none;">
    <style>
      .cancel-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
      }
      
      .cancel-header {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 25px 20px;
        text-align: center;
      }
      
      .cancel-header h1 {
        font-size: 24px;
        margin-bottom: 10px;
      }
      
      .cancel-header p {
        font-size: 14px;
        opacity: 0.9;
      }
      
      .cancel-system-badge {
        display: inline-block;
        background: #dc3545;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        margin-top: 10px;
      }
      
      .cancel-form-container {
        padding: 25px 20px;
      }
      
      .cancel-section-title {
        background: #f8f9fa;
        padding: 10px 15px;
        margin: 20px -20px 15px -20px;
        font-weight: 600;
        color: #495057;
        border-left: 4px solid #dc3545;
      }
      
      .cancel-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }
      
      .cancel-form-group {
        display: flex;
        flex-direction: column;
      }
      
      .cancel-form-group.full-width {
        grid-column: span 2;
      }
      
      .cancel-form-group label {
        font-size: 13px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
      }
      
      .cancel-form-group input,
      .cancel-form-group select,
      .cancel-form-group textarea {
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
      }
      
      .cancel-form-group input:focus,
      .cancel-form-group select:focus,
      .cancel-form-group textarea:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
      }
      
      .cancel-form-group textarea {
        resize: vertical;
        min-height: 100px;
      }
      
      .cancel-button-group {
        margin-top: 30px;
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 10px;
      }
      
      .cancel-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .cancel-btn-generate {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
        grid-column: span 1;
      }
      
      .cancel-btn-generate:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(220,53,69,0.3);
      }
      
      .cancel-btn-test {
        background: #28a745;
        color: white;
      }
      
      .cancel-btn-test:hover {
        background: #218838;
      }
      
      .cancel-btn-clear {
        background: #6c757d;
        color: white;
      }
      
      .cancel-btn-clear:hover {
        background: #5a6268;
      }
      
      #cancelResultSection {
        display: none;
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border: 2px solid #28a745;
      }
      
      .cancel-result-title {
        font-size: 18px;
        font-weight: bold;
        color: #28a745;
        margin-bottom: 15px;
      }
      
      .cancel-url-display {
        background: white;
        padding: 15px;
        border-radius: 8px;
        word-break: break-all;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        border: 1px solid #ddd;
        margin-bottom: 15px;
      }
      
      .cancel-action-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }
      
      .cancel-btn-action {
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .cancel-btn-copy {
        background: #007bff;
        color: white;
      }
      
      .cancel-btn-copy:hover {
        background: #0056b3;
      }
      
      .cancel-btn-email {
        background: #2196F3;
        color: white;
      }
      
      .cancel-btn-email:hover {
        background: #0b7dda;
      }
      
      .cancel-btn-preview {
        background: #17a2b8;
        color: white;
      }
      
      .cancel-btn-preview:hover {
        background: #138496;
      }
      
      .cancel-btn-text {
        background: #ffc107;
        color: #212529;
      }
      
      .cancel-btn-text:hover {
        background: #e0a800;
      }
      
      .cancel-text-template {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border: 1px solid #ffc107;
        white-space: pre-wrap;
      }
      
      .cancel-copy-status {
        display: none;
        color: #28a745;
        font-weight: 600;
        text-align: center;
        margin-top: 10px;
      }
      
      .cancel-instructions {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
      }
      
      .cancel-instructions h4 {
        color: #856404;
        margin-bottom: 8px;
      }
      
      .cancel-instructions ol {
        margin-left: 20px;
        color: #856404;
        font-size: 14px;
      }
      
      .cancel-instructions li {
        margin-bottom: 5px;
      }
      
      .cancel-warning {
        color: #dc3545;
        font-weight: bold;
      }
      
      .cancel-notes-info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        border-radius: 6px;
        padding: 10px;
        margin-top: 5px;
        font-size: 12px;
        color: #0c5460;
      }
      
      @media (max-width: 600px) {
        .cancel-row {
          grid-template-columns: 1fr;
        }
        
        .cancel-form-group.full-width {
          grid-column: span 1;
        }
        
        .cancel-button-group {
          grid-template-columns: 1fr;
        }
        
        .cancel-btn-generate {
          grid-column: span 1;
        }
        
        .cancel-action-buttons {
          grid-template-columns: 1fr;
        }
        
        .cancel-header h1 {
          font-size: 20px;
        }
      }
    </style>
    
    <div class="cancel-container">
      <div class="cancel-header">
        <h1>📄 ACORD 35 Cancellation Link Generator</h1>
        <p>Bill Layne Insurance Agency - Staff Tool</p>
        <span class="cancel-system-badge">⚠️ CANCELLATION SYSTEM</span>
      </div>
      
      <div class="cancel-form-container">
        <div class="cancel-instructions">
          <h4>📌 Instructions:</h4>
          <ol>
            <li>Fill in all customer and policy information</li>
            <li>Double-check cancellation date and time</li>
            <li>Add any special notes (optional)</li>
            <li>Click "Generate Link"</li>
            <li>Send link to customer for signature</li>
            <li class="cancel-warning">⚠️ This creates a cancellation request!</li>
          </ol>
        </div>
        
        <form id="cancelLinkGenerator">
          <div class="cancel-section-title">Customer Information</div>
          
          <div class="cancel-row">
            <div class="cancel-form-group full-width">
              <label>Insured Name *</label>
              <input type="text" id="cancelInsuredName" required>
            </div>
          </div>
          
          <div class="cancel-row">
            <div class="cancel-form-group full-width">
              <label>Address</label>
              <input type="text" id="cancelInsuredAddress">
            </div>
          </div>
          
          <div class="cancel-row">
            <div class="cancel-form-group">
              <label>Phone</label>
              <input type="tel" id="cancelInsuredPhone">
            </div>
            <div class="cancel-form-group">
              <label>Email</label>
              <input type="email" id="cancelInsuredEmail">
            </div>
          </div>
          
          <div class="cancel-section-title">Policy Information</div>
          
          <div class="cancel-row">
            <div class="cancel-form-group">
              <label>Policy Number *</label>
              <input type="text" id="cancelPolicyNumber" required>
            </div>
            <div class="cancel-form-group">
              <label>Insurance Company *</label>
              <select id="cancelCompany" required>
                <option value="">Select Company...</option>
                <option value="Progressive">Progressive</option>
                <option value="Nationwide">Nationwide</option>
                <option value="National General">National General</option>
                <option value="Alamance Farmers">Alamance Farmers</option>
                <option value="Travelers">Travelers</option>
                <option value="Foremost">Foremost</option>
                <option value="NC Grange">NC Grange</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          
          <div class="cancel-row">
            <div class="cancel-form-group">
              <label>Policy Type *</label>
              <select id="cancelPolicyType" required>
                <option value="">Select Type...</option>
                <option value="Auto">Auto</option>
                <option value="Home">Home</option>
                <option value="Renters">Renters</option>
                <option value="Motorcycle">Motorcycle</option>
                <option value="RV">RV</option>
                <option value="Boat">Boat</option>
                <option value="Commercial">Commercial</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="cancel-form-group">
              <label>Effective Date</label>
              <input type="date" id="cancelEffectiveDate">
            </div>
          </div>
          
          <div class="cancel-row">
            <div class="cancel-form-group">
              <label>Expiration Date</label>
              <input type="date" id="cancelExpirationDate">
            </div>
          </div>
          
          <div class="cancel-section-title">Cancellation Details</div>
          
          <div class="cancel-row">
            <div class="cancel-form-group">
              <label>Cancellation Date *</label>
              <input type="date" id="cancelCancelDate" required>
            </div>
            <div class="cancel-form-group">
              <label>Cancellation Time</label>
              <select id="cancelCancelTime">
                <option value="12:01 AM">12:01 AM</option>
                <option value="12:01 PM" selected>12:01 PM</option>
                <option value="11:59 PM">11:59 PM</option>
              </select>
            </div>
          </div>
          
          <div class="cancel-row">
            <div class="cancel-form-group full-width">
              <label>Reason for Cancellation *</label>
              <select id="cancelReason" required>
                <option value="">Select Reason...</option>
                <option value="Insured Request">Insured Request</option>
                <option value="Non-Payment">Non-Payment</option>
                <option value="Rewritten">Rewritten with Another Carrier</option>
                <option value="Not Taken">Coverage Not Taken</option>
                <option value="Sold Property">Sold Property</option>
                <option value="Sold Vehicle">Sold Vehicle</option>
                <option value="No Longer Need">No Longer Need Coverage</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          
          <div class="cancel-section-title">Special Notes (Optional)</div>
          
          <div class="cancel-row">
            <div class="cancel-form-group full-width">
              <label>Staff Notes / Special Instructions</label>
              <textarea id="cancelNotes" placeholder="Add any special notes or instructions here (e.g., pending refund check, follow-up required, etc.)"></textarea>
              <div class="cancel-notes-info">
                ℹ️ These notes will appear on the PDF and in the Google Sheet but will NOT be visible to the customer
              </div>
            </div>
          </div>
          
          <div class="cancel-button-group">
            <button type="button" class="cancel-btn cancel-btn-generate" onclick="cancelGenerateLink()">
              🔗 Generate Cancellation Link
            </button>
            <button type="button" class="cancel-btn cancel-btn-clear" onclick="cancelClearForm()">
              🔄 Clear Form
            </button>
          </div>
        </form>
        
        <div id="cancelResultSection">
          <div class="cancel-result-title">✅ Cancellation Link Generated!</div>
          <div class="cancel-url-display" id="cancelGeneratedUrl"></div>
          
          <div class="cancel-action-buttons">
            <button class="cancel-btn-action cancel-btn-copy" onclick="cancelCopyLink()">
              📋 Copy Link
            </button>
            <button class="cancel-btn-action cancel-btn-email" onclick="cancelEmailToCustomer()">
              📧 Email Customer
            </button>
            <button class="cancel-btn-action cancel-btn-text" onclick="cancelSendToAgencyMatrix()">
              📱 Text Customer
            </button>
          </div>
          
          <div class="cancel-text-template" id="cancelTextTemplate" style="display: none;">
            <strong>📱 Text Message Template:</strong><br><br>
            <span id="cancelTextMessage"></span>
            <br><br>
            <button class="cancel-btn-action cancel-btn-copy" style="width: 100%; margin-bottom: 10px;" onclick="cancelCopyTextMessage()">
              📋 Copy Text Message
            </button>
          </div>
          
          <div class="cancel-text-template" id="cancelEmailTemplate" style="display: none; margin-top: 15px;">
            <strong>📧 Email Template:</strong><br><br>
            <span id="cancelEmailMessage"></span>
            <br><br>
            <button class="cancel-btn-action cancel-btn-copy" style="width: 100%;" onclick="cancelCopyEmailMessage()">
              📋 Copy Email Template
            </button>
          </div>
          
          <div class="cancel-copy-status" id="cancelCopyStatus"></div>
        </div>
      </div>
    </div>
    
    <script>
      let cancelCurrentGeneratedUrl = '';
      
      function cancelGenerateLink() {
        // Get form values
        const insuredName = document.getElementById('cancelInsuredName').value;
        const policyNumber = document.getElementById('cancelPolicyNumber').value;
        const company = document.getElementById('cancelCompany').value;
        const policyType = document.getElementById('cancelPolicyType').value;
        const cancelDate = document.getElementById('cancelCancelDate').value;
        const reason = document.getElementById('cancelReason').value;
        
        // Validate required fields
        if (!insuredName || !policyNumber || !company || !policyType || !cancelDate || !reason) {
          alert('Please fill in all required fields marked with *');
          return;
        }
        
        // Build URL parameters
        const params = new URLSearchParams({
          insuredName: insuredName,
          insuredAddress: document.getElementById('cancelInsuredAddress').value || '',
          insuredPhone: document.getElementById('cancelInsuredPhone').value || '',
          insuredEmail: document.getElementById('cancelInsuredEmail').value || '',
          policyNumber: policyNumber,
          company: company,
          policyType: policyType,
          effectiveDate: document.getElementById('cancelEffectiveDate').value || '',
          expirationDate: document.getElementById('cancelExpirationDate').value || '',
          cancelDate: cancelDate,
          cancelTime: document.getElementById('cancelCancelTime').value || '12:01 PM',
          reason: reason,
          notes: document.getElementById('cancelNotes').value || ''
        });
        
        // Generate the URL
        const baseUrl = 'https://billlayne.github.io/cancellation-form/';
        cancelCurrentGeneratedUrl = baseUrl + '?' + params.toString();
        
        // Display result
        document.getElementById('cancelGeneratedUrl').textContent = cancelCurrentGeneratedUrl;
        document.getElementById('cancelResultSection').style.display = 'block';
        
        // Generate text message
        const phone = document.getElementById('cancelInsuredPhone').value || 'No phone';
        const textMsg = `Hi ${insuredName.split(' ')[0]},\n\nPer your request, here's the link to sign your ${policyType} policy cancellation form (Policy: ${policyNumber}).\n\nCancellation Date: ${cancelFormatDate(cancelDate)} at ${document.getElementById('cancelCancelTime').value}\n\nPlease review and sign:\n${cancelCurrentGeneratedUrl}\n\nThank you,\nBill Layne Insurance Agency\n336-835-1993`;
        
        // Generate email template
        const emailMsg = `Subject: Action Required - Sign Cancellation Request for Policy ${policyNumber}\n\nDear ${insuredName},\n\nPer your request to cancel your ${policyType} policy, please complete the electronic cancellation form.\n\nPolicy Details:\n• Policy Number: ${policyNumber}\n• Insurance Company: ${company}\n• Cancellation Date: ${cancelFormatDate(cancelDate)}\n• Cancellation Time: ${document.getElementById('cancelCancelTime').value}\n• Reason: ${reason}\n\nPlease click the link below to review and sign your cancellation request:\n\n${cancelCurrentGeneratedUrl}\n\nIMPORTANT: Your coverage will terminate on the date and time shown above. Please ensure you have replacement coverage if needed.\n\nIf you have any questions or wish to discuss alternatives, please call us at 336-835-1993.\n\nThank you,\nBill Layne Insurance Agency\n1283 N Bridge St, Elkin NC 28621\nSave@BillLayneInsurance.com`;
        
        document.getElementById('cancelTextMessage').textContent = textMsg;
        document.getElementById('cancelEmailMessage').textContent = emailMsg;
        document.getElementById('cancelTextTemplate').style.display = 'block';
        document.getElementById('cancelEmailTemplate').style.display = 'block';
        
        // Scroll to results
        document.getElementById('cancelResultSection').scrollIntoView({ behavior: 'smooth' });
      }
      
      function cancelFormatDate(dateString) {
        const date = new Date(dateString + 'T00:00:00');
        return date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' });
      }
      
      function cancelCopyLink() {
        navigator.clipboard.writeText(cancelCurrentGeneratedUrl).then(function() {
          cancelShowCopyStatus('✔ Link copied to clipboard!');
        }).catch(function(err) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = cancelCurrentGeneratedUrl;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          cancelShowCopyStatus('✔ Link copied to clipboard!');
        });
      }
      
      function cancelEmailToCustomer() {
        const insuredName = document.getElementById('cancelInsuredName').value;
        const insuredEmail = document.getElementById('cancelInsuredEmail').value;
        const policyNumber = document.getElementById('cancelPolicyNumber').value;
        const policyType = document.getElementById('cancelPolicyType').value;
        const cancelDate = document.getElementById('cancelCancelDate').value;
        const cancelTime = document.getElementById('cancelCancelTime').value;
        const reason = document.getElementById('cancelReason').value;
        const company = document.getElementById('cancelCompany').value;
        
        if (!insuredEmail) {
          alert('Please enter customer email address first');
          document.getElementById('cancelInsuredEmail').focus();
          return;
        }
        
        // Create email subject
        const subject = `Action Required - Sign Cancellation Request for Policy ${policyNumber}`;
        
        // Create email body
        const body = `Dear ${insuredName},

Per your request to cancel your ${policyType} policy, please complete the electronic cancellation form.

Policy Details:
• Policy Number: ${policyNumber}
• Insurance Company: ${company}
• Cancellation Date: ${cancelFormatDate(cancelDate)}
• Cancellation Time: ${cancelTime}
• Reason: ${reason}

Please click the link below to review and sign your cancellation request:

${cancelCurrentGeneratedUrl}

IMPORTANT: Your coverage will terminate on the date and time shown above. Please ensure you have replacement coverage if needed.

If you have any questions or wish to discuss alternatives, please call us at 336-835-1993.

Thank you,
Bill Layne Insurance Agency
1283 N Bridge St, Elkin NC 28621
Save@BillLayneInsurance.com`;
        
        // Copy the email content to clipboard
        const emailContent = `To: ${insuredEmail}\nSubject: ${subject}\n\n${body}`;
        navigator.clipboard.writeText(emailContent).then(function() {
          cancelShowCopyStatus('✔ Email copied! Opening Gmail...');
        }).catch(function(err) {
          // Fallback if clipboard fails
          const textArea = document.createElement('textarea');
          textArea.value = emailContent;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          cancelShowCopyStatus('✔ Email copied! Opening Gmail...');
        });
        
        // Open Gmail compose in new tab
        const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(insuredEmail)}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.open(gmailUrl, '_blank');
      }
      
      function cancelCopyTextMessage() {
        const text = document.getElementById('cancelTextMessage').textContent;
        navigator.clipboard.writeText(text).then(function() {
          cancelShowCopyStatus('✔ Text message copied!');
        }).catch(function(err) {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          cancelShowCopyStatus('✔ Text message copied!');
        });
      }
      
      function cancelCopyEmailMessage() {
        const email = document.getElementById('cancelEmailMessage').textContent;
        navigator.clipboard.writeText(email).then(function() {
          cancelShowCopyStatus('✔ Email template copied!');
        }).catch(function(err) {
          const textArea = document.createElement('textarea');
          textArea.value = email;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          cancelShowCopyStatus('✔ Email template copied!');
        });
      }
      
      function cancelSendToAgencyMatrix() {
        const phone = document.getElementById('cancelInsuredPhone').value;
        
        if (!phone) {
          alert('Please enter a phone number to use Agency Matrix');
          document.getElementById('cancelInsuredPhone').focus();
          return;
        }
        
        const phoneDigits = phone.replace(/\D/g, '');
        
        if (phoneDigits.length < 10) {
          alert('Please enter a complete 10-digit phone number');
          return;
        }
        
        const textMessage = document.getElementById('cancelTextMessage').textContent;
        
        navigator.clipboard.writeText(textMessage).then(function() {
          cancelShowCopyStatus('✔ Text copied! Opening Agency Matrix - paste the message there');
          setTimeout(() => {
            const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneDigits}`;
            window.open(agencyMatrixUrl, '_blank');
          }, 1000);
        }).catch(function(err) {
          alert('Please copy the text message manually, then click OK to open Agency Matrix');
          const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneDigits}`;
          window.open(agencyMatrixUrl, '_blank');
        });
      }
      
      function cancelShowCopyStatus(message = '✔ Link copied to clipboard!') {
        const status = document.getElementById('cancelCopyStatus');
        status.textContent = message;
        status.style.display = 'block';
        setTimeout(() => {
          status.style.display = 'none';
        }, 3000);
      }
      
      function cancelClearForm() {
        if (confirm('Are you sure you want to clear all fields?')) {
          document.getElementById('cancelLinkGenerator').reset();
          document.getElementById('cancelResultSection').style.display = 'none';
          cancelCurrentGeneratedUrl = '';
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }
      
      // Set default values
      document.addEventListener('DOMContentLoaded', function() {
        // Set today's date as default for cancellation date
        const today = new Date().toISOString().split('T')[0];
        const cancelDateElement = document.getElementById('cancelCancelDate');
        if (cancelDateElement) {
          cancelDateElement.value = today;
        }
        
        // Auto-format phone number
        const phoneElement = document.getElementById('cancelInsuredPhone');
        if (phoneElement) {
          phoneElement.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
              if (value.length <= 3) {
                value = '(' + value;
              } else if (value.length <= 6) {
                value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
              } else {
                value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
              }
            }
            e.target.value = value;
          });
        }
      });
    </script>
  </div>

  <!-- PDF Viewer Modal -->
  <div id="pdfModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="pdfTitle"></h3>
        <span class="close" onclick="closePDFModal()">&times;</span>
      </div>
      <div class="modal-body">
        <iframe id="pdfViewer" style="width: 100%; height: 600px; border: none;"></iframe>
      </div>
      <div class="modal-footer">
        <button onclick="downloadCurrentPDF()">⬇️ Download</button>
        <button onclick="printCurrentPDF()">🖨️ Print</button>
        <button onclick="emailCurrentPDF()">📧 Email</button>
      </div>
    </div>
  </div>

  <!-- Helper function for downloading HTML files -->
  <script>
    function downloadHtmlFile(elementId, title) {
      const element = document.getElementById(elementId);
      const html = element.innerHTML;
      
      const fullHtml = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>${title}</title>
        </head>
        <body>
          ${html}
        </body>
        </html>
      `;
      
      const blob = new Blob([fullHtml], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const fileName = `${title.replace(/\s+/g, '_')}.html`;
      
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification(`Document saved as ${fileName}`, 'success');
    }
  </script>

  <!-- Load external JavaScript -->
  <script src="js/scripts.js"></script>
</body>
</html>