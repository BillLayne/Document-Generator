<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bill Layne Insurance - Document Generator & Resources</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <!-- PDF.js for PDF viewing (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  
  <!-- Authentication Check -->
  <script>
    // Check if user is authenticated
    if (sessionStorage.getItem('authenticated') !== 'true') {
      // Redirect to login page
      window.location.href = 'login.html';
    }
  </script>
</head>
<body>
  <!-- Navigation Tabs -->
  <div class="navigation-tabs">
    <button class="tab-button active" onclick="showTab('dashboard')">Dashboard</button>
    <button class="tab-button" onclick="showTab('generator')">Document Generator</button>
    <!-- PDF Templates tab hidden - now integrated into Document Generator dropdown -->
    <!-- <button class="tab-button" onclick="showTab('templates')">PDF Templates</button> -->
    <button class="tab-button" onclick="showTab('resources')">Resources</button>
    <button class="tab-button" onclick="showTab('prompts')">Prompt Manager</button>
    <button class="tab-button" onclick="showTab('html-converter')">HTML Converter</button>
    <button class="tab-button" onclick="showTab('snl')">SNL</button>
    <button class="tab-button" onclick="showTab('cancellation')">Cancellation</button>
    <button class="tab-button" onclick="logout()" style="float: right; background: linear-gradient(180deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226;">Logout</button>
  </div>

  <!-- Dashboard Tab (default active) -->
  <div id="dashboard-tab" class="tab-content active">
    <style>
      /* Dashboard specific styles */
      #dashboard-tab .dashboard-container{
        display:grid;
        grid-template-columns:1fr;
        gap:20px;
        max-width:1400px;
        margin:0 auto;
        padding:20px;
      }

      #dashboard-tab .dashboard-header{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 2px 4px rgba(0,0,0,0.1);
        padding:16px 20px;
        display:flex;
        align-items:center;
        justify-content:space-between;
        border:1px solid #e2e8f0;
      }

      #dashboard-tab .brand{
        display:flex;
        align-items:center;
        gap:12px;
      }

      #dashboard-tab .brand-logo{
        width:40px;
        height:40px;
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        border-radius:10px;
        display:flex;
        align-items:center;
        justify-content:center;
        color:white;
        font-weight:700;
        font-size:18px;
      }

      #dashboard-tab .main-content{
        display:grid;
        grid-template-columns:1fr 380px;
        gap:20px;
      }

      @media (max-width:1024px){
        #dashboard-tab .main-content{
          grid-template-columns:1fr;
        }
      }

      #dashboard-tab .search-card{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 4px 6px rgba(0,0,0,0.1);
        padding:24px;
        border:1px solid #e2e8f0;
        position:relative;
      }

      #dashboard-tab .search-card::before{
        content:'';
        position:absolute;
        top:0;
        left:0;
        right:0;
        height:4px;
        background:linear-gradient(90deg, #0f4c75, #3282b8, #0db4f3);
      }

      #dashboard-tab .mode-selector{
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
        gap:8px;
        margin-bottom:20px;
      }

      #dashboard-tab .mode-btn{
        border:2px solid #e2e8f0;
        background:#ffffff;
        color:#64748b;
        border-radius:8px;
        padding:12px 16px;
        font-weight:600;
        cursor:pointer;
        transition:all 0.2s;
        display:flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        font-size:14px;
      }

      #dashboard-tab .mode-btn:hover{
        transform:translateY(-2px);
        box-shadow:0 4px 6px rgba(0,0,0,0.1);
        border-color:#3282b8;
      }

      #dashboard-tab .mode-btn.active{
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        color:white;
        border-color:transparent;
      }

      #dashboard-tab .search-input{
        width:100%;
        border:2px solid #e2e8f0;
        background:#f8fafc;
        border-radius:8px;
        padding:14px 16px;
        font-size:15px;
        outline:none;
        transition:all 0.2s;
        margin-bottom:16px;
      }

      #dashboard-tab .search-input:focus{
        border-color:#0f4c75;
        background:#ffffff;
      }

      #dashboard-tab .search-actions{
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
        gap:10px;
      }

      #dashboard-tab .btn{
        border:none;
        cursor:pointer;
        font-weight:600;
        padding:12px 20px;
        border-radius:8px;
        transition:all 0.2s;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        font-size:14px;
      }

      #dashboard-tab .btn-primary{
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        color:white;
      }

      #dashboard-tab .btn-secondary{
        background:#f8fafc;
        color:#1e293b;
        border:2px solid #e2e8f0;
      }

      #dashboard-tab .stats-row{
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
        gap:12px;
        margin-top:20px;
        padding-top:20px;
        border-top:1px solid #e2e8f0;
      }

      #dashboard-tab .stat-card{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:12px;
        text-align:center;
      }

      #dashboard-tab .stat-value{
        font-size:24px;
        font-weight:700;
        color:#0f4c75;
      }

      #dashboard-tab .stat-label{
        font-size:12px;
        color:#64748b;
        text-transform:uppercase;
        letter-spacing:0.5px;
      }

      #dashboard-tab .portals-card{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 2px 4px rgba(0,0,0,0.1);
        padding:20px;
        border:1px solid #e2e8f0;
      }

      #dashboard-tab .portals-grid{
        display:grid;
        grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
        gap:12px;
      }

      #dashboard-tab .portal-tile{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:14px;
        cursor:pointer;
        transition:all 0.2s;
      }

      #dashboard-tab .portal-tile:hover{
        transform:translateY(-3px);
        box-shadow:0 4px 6px rgba(0,0,0,0.1);
        border-color:#3282b8;
      }

      #dashboard-tab .quick-panel{
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 2px 4px rgba(0,0,0,0.1);
        padding:20px;
        border:1px solid #e2e8f0;
      }

      #dashboard-tab .quick-btn{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:12px 16px;
        cursor:pointer;
        transition:all 0.2s;
        display:flex;
        align-items:center;
        gap:12px;
        text-align:left;
        width:100%;
        margin-bottom:10px;
      }

      #dashboard-tab .quick-btn:hover{
        background:linear-gradient(135deg, #0f4c75, #3282b8);
        border-color:transparent;
        transform:translateX(4px);
      }

      #dashboard-tab .quick-btn:hover * {
        color:white !important;
      }

      #dashboard-tab .quick-btn-title {
        color: #1e293b;
      }

      #dashboard-tab .quick-btn-desc {
        color: #64748b;
      }

      #dashboard-tab .favorites-grid{
        display:grid;
        gap:10px;
      }

      #dashboard-tab .favorite-item{
        background:#f8fafc;
        border:1px solid #e2e8f0;
        border-radius:8px;
        padding:12px;
        display:flex;
        align-items:center;
        gap:12px;
        cursor:pointer;
        transition:all 0.2s;
      }

      #dashboard-tab .favorite-item:hover{
        background:#ffffff;
        border-color:#3282b8;
        padding-left:16px;
      }
    </style>

    <div class="dashboard-container">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <div class="brand">
          <div class="brand-logo">BL</div>
          <div class="brand-text">
            <div style="font-size:18px;font-weight:700;color:#1e293b">Customer Matrix Pro</div>
            <div style="font-size:12px;color:#64748b">Bill Layne Insurance Command Center</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
          <button class="icon-btn" id="dash-toolsToggle" title="AI Tools" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:8px 12px;cursor:pointer;transition:all 0.2s;font-size:12px;font-weight:600;display:inline-flex;align-items:center;gap:6px">
            <i class="fas fa-robot"></i> AI Tools
          </button>
          <div style="display:flex;align-items:center;gap:8px;padding:6px 12px;background:#f8fafc;border-radius:999px;border:1px solid #e2e8f0">
            <div style="width:8px;height:8px;border-radius:50%;background:#10b981;animation:pulse 2s infinite"></div>
            <span style="font-size:12px;font-weight:600">Systems Online</span>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="main-content">
        <!-- Primary Section -->
        <div class="primary-section">
          <!-- Enhanced Search Hub -->
          <div class="search-card">
            <div style="margin-bottom:20px">
              <h2 style="font-size:20px;font-weight:700;margin:0 0 8px 0;display:flex;align-items:center;gap:10px">
                <i class="fas fa-search"></i>
                Unified Customer Search
                <span style="background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px">Pro</span>
              </h2>
              <div style="font-size:13px;color:#64748b">
                Quick access: Press <kbd style="background:#f8fafc;border:1px solid #e2e8f0;padding:2px 6px;border-radius:4px;font-family:monospace;font-size:11px">/</kbd> to focus search
              </div>
            </div>

            <!-- Mode Selector -->
            <div class="mode-selector" id="dash-modeBar">
              <button class="mode-btn active" data-mode="agency">
                <i class="fas fa-shield-alt"></i> Agency Matrix
              </button>
              <button class="mode-btn" data-mode="web">
                <i class="fab fa-google"></i> Web Search
              </button>
              <button class="mode-btn" data-mode="realestate">
                <i class="fas fa-home"></i> Real Estate
              </button>
              <button class="mode-btn" data-mode="people">
                <i class="fas fa-user"></i> People
              </button>
              <button class="mode-btn" data-mode="onedrive">
                <i class="fas fa-cloud"></i> OneDrive
              </button>
            </div>

            <!-- Search Input -->
            <input id="dash-search" class="search-input" placeholder="Search Agency Matrix by name, phone, or address‚Ä¶" autocomplete="off"/>

            <!-- Action Buttons -->
            <div class="search-actions">
              <button class="btn btn-primary" id="dash-goBtn">
                <i class="fas fa-search"></i> Search
              </button>
              <button class="btn btn-secondary" id="dash-openAM">
                <i class="fas fa-external-link-alt"></i> Open Matrix
              </button>
              <button class="btn btn-secondary" id="dash-addCustomer">
                <i class="fas fa-user-plus"></i> Add Customer
              </button>
              <button class="btn btn-secondary" id="dash-taxBtn" style="display:none">
                <i class="fas fa-map-pin"></i> Tax GIS
              </button>
            </div>

            <!-- Quick Stats -->
            <div class="stats-row">
              <div class="stat-card">
                <div class="stat-value" id="dash-searchCount">0</div>
                <div class="stat-label">Searches Today</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">7</div>
                <div class="stat-label">Active Portals</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dash-favoriteCount">0</div>
                <div class="stat-label">Favorites</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">--</div>
                <div class="stat-label">Last Sync</div>
              </div>
            </div>
          </div>

          <!-- Insurance Company Portals -->
          <div class="portals-card">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
              <h3 style="font-size:16px;font-weight:700;margin:0">
                <i class="fas fa-building"></i> Insurance Company Portals
              </h3>
            </div>
            <div class="portals-grid" id="dash-portalGrid">
              <!-- Portals will be dynamically added here -->
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Quick Actions - Claude AI Projects -->
          <div class="quick-panel">
            <h3 style="font-size:16px;font-weight:700;margin:0 0 16px 0">
              <i class="fas fa-robot"></i> Quick AI Actions
              <span style="font-size:10px;background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;padding:2px 6px;border-radius:999px;margin-left:8px">CLAUDE</span>
            </h3>
            <div class="quick-actions">
              <button class="quick-btn" onclick="window.open('https://claude.ai/project/01993948-a57c-7166-ae81-c547e60fe8fa','_blank')">
                <div style="width:36px;height:36px;background:linear-gradient(135deg, #dc2626, #ef4444);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0">
                  <i class="fas fa-file-pdf"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Create PDF Document</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">Claude PDF generator project</div>
                </div>
              </button>
              <button class="quick-btn" onclick="window.open('https://claude.ai/project/0198f624-8a25-73be-a9e1-98389bc44b2c','_blank')">
                <div style="width:36px;height:36px;background:linear-gradient(135deg, #059669, #10b981);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0">
                  <i class="fas fa-home"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Home Address Research</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">Property & address analysis</div>
                </div>
              </button>
              <button class="quick-btn" onclick="window.open('https://claude.ai/project/0197c35a-7c70-72f7-8d5c-83df3286f0a4','_blank')">
                <div style="width:36px;height:36px;background:linear-gradient(135deg, #7c3aed, #a855f7);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0">
                  <i class="fas fa-car"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Auto Quote Template</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">Generate auto insurance quotes</div>
                </div>
              </button>
              <button class="quick-btn" onclick="window.open('https://agents.agencymatrix.com/#/reports','_blank')">
                <div style="width:36px;height:36px;background:#e2e8f0;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#0f4c75;flex-shrink:0">
                  <i class="fas fa-chart-bar"></i>
                </div>
                <div style="flex:1">
                  <div class="quick-btn-title" style="font-weight:600;font-size:14px;margin:0 0 2px 0">Reports</div>
                  <div class="quick-btn-desc" style="font-size:12px;opacity:0.8;margin:0">View analytics</div>
                </div>
              </button>
            </div>
          </div>

          <!-- Favorites -->
          <div class="quick-panel">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
              <h3 style="font-size:16px;font-weight:700;margin:0">
                <i class="fas fa-star"></i> Quick Access Favorites
              </h3>
              <div style="display:flex;gap:8px">
                <button class="icon-btn" id="dash-addFav" title="Add Favorite" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s;font-size:11px;display:inline-flex;align-items:center;gap:4px">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="icon-btn" id="dash-exportFavs" title="Export" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s;font-size:11px;display:inline-flex;align-items:center;gap:4px">
                  <i class="fas fa-download"></i>
                </button>
                <button class="icon-btn" id="dash-importFavs" title="Import" style="border:1px solid #e2e8f0;background:#ffffff;color:#64748b;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s;font-size:11px;display:inline-flex;align-items:center;gap:4px">
                  <i class="fas fa-upload"></i>
                </button>
              </div>
            </div>
            <div class="favorites-grid" id="dash-favGrid">
              <div style="text-align:center;padding:20px;color:#64748b" id="dash-no-favs">
                No favorites yet. Add your frequently accessed links.
              </div>
            </div>
            <input type="file" id="dash-favFile" accept=".json" style="display:none"/>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Dashboard specific JavaScript
      (function(){
        // Dashboard search mode handling
        let dashSearchMode = "agency";
        const dashModeMeta = {
          agency: { placeholder:"Search Agency Matrix by name, phone, or address‚Ä¶", showTax:false },
          web: { placeholder:"Search the web‚Ä¶", showTax:false },
          realestate: { placeholder:"Enter full address (City, NC)‚Ä¶", showTax:true },
          people: { placeholder:"Enter name, phone, or address‚Ä¶", showTax:false },
          onedrive: { placeholder:"Search OneDrive files‚Ä¶", showTax:false }
        };

        function setDashMode(mode){
          dashSearchMode = mode;
          document.querySelectorAll("#dash-modeBar button").forEach(b=>{
            b.classList.toggle("active", b.dataset.mode===mode);
          });
          const q = document.getElementById("dash-search");
          q.placeholder = dashModeMeta[mode].placeholder;
          document.getElementById("dash-taxBtn").style.display = dashModeMeta[mode].showTax ? "" : "none";
          q.focus();
        }

        document.querySelectorAll("#dash-modeBar button").forEach(btn=>
          btn.addEventListener("click", ()=>setDashMode(btn.dataset.mode))
        );

        // Dashboard search function
        function dashSearch(){
          const val = document.getElementById("dash-search").value.trim();
          if(!val){
            alert("Please enter a search term");
            return;
          }

          // Update search count
          let searchesToday = parseInt(localStorage.getItem("searchesToday")||"0") + 1;
          localStorage.setItem("searchesToday", searchesToday.toString());
          document.getElementById("dash-searchCount").textContent = searchesToday;

          if(dashSearchMode==="agency"){
            // Check if it's a phone number (10 digits with or without formatting)
            const phoneDigitsOnly = val.replace(/\D/g, '');
            const isPhone = phoneDigitsOnly.length === 10 && /^\d{10}$/.test(phoneDigitsOnly);

            let selection;
            let searchQuery = val;

            if (isPhone) {
              selection = "Phone";
              searchQuery = phoneDigitsOnly; // Use clean phone number for phone search
            } else {
              const isAddress = /\d+/.test(val) || /(street|st|ave|avenue|road|rd|drive|dr|lane|ln|blvd|boulevard|court|ct|circle|cir|way|wy)/i.test(val);
              selection = isAddress ? "Address" : "Name";
            }

            const url = `https://agents.agencymatrix.com/#/customer/search?selection=${selection}&query=${encodeURIComponent(searchQuery)}`;
            window.open(url, "_blank");
            document.getElementById("dash-search").value="";
            return;
          }
          if(dashSearchMode==="web"){
            window.open(`https://www.google.com/search?q=${encodeURIComponent(val)}`, "_blank");
            return;
          }
          if(dashSearchMode==="realestate"){
            window.open(`https://www.zillow.com/homes/${encodeURIComponent(val)}_rb/`, "_blank");
            return;
          }
          if(dashSearchMode==="people"){
            window.open(`https://www.truepeoplesearch.com/results?name=${encodeURIComponent(val)}`, "_blank");
            return;
          }
          if(dashSearchMode==="onedrive"){
            window.open(`https://onedrive.live.com/?id=root&qt=search&q=${encodeURIComponent(val)}&scope=drive`, "_blank");
            return;
          }
        }

        document.getElementById("dash-goBtn").addEventListener("click", dashSearch);
        document.getElementById("dash-search").addEventListener("keydown", e=>{
          if(e.key==="Enter") dashSearch();
        });

        // Quick buttons
        document.getElementById("dash-openAM").addEventListener("click", ()=>
          window.open("https://agents.agencymatrix.com/#/", "_blank")
        );
        document.getElementById("dash-addCustomer").addEventListener("click", ()=>
          window.open("https://agents.agencymatrix.com/customerEdit.php?id=0", "_blank")
        );

        // Keyboard shortcut for search focus
        document.addEventListener("keydown", (e)=>{
          if(e.key==="/" && !e.ctrlKey && !e.metaKey && !e.altKey && document.getElementById("dashboard-tab").style.display !== "none"){
            e.preventDefault();
            document.getElementById("dash-search").focus();
            document.getElementById("dash-search").select();
          }
        });

        // Render portals
        function renderDashPortals(){
          const defaultPortals = [
            { name:"Agency Matrix", url:"https://agents.agencymatrix.com/#/", icon:"fas fa-shield-alt", description:"Primary agent portal" },
            { name:"Nationwide", url:"https://agentcenter.nationwide.com/home", icon:"fas fa-flag-usa", description:"Agent center portal" },
            { name:"National General", url:"https://natgenagency.com/MainMenu.aspx", icon:"fas fa-globe", description:"Agency portal" },
            { name:"Progressive", url:"https://www.foragentsonly.com/home/?Welcome=400", icon:"fas fa-chart-line", description:"For agents only portal" },
            { name:"Foremost", url:"https://www.foremostagent.com/ia/portal/login", icon:"fas fa-house-user", description:"Agent portal login" },
            { name:"Alamance", url:"https://alamance.britecore.com/agent/misc/ko_dashboard", icon:"fas fa-shield-alt", description:"BriteCore dashboard" },
            { name:"NC Grange", url:"https://ncgm.com/", icon:"fas fa-leaf", description:"NC Grange portal" }
          ];

          const grid = document.getElementById("dash-portalGrid");
          grid.innerHTML = defaultPortals.map(p=>`
            <div class="portal-tile" onclick="window.open('${p.url}','_blank')" title="Open ${p.name}">
              <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
                <div style="width:32px;height:32px;background:linear-gradient(135deg, #0f4c75, #3282b8);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-size:14px">
                  <i class="${p.icon}"></i>
                </div>
              </div>
              <h4 style="font-weight:600;font-size:14px;color:#1e293b;margin:0">${p.name}</h4>
              <p style="font-size:12px;color:#64748b;margin:0;line-height:1.4">${p.description}</p>
            </div>
          `).join("");
        }

        // Initialize dashboard
        renderDashPortals();

        // Update counts
        let searchesToday = parseInt(localStorage.getItem("searchesToday")||"0");
        document.getElementById("dash-searchCount").textContent = searchesToday;

        let favorites = JSON.parse(localStorage.getItem("matrixFavorites_v2")||"[]");
        document.getElementById("dash-favoriteCount").textContent = favorites.length;

        // Reset search count daily
        const today = new Date().toDateString();
        if(localStorage.getItem("searchDate") !== today){
          localStorage.setItem("searchDate", today);
          localStorage.setItem("searchesToday", "0");
          document.getElementById("dash-searchCount").textContent = "0";
        }

        // Favorites Management
        function renderDashFavorites(){
          const grid = document.getElementById("dash-favGrid");
          const favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          document.getElementById("dash-favoriteCount").textContent = favs.length;

          if(favs.length === 0){
            grid.innerHTML = `<div style="text-align:center;padding:20px;color:#64748b">
              No favorites yet. Add your frequently accessed links.
            </div>`;
            return;
          }

          grid.innerHTML = favs.map(f=>`
            <div class="favorite-item" onclick="window.open('${f.url}','_blank')" title="Open ${f.name}" style="position:relative">
              <div style="width:30px;height:30px;background:linear-gradient(135deg, #0f4c75, #3282b8);border-radius:6px;display:flex;align-items:center;justify-content:center;color:white;font-size:12px;flex-shrink:0">
                <i class="fas fa-star"></i>
              </div>
              <div style="flex:1;min-width:0">
                <div style="font-weight:600;font-size:13px;margin:0 0 2px 0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${f.name}</div>
                <div style="font-size:11px;color:#64748b;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${f.description||f.url}</div>
              </div>
              <button onclick="removeDashFavorite('${f.id}');event.stopPropagation();" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:#64748b;cursor:pointer;padding:4px;opacity:0;transition:all 0.2s" onmouseover="this.style.opacity='1';this.style.color='#ef4444'" onmouseout="this.style.opacity='0'">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `).join("");

          // Add hover effect to show delete button
          grid.querySelectorAll('.favorite-item').forEach(item => {
            item.addEventListener('mouseenter', () => {
              const btn = item.querySelector('button');
              if(btn) btn.style.opacity = '1';
            });
            item.addEventListener('mouseleave', () => {
              const btn = item.querySelector('button');
              if(btn) btn.style.opacity = '0';
            });
          });
        }

        function removeDashFavorite(id){
          let favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          favs = favs.filter(f=>f.id!==id);
          localStorage.setItem("dashFavorites", JSON.stringify(favs));
          renderDashFavorites();
        }

        // Add favorite button handler
        document.getElementById("dash-addFav").addEventListener("click", ()=>{
          const name = prompt("Favorite name:");
          if(!name) return;
          const url = prompt("URL:");
          if(!url) return;
          const desc = prompt("Description (optional):") || "";
          const cleanUrl = url.startsWith("http") ? url : `https://${url}`;
          try{ new URL(cleanUrl); }catch{ alert("Invalid URL"); return; }
          const fav = {
            id: String(Date.now()),
            name: name.trim(),
            url: cleanUrl.trim(),
            description: desc.trim()
          };
          let favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          favs.push(fav);
          localStorage.setItem("dashFavorites", JSON.stringify(favs));
          renderDashFavorites();
        });

        // Export favorites
        document.getElementById("dash-exportFavs").addEventListener("click", ()=>{
          const favs = JSON.parse(localStorage.getItem("dashFavorites")||"[]");
          const searchesToday = localStorage.getItem("searchesToday")||"0";
          const data = {
            favorites: favs,
            searchesToday: searchesToday,
            exportDate: new Date().toISOString(),
            version: "1.0"
          };
          const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `dashboard-favorites-${new Date().toISOString().split("T")[0]}.json`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        });

        // Import favorites
        document.getElementById("dash-importFavs").addEventListener("click", ()=>
          document.getElementById("dash-favFile").click()
        );

        document.getElementById("dash-favFile").addEventListener("change", (e)=>{
          const file = e.target.files[0];
          if(!file) return;
          const reader = new FileReader();
          reader.onload = ()=>{
            try{
              const data = JSON.parse(reader.result);
              if(!data.favorites || !Array.isArray(data.favorites)){
                throw new Error("Invalid file format");
              }
              const replace = confirm("Replace existing favorites?\nOK = Replace, Cancel = Merge");
              let favs = replace ? [] : JSON.parse(localStorage.getItem("dashFavorites")||"[]");
              if(!replace){
                const urls = new Set(favs.map(f=>f.url));
                const newFavs = data.favorites.filter(f=>!urls.has(f.url));
                favs = [...favs, ...newFavs];
              } else {
                favs = data.favorites;
              }
              localStorage.setItem("dashFavorites", JSON.stringify(favs));
              renderDashFavorites();
              alert("Favorites imported successfully!");
            }catch(err){
              alert("Failed to import file: " + err.message);
            }
            e.target.value = "";
          };
          reader.readAsText(file);
        });

        // AI Tools Panel
        document.getElementById("dash-toolsToggle").addEventListener("click", function(){
          // Create AI tools panel if it doesn't exist
          let panel = document.getElementById("dash-aiToolsPanel");
          if(!panel){
            panel = document.createElement("div");
            panel.id = "dash-aiToolsPanel";
            panel.style.cssText = `
              position:fixed;
              right:20px;
              top:80px;
              width:400px;
              max-height:80vh;
              background:#ffffff;
              border-radius:12px;
              box-shadow:0 10px 25px rgba(0,0,0,0.2);
              border:1px solid #e2e8f0;
              padding:20px;
              z-index:9999;
              overflow-y:auto;
              display:none;
            `;
            panel.innerHTML = `
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                <h3 style="font-size:16px;font-weight:700;margin:0">
                  <i class="fas fa-robot"></i> AI Insurance Assistant
                </h3>
                <button onclick="document.getElementById('dash-aiToolsPanel').style.display='none'" style="background:transparent;border:none;cursor:pointer;font-size:18px;color:#64748b">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <div style="margin-bottom:16px">
                <label style="font-size:12px;color:#64748b;font-weight:600;display:block;margin-bottom:8px">QUICK TEMPLATES</label>
                <div style="display:grid;gap:6px">
                  <button class="template-btn" onclick="setAITemplate('quote')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-file-invoice-dollar"></i> Generate Quote Comparison
                  </button>
                  <button class="template-btn" onclick="setAITemplate('coverage')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-shield-alt"></i> Explain Coverage
                  </button>
                  <button class="template-btn" onclick="setAITemplate('claim')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-file-contract"></i> Draft Claim Letter
                  </button>
                  <button class="template-btn" onclick="setAITemplate('email')" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#64748b;text-align:left">
                    <i class="fas fa-envelope"></i> Customer Email
                  </button>
                </div>
              </div>

              <textarea id="dash-aiPrompt" style="width:100%;border:1px solid #e2e8f0;background:#f8fafc;border-radius:8px;padding:12px;font-size:14px;min-height:100px;resize:vertical;font-family:inherit;margin-bottom:12px" placeholder="Type your custom prompt or select a template above..."></textarea>

              <div style="display:grid;gap:8px">
                <button onclick="openAIWithPrompt()" style="background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;border:none;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">
                  <i class="fas fa-robot"></i> Open Claude with Prompt
                </button>
                <button onclick="copyAIPrompt()" style="background:#f8fafc;color:#1e293b;border:2px solid #e2e8f0;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">
                  <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
              </div>
            `;
            document.body.appendChild(panel);
          }

          // Toggle panel visibility
          panel.style.display = panel.style.display === "none" ? "block" : "none";
        });

        // AI Template functions
        window.setAITemplate = function(type){
          const templates = {
            quote: "I need to create a comprehensive insurance quote comparison for a customer. Please help me analyze and present the following options:\n\nCustomer Details:\n[Enter customer name, age, location]\n\nCoverage Needed:\n[Auto/Home/Life/etc.]\n\nCarriers to Compare:\n- Nationwide\n- Progressive\n- [Other carriers]\n\nPlease provide a clear comparison table with coverage limits, deductibles, and annual premiums. Include pros/cons for each option and a recommendation based on the customer's needs.\n\nAgency: Bill Layne Insurance, Elkin NC",
            coverage: "Please explain the following insurance coverage in simple, customer-friendly terms:\n\nCoverage Type: [Enter coverage type]\n\nCustomer Situation: [Brief description]\n\nInclude:\n1. What this coverage protects\n2. Common scenarios when it's used\n3. What's NOT covered\n4. Typical cost factors\n5. NC-specific requirements\n\nAgency: Bill Layne Insurance, Elkin NC",
            claim: "Help me draft a professional claim letter/email:\n\nClaim Type: [Auto accident/Property damage/etc.]\n\nCarrier: [Insurance company name]\n\nSituation:\n[Describe the incident]\n\nDesired Outcome:\n[What resolution we're seeking]\n\nTone: Professional but firm, representing Bill Layne Insurance Agency.",
            email: "Draft a professional email to a customer:\n\nPurpose: [Renewal reminder/Policy change/Follow-up/etc.]\n\nCustomer: [Name and brief context]\n\nKey Points to Cover:\n[List main points]\n\nBill Layne Insurance Agency\n336-835-1993\nSave@BillLayneInsurance.com"
          };
          const textarea = document.getElementById("dash-aiPrompt");
          if(textarea && templates[type]){
            textarea.value = templates[type];
          }
        };

        window.openAIWithPrompt = function(){
          const prompt = document.getElementById("dash-aiPrompt").value.trim();
          if(!prompt){
            alert("Please enter or select a prompt");
            return;
          }
          navigator.clipboard.writeText(prompt).then(()=>{
            window.open("https://claude.ai/new", "_blank");
          }).catch(()=>{
            const ta = document.createElement("textarea");
            ta.value = prompt;
            ta.style.position = "fixed";
            ta.style.opacity = "0";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            window.open("https://claude.ai/new", "_blank");
          });
        };

        window.copyAIPrompt = function(){
          const prompt = document.getElementById("dash-aiPrompt").value.trim();
          if(!prompt){
            alert("Nothing to copy");
            return;
          }
          navigator.clipboard.writeText(prompt).then(()=>{
            alert("Prompt copied to clipboard!");
          }).catch(()=>{
            const ta = document.createElement("textarea");
            ta.value = prompt;
            ta.style.position = "fixed";
            ta.style.opacity = "0";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            alert("Prompt copied to clipboard!");
          });
        };

        window.removeDashFavorite = removeDashFavorite;

        // Initialize favorites
        renderDashFavorites();

        // Tax GIS Modal and Functionality
        const countyTax = {
          "mecklenburg":{name:"Mecklenburg County",url:"https://property.spatialest.com/nc/mecklenburg/"},
          "wake":{name:"Wake County",url:"https://services.wake.gov/realestate/"},
          "guilford":{name:"Guilford County",url:"https://guilford.county-taxes.com/public/search/property_address"},
          "forsyth":{name:"Forsyth County",url:"https://gis.forsyth.cc/parcelviewer/"},
          "iredell":{name:"Iredell County",url:"https://taxweb.iredellcountync.gov/PublicAccess/RealEstate.aspx"},
          "cabarrus":{name:"Cabarrus County",url:"https://tax.cabarruscounty.us/"},
          "rowan":{name:"Rowan County",url:"https://rowan.county-taxes.com/public/search/property_address"},
          "union":{name:"Union County",url:"https://www.co.union.nc.us/departments/tax_administration/real_estate_search.php"},
          "gaston":{name:"Gaston County",url:"https://gaston.county-taxes.com/public/search/property_address"},
          "davidson":{name:"Davidson County",url:"https://davidson.county-taxes.com/public/search/property_address"},
          "surry":{name:"Surry County",url:"http://www.gis.surryinfo.net/"},
          "yadkin":{name:"Yadkin County",url:"https://www.bttaxpayerportal.com/ITSPublicYK/"},
          "wilkes":{name:"Wilkes County",url:"https://wilkes.county-taxes.com/public/search/property_address"},
          "stokes":{name:"Stokes County",url:"https://stokes.county-taxes.com/public/search/property_address"},
          "lee":{name:"Lee County",url:"https://taxaccess.leecountync.gov/pt/search/commonsearch.aspx?mode=realprop"},
          "chatham":{name:"Chatham County",url:"https://chatham.county-taxes.com/public/search/property_address"},
          "moore":{name:"Moore County",url:"https://moore.county-taxes.com/public/search/property_address"},
          "harnett":{name:"Harnett County",url:"https://harnett.county-taxes.com/public/search/property_address"}
        };

        const cityToCounty = {
          "charlotte":"mecklenburg","raleigh":"wake","greensboro":"guilford","winston-salem":"forsyth",
          "statesville":"iredell","mooresville":"iredell","concord":"cabarrus","kannapolis":"cabarrus",
          "salisbury":"rowan","monroe":"union","gastonia":"gaston","lexington":"davidson",
          "mount airy":"surry","pilot mountain":"surry","dobson":"surry","elkin":"surry",
          "yadkinville":"yadkin","boonville":"yadkin","east bend":"yadkin","jonesville":"yadkin",
          "wilkesboro":"wilkes","north wilkesboro":"wilkes","danbury":"stokes","walnut cove":"stokes","king":"stokes"
        };

        function guessCounty(address){
          const s = address.toLowerCase();
          for(const [city,county] of Object.entries(cityToCounty)){
            if(s.includes(city)) return county;
          }
          for(const c of Object.keys(countyTax)){
            if(s.includes(c+" county")||s.includes(c)) return c;
          }
          return null;
        }

        // Create Tax Modal if it doesn't exist
        if(!document.getElementById("dash-taxModal")){
          const modal = document.createElement("div");
          modal.id = "dash-taxModal";
          modal.style.cssText = `
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.5);
            display:none;
            align-items:center;
            justify-content:center;
            z-index:9998;
            backdrop-filter:blur(4px);
          `;
          modal.innerHTML = `
            <div style="background:#ffffff;border-radius:12px;box-shadow:0 20px 25px rgba(0,0,0,0.2);padding:24px;max-width:500px;width:90%;animation:modalIn 0.3s ease">
              <h3 style="font-size:18px;font-weight:700;margin:0 0 16px 0">Tax GIS Search</h3>
              <div id="dash-taxBody" style="margin-bottom:20px;color:#64748b"></div>
              <div style="display:flex;gap:10px;justify-content:flex-end">
                <button class="btn btn-primary" id="dash-openCounty" style="background:linear-gradient(135deg, #0f4c75, #3282b8);color:white;border:none;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">
                  <i class="fas fa-external-link-alt"></i> Open County Site
                </button>
                <button class="btn btn-secondary" id="dash-closeTax" style="background:#f8fafc;color:#1e293b;border:2px solid #e2e8f0;cursor:pointer;font-weight:600;padding:12px 20px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;gap:8px;font-size:14px">Cancel</button>
              </div>
            </div>
          `;
          document.body.appendChild(modal);

          // Add modal close handlers
          document.getElementById("dash-closeTax").addEventListener("click", ()=>{
            document.getElementById("dash-taxModal").style.display = "none";
          });

          document.getElementById("dash-taxModal").addEventListener("click", (e)=>{
            if(e.target.id === "dash-taxModal"){
              document.getElementById("dash-taxModal").style.display = "none";
            }
          });
        }

        // Tax Button Handler
        document.getElementById("dash-taxBtn").addEventListener("click", ()=>{
          const addr = document.getElementById("dash-search").value.trim();
          if(!addr){
            alert("Enter an address first");
            document.getElementById("dash-search").focus();
            return;
          }
          const c = guessCounty(addr);
          const body = document.getElementById("dash-taxBody");
          let info, url;
          if(c && countyTax[c]){
            info = `<strong>Address:</strong> ${addr}<br><strong>County:</strong> ${countyTax[c].name}`;
            url = countyTax[c].url;
          } else {
            info = `Could not determine county from:<br><em>${addr}</em><br><br>Please ensure the address includes the city name or county.`;
            url = null;
          }
          body.innerHTML = info;
          const openBtn = document.getElementById("dash-openCounty");
          openBtn.disabled = !url;
          openBtn.onclick = ()=>{ if(url) window.open(url, "_blank"); };
          document.getElementById("dash-taxModal").style.display = "flex";
        });
      })();
    </script>
  </div>

  <!-- Document Generator Tab (main content) -->
  <div id="generator-tab" class="tab-content" style="display: none;">
    <div class="form-container">
      <h2>Insurance Document Generator - Multi-Template</h2>
      
      <!-- Template Selector -->
      <div class="template-selector">
        <label for="documentType">Select Document Type:</label>
        <select id="documentType" onchange="switchTemplate()">
          <option value="closing">Home Closing Package (Declaration & Invoice)</option>
          <option value="binder">Binder Letter</option>
          <option value="mortgagee-change">Mortgagee Change Letter</option>
          <option value="cancellation">Cancellation Notice</option>
          <option value="renewal">Renewal Notice</option>
          <option value="coverage-change">Coverage Change Confirmation</option>
          <option value="payment-receipt">Payment Receipt</option>
          <option value="claim-info">Claim Information Sheet</option>
          <option value="dl123">DL-123 Driver License Insurance Certification</option>
          <option value="underwriting">Underwriting Email Template</option>
          <option value="letterhead">Professional Letterhead</option>
          <option value="envelope">Envelope</option>
          <option value="auto-id-card">Auto ID Card Maker</option>
          <option value="pdf-templates">PDF Template Library</option>
        </select>
      </div>

      <!-- Template Description -->
      <div id="templateDescription" class="template-description">
        Select a document type above to begin. Each template is designed for specific insurance documentation needs.
      </div>
      
      <!-- Save/Load buttons -->
      <div class="no-print" style="text-align: right; margin-bottom: 20px;">
        <button type="button" onclick="saveFormData()" class="save-btn">üíæ Save Form Data</button>
        <button type="button" onclick="loadFormData()" class="load-btn">üìÇ Load Saved Data</button>
        <button type="button" onclick="clearForm()" class="clear-btn">üóëÔ∏è Clear Form</button>
      </div>

      <!-- Common Fields Section (shown for all templates) -->
      <div class="form-section active" id="commonFields">
        <div class="section-title">Agency & Company Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insurance Company</label>
            <select id="insuranceCompany" onchange="updateAgencyCodeDL123()">
              <option value="">Select Company</option>
              <option value="Nationwide">Nationwide</option>
              <option value="Progressive">Progressive</option>
              <option value="National General">National General</option>
              <option value="Alamance">Alamance</option>
              <option value="Travelers">Travelers</option>
              <option value="NC Grange Mutual">NC Grange Mutual</option>
              <option value="Universal Property">Universal Property</option>
              <option value="Dairyland">Dairyland</option>
              <option value="Allstate">Allstate</option>
              <option value="Foremost">Foremost</option>
              <option value="JSA">JSA</option>
              <option value="NCJUA">NCJUA</option>
            </select>
          </div>
          <div class="form-group">
            <label>Policy Number</label>
            <input type="text" id="policyNumber" />
          </div>
        </div>
      </div>

      <!-- Insured Information (most templates) -->
      <div class="form-section" id="insuredSection">
        <div class="section-title">Insured Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Policyholder Name</label>
            <input type="text" id="policyholderName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Address Line 1</label>
            <input type="text" id="addressLine1" />
          </div>
          <div class="form-group">
            <label>Address Line 2</label>
            <input type="text" id="addressLine2" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="city" />
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="state" value="NC" />
          </div>
          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" id="zipCode" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" id="phoneNumber" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="emailAddress" />
          </div>
        </div>
      </div>

      <!-- Policy Dates Section -->
      <div class="form-section" id="policyDatesSection">
        <div class="section-title">Policy Dates</div>
        <div class="form-row">
          <div class="form-group">
            <label>Effective Date</label>
            <input type="date" id="effectiveDate" onchange="updateExpirationDate()" />
          </div>
          <div class="form-group">
            <label>Expiration Date</label>
            <input type="date" id="expirationDate" />
          </div>
        </div>
      </div>

      <!-- Coverage Information (for closing, binder, renewal, coverage change) -->
      <div class="form-section" id="coverageSection">
        <div class="section-title">Coverage Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Coverage A - Dwelling</label>
            <input type="number" id="coverageA" min="0" step="1000" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Deductible</label>
            <input type="number" id="deductible" min="0" step="100" />
          </div>
          <div class="form-group">
            <label>Annual Premium</label>
            <input type="number" id="annualPremium" min="0" step="0.01" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Wind and Hail Deductible</label>
            <input type="text" id="windHailDeductible" placeholder="e.g., 1% or $2500" />
          </div>
          <div class="form-group">
            <label>Replacement Cost</label>
            <select id="replacementCost">
              <option value="100%">100%</option>
              <option value="125%">125%</option>
              <option value="150%">150%</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Mortgage Information -->
      <div class="form-section" id="mortgageeSection">
        <div class="section-title">Mortgage Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Mortgagee Name</label>
            <input type="text" id="mortgageeName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Mortgagee Address Line 1</label>
            <input type="text" id="mortgageeAddressLine1" />
          </div>
          <div class="form-group">
            <label>Mortgagee Address Line 2</label>
            <input type="text" id="mortgageeAddressLine2" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="mortgageeCity" />
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="mortgageeState" value="NC" />
          </div>
          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" id="mortgageeZipCode" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Loan Number</label>
            <input type="text" id="loanNumber" />
          </div>
        </div>
      </div>

      <!-- Attorney Information (for closing) -->
      <div class="form-section" id="attorneySection">
        <div class="section-title">Closing Attorney Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Attorney/Law Firm Name</label>
            <input type="text" id="attorneyName" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="attorneyEmail" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Address Line 1</label>
            <input type="text" id="attorneyAddressLine1" />
          </div>
          <div class="form-group">
            <label>Address Line 2</label>
            <input type="text" id="attorneyAddressLine2" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="attorneyCity" />
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="attorneyState" value="NC" />
          </div>
          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" id="attorneyZipCode" />
          </div>
        </div>
      </div>

      <!-- Cancellation Specific Fields -->
      <div class="form-section" id="cancellationSection">
        <div class="section-title">Cancellation Details</div>
        <div class="form-row">
          <div class="form-group">
            <label>Cancellation Date</label>
            <input type="date" id="cancellationDate" />
          </div>
          <div class="form-group">
            <label>Cancellation Reason</label>
            <select id="cancellationReason">
              <option value="">Select Reason</option>
              <option value="nonpayment">Non-Payment</option>
              <option value="insured-request">Insured Request</option>
              <option value="underwriting">Underwriting Decision</option>
              <option value="sold">Property Sold</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Additional Notes</label>
            <textarea id="cancellationNotes" rows="3"></textarea>
          </div>
        </div>
      </div>

      <!-- Renewal Specific Fields -->
      <div class="form-section" id="renewalSection">
        <div class="section-title">Renewal Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Current Premium</label>
            <input type="number" id="currentPremium" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>Renewal Premium</label>
            <input type="number" id="renewalPremium" min="0" step="0.01" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Renewal Date</label>
            <input type="date" id="renewalDate" />
          </div>
          <div class="form-group">
            <label>Payment Due Date</label>
            <input type="date" id="paymentDueDate" />
          </div>
        </div>
      </div>

      <!-- Coverage Change Fields -->
      <div class="form-section" id="coverageChangeSection">
        <div class="section-title">Coverage Change Details</div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Change Description</label>
            <textarea id="changeDescription" rows="3" placeholder="Describe the coverage changes..."></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Previous Premium</label>
            <input type="number" id="previousPremium" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>New Premium</label>
            <input type="number" id="newPremium" min="0" step="0.01" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Change Effective Date</label>
            <input type="date" id="changeEffectiveDate" />
          </div>
        </div>
      </div>

      <!-- Payment Receipt Fields -->
      <div class="form-section" id="paymentSection">
        <div class="section-title">Payment Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Payment Amount</label>
            <input type="number" id="paymentAmount" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>Payment Date</label>
            <input type="date" id="paymentDate" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Payment Method</label>
            <select id="paymentMethod">
              <option value="">Select Method</option>
              <option value="check">Check</option>
              <option value="cash">Cash</option>
              <option value="card">Credit/Debit Card</option>
              <option value="eft">Electronic Transfer</option>
              <option value="escrow">Escrow Payment</option>
            </select>
          </div>
          <div class="form-group">
            <label>Reference Number</label>
            <input type="text" id="referenceNumber" placeholder="Check # or Transaction ID" />
          </div>
        </div>
      </div>

      <!-- Claim Information Fields -->
      <div class="form-section" id="claimSection">
        <div class="section-title">Claim Contact Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Claim Phone Number</label>
            <input type="tel" id="claimPhone" />
          </div>
          <div class="form-group">
            <label>Claim Email</label>
            <input type="email" id="claimEmail" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Special Instructions</label>
            <textarea id="claimInstructions" placeholder="Enter any special claim filing instructions..."></textarea>
          </div>
        </div>
      </div>

      <!-- DL-123 Specific Fields -->
      <div class="form-section" id="dl123Section">
        <div class="section-title">DL-123 Driver Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insured Driver Name</label>
            <input type="text" id="insuredDriverName" />
          </div>
          <div class="form-group">
            <label>Date of Birth</label>
            <input type="date" id="driverDateOfBirth" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Agency Code #</label>
            <input type="text" id="agencyCode" />
          </div>
          <div class="form-group">
            <label>Agent Signature Name</label>
            <input type="text" id="agentSignatureName" placeholder="Agent's printed name" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Date of Certification</label>
            <input type="date" id="certificationDate" />
          </div>
        </div>
      </div>

      <!-- Letterhead Specific Fields -->
      <div class="form-section" id="letterheadSection">
        <div class="section-title">Professional Letter Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Recipient Name</label>
            <input type="text" id="letterRecipientName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Recipient Company (Optional)</label>
            <input type="text" id="letterRecipientCompany" placeholder="ABC Corporation" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Recipient Address</label>
            <input type="text" id="letterRecipientAddress" placeholder="123 Main Street" />
          </div>
          <div class="form-group">
            <label>City, State ZIP</label>
            <input type="text" id="letterRecipientCityStateZip" placeholder="New York, NY 10001" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Letter Date</label>
            <input type="date" id="letterDate" />
          </div>
          <div class="form-group">
            <label>Letter Subject</label>
            <input type="text" id="letterSubject" placeholder="RE: Insurance Policy Update" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Sender Name</label>
            <input type="text" id="letterSenderName" placeholder="Jane Smith" />
          </div>
          <div class="form-group">
            <label>Sender Position</label>
            <input type="text" id="letterSenderPosition" placeholder="Insurance Agent" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Letter Content</label>
            <textarea id="letterContent" rows="8" placeholder="Dear [Recipient],

Thank you for your interest in our insurance services. I am writing to provide you with important information regarding your policy...

Please feel free to contact me if you have any questions or need additional information."></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Closing</label>
            <select id="letterClosing">
              <option value="Sincerely">Sincerely</option>
              <option value="Best Regards">Best Regards</option>
              <option value="Respectfully">Respectfully</option>
              <option value="Thank you">Thank you</option>
              <option value="Cordially">Cordially</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Envelope Specific Fields -->
      <div class="form-section" id="envelopeSection">
        <div class="section-title">Envelope Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Envelope Size</label>
            <select id="envelopeSize">
              <option value="10">#10 Standard (9.5" √ó 4.125")</option>
              <option value="9">#9 Business (8.875" √ó 3.875")</option>
              <option value="a7">A7 Announcement (7.25" √ó 5.25")</option>
            </select>
          </div>
          <div class="form-group">
            <label>Include Return Address</label>
            <select id="envelopeIncludeReturn">
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Recipient Address</label>
            <textarea id="envelopeRecipientAddress" rows="4" placeholder="John Doe
123 Main Street
New York, NY 10001"></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group full-width">
            <label>Return Address (Optional - Leave blank to use default)</label>
            <textarea id="envelopeReturnAddress" rows="3" placeholder="Bill Layne Insurance
PO Box 827
Elkin, NC 28621"></textarea>
          </div>
        </div>
      </div>

      <!-- Underwriting Document Fields -->
      <div class="form-section" id="underwritingSection">
        <div class="section-title">Underwriting Information Request</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insurance Company</label>
            <select id="underwritingCompany">
              <option value="">Select Company</option>
              <option value="Nationwide">Nationwide</option>
              <option value="Progressive">Progressive</option>
              <option value="National General">National General</option>
              <option value="Travelers">Travelers</option>
              <option value="NC Grange Mutual">NC Grange Mutual</option>
              <option value="Alamance">Alamance</option>
              <option value="Universal Property">Universal Property</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Underwriter Email</label>
            <input type="email" id="underwriterEmail" placeholder="underwriter@insurance.com" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Subject Line</label>
            <input type="text" id="underwritingSubject" placeholder="Underwriting Request - Policy #123456" />
          </div>
          <div class="form-group">
            <label>Policy/Quote Number</label>
            <input type="text" id="underwritingPolicyNumber" placeholder="Enter policy or quote number" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Insured Name</label>
            <input type="text" id="underwritingInsuredName" placeholder="John and Jane Doe" />
          </div>
          <div class="form-group">
            <label>Property Address</label>
            <input type="text" id="underwritingPropertyAddress" placeholder="123 Main St, Elkin, NC 28621" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Request Type</label>
            <select id="underwritingRequestType" onchange="updateUnderwritingTemplate()">
              <option value="new">New Business Quote</option>
              <option value="renewal">Renewal</option>
              <option value="endorsement">Endorsement/Change</option>
              <option value="inspection">Inspection Photos</option>
              <option value="claims">Claims History</option>
              <option value="documentation">Additional Documentation</option>
              <option value="custom">Custom Request</option>
            </select>
          </div>
          <div class="form-group">
            <label>Priority Level</label>
            <select id="underwritingPriority">
              <option value="normal">Normal</option>
              <option value="urgent">Urgent - Closing/Time Sensitive</option>
              <option value="high">High Priority</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label>Documents/Information Needed</label>
            <textarea id="underwritingDocumentsNeeded" rows="4" placeholder="Please provide:
- 4-point inspection report
- Wind mitigation form
- Photos of roof (all sides)
- Proof of roof replacement"></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label>Additional Notes/Context</label>
            <textarea id="underwritingNotes" rows="3" placeholder="Any additional information or special circumstances..."></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Response Needed By</label>
            <input type="date" id="underwritingDeadline" />
          </div>
          <div class="form-group">
            <label>Agent Name</label>
            <input type="text" id="underwritingAgentName" placeholder="Your name" value="Bill Layne" />
          </div>
        </div>
      </div>

      <!-- Auto ID Card Specific Fields -->
      <div class="form-section" id="autoIDCardSection">
        <div class="section-title">Auto Insurance ID Card Information</div>
        <div class="form-row">
          <div class="form-group">
            <label>Insurance Company</label>
            <select id="idCardCompany" onchange="updateIDCardCompanyInfo()">
              <option value="">Select Company</option>
              <option value="Nationwide">Nationwide</option>
              <option value="Progressive">Progressive</option>
              <option value="National General">National General</option>
              <option value="Travelers">Travelers</option>
              <option value="NC Grange Mutual">NC Grange Mutual</option>
              <option value="Alamance">Alamance</option>
              <option value="Universal Property">Universal Property</option>
              <option value="Dairyland">Dairyland</option>
            </select>
          </div>
          <div class="form-group">
            <label>Number of Vehicles</label>
            <select id="idCardVehicleCount" onchange="updateVehicleFields()">
              <option value="1">1 Vehicle</option>
              <option value="2">2 Vehicles</option>
              <option value="3">3 Vehicles</option>
              <option value="4">4 Vehicles</option>
            </select>
          </div>
        </div>
        
        <!-- Vehicle 1 Information -->
        <div id="vehicle1Section">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 1 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle1Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle1Make" placeholder="Honda" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle1Model" placeholder="Accord" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle1VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Vehicle 2 Information (Hidden by default) -->
        <div id="vehicle2Section" style="display: none;">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 2 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle2Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle2Make" placeholder="Toyota" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle2Model" placeholder="Camry" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle2VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Vehicle 3 Information (Hidden by default) -->
        <div id="vehicle3Section" style="display: none;">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 3 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle3Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle3Make" placeholder="Ford" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle3Model" placeholder="F-150" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle3VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Vehicle 4 Information (Hidden by default) -->
        <div id="vehicle4Section" style="display: none;">
          <h4 style="color: #004080; margin-top: 20px;">Vehicle 4 Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Year</label>
              <input type="text" id="vehicle4Year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="vehicle4Make" placeholder="Chevrolet" />
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="vehicle4Model" placeholder="Silverado" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" id="vehicle4VIN" placeholder="Vehicle Identification Number" />
            </div>
          </div>
        </div>

        <!-- Driver Information -->
        <div class="form-row" style="margin-top: 20px;">
          <div class="form-group">
            <label>Primary Driver Name</label>
            <input type="text" id="idCardDriverName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Additional Driver (Optional)</label>
            <input type="text" id="idCardAdditionalDriver" placeholder="Jane Doe" />
          </div>
        </div>

        <!-- Policy Information for ID Card -->
        <div class="form-row">
          <div class="form-group">
            <label>Policy Number</label>
            <input type="text" id="idCardPolicyNumber" placeholder="Enter Policy Number" />
          </div>
          <div class="form-group">
            <label>NAIC #</label>
            <input type="text" id="idCardNAIC" placeholder="Auto-filled based on company" readonly style="background-color: #f0f0f0;" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Effective Date</label>
            <input type="date" id="idCardEffectiveDate" />
          </div>
          <div class="form-group">
            <label>Expiration Date</label>
            <input type="date" id="idCardExpirationDate" />
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" onclick="generateDocuments()">Generate Documents</button>
      </div>

      <!-- Preview Section -->
      <div id="previewSection" style="display: none;">
        <h2>Generated Documents</h2>
        <div id="documentPreviewContainer"></div>
      </div>

    </div>
  </div>

  <!-- PDF Templates Tab -->
  <div id="templates-tab" class="tab-content" style="display: none;">
    <div class="pdf-templates-container">
      <h2>PDF Template Library</h2>
      <p style="margin-bottom: 20px;">Browse and download commonly used insurance forms and templates.</p>
      <div class="pdf-category-selector">
        <label for="pdfCategory">Filter by Category:</label>
        <select id="pdfCategory" onchange="loadPDFCategory()">
          <option value="all">All Templates</option>
          <option value="acord">ACORD Forms</option>
          <option value="state">State Forms</option>
          <option value="company">Company Forms</option>
        </select>
      </div>
      <div id="pdfGrid" class="pdf-grid">
        <!-- PDF cards will be dynamically loaded here -->
      </div>
    </div>
  </div>

  <!-- Resources Tab -->
  <div id="resources-tab" class="tab-content" style="display: none;">
    <div class="resources-container">
      <h2>Quick Links & Resources</h2>
      <div class="resource-grid">
        <div class="resource-card">
          <h4>üìû Contact Information</h4>
          <p><strong>Bill Layne Insurance Agency</strong><br>
          1283 N Bridge St<br>
          Elkin, NC 28621<br>
          Phone: (336) 835-1993<br>
          Email: Save@BillLayneInsurance.com</p>
        </div>
        
        <div class="resource-card">
          <h4>üè¢ Insurance Companies</h4>
          <p>Quick links to carrier websites:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://www.nationwide.com" target="_blank">Nationwide</a></li>
            <li><a href="https://www.progressive.com" target="_blank">Progressive</a></li>
            <li><a href="https://www.travelers.com" target="_blank">Travelers</a></li>
            <li><a href="https://www.nationalgeneral.com" target="_blank">National General</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>üìã NC DMV Resources</h4>
          <p>North Carolina DMV forms and information:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://www.ncdot.gov/dmv" target="_blank">NC DMV Website</a></li>
            <li><a href="https://www.ncdot.gov/dmv/insurance" target="_blank">Insurance Requirements</a></li>
            <li><a href="https://www.ncdot.gov/dmv/forms" target="_blank">DMV Forms</a></li>
            <li><a href="https://vehicle-search.ncshp.org/accidents" target="_blank">NC Highway Patrol Crash Reports</a></li>
            <li><a href="https://payments.ncdot.gov/" target="_blank">Pay DMV Fines</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>üìß Company Email Addresses</h4>
          <p>Important email contacts for submissions:</p>
          <ul style="list-style: none; padding: 0;">
            <li><strong>NC Grange Underwriting:</strong><br>
                <a href="mailto:data4apps@ncgm.com">data4apps@ncgm.com</a></li>
            <li style="margin-top: 10px;"><strong>Progressive Uploads:</strong><br>
                <a href="mailto:upload@progressiveagent.com">upload@progressiveagent.com</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>üîß Tools & Calculators</h4>
          <p>Helpful insurance tools:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://billlayne.github.io/coi-generator/" target="_blank">Certificate Maker</a></li>
            <li><a href="https://billlayne.github.io/NC-Grange-Home-Insurance-Photo-Guide/" target="_blank">NC Grange Photo Guide</a></li>
            <li><a href="https://myinsurancephoto.com/link-generator-simple.html" target="_blank">Customer Photos</a></li>
            <li><a href="#" onclick="alert('Coming soon!')">Premium Calculator</a></li>
            <li><a href="#" onclick="alert('Coming soon!')">Coverage Estimator</a></li>
            <li><a href="#" onclick="alert('Coming soon!')">Deductible Comparison</a></li>
          </ul>
        </div>
        
        <div class="resource-card">
          <h4>üì∞ Newsletters</h4>
          <p>Stay informed with our latest updates:</p>
          <ul style="list-style: none; padding: 0;">
            <li><a href="https://billlayne.github.io/Newsletter/" target="_blank">Bill Layne Insurance Newsletter</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Prompt Manager Tab -->
  <div id="prompts-tab" class="tab-content" style="display: none;">
    <style>
      .prompts-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .prompts-header {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        text-align: center;
      }
      
      .prompts-toolbar {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }
      
      .prompt-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
      }
      
      .prompt-btn:hover {
        background: #5a67d8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      
      .prompt-btn.secondary {
        background: #48bb78;
      }
      
      .prompt-btn.secondary:hover {
        background: #38a169;
      }
      
      .prompt-search-box {
        flex: 1;
        min-width: 200px;
      }
      
      .prompt-search-box input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
      }
      
      .prompt-filter-bar {
        background: white;
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
      }
      
      .prompt-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .prompt-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.3s;
        position: relative;
      }
      
      .prompt-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      }
      
      .favorite-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.2s;
      }
      
      .favorite-btn:hover {
        transform: scale(1.2);
      }
      
      .favorite-btn.active {
        color: #f6ad55;
      }
      
      .prompt-title {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        padding-right: 40px;
      }
      
      .prompt-content {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
        max-height: 100px;
        overflow: hidden;
      }
      
      .prompt-card-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      
      .card-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }
      
      .copy-btn {
        background: #667eea;
        color: white;
      }
      
      .copy-btn:hover {
        background: #5a67d8;
      }
      
      .edit-btn {
        background: #4299e1;
        color: white;
      }
      
      .edit-btn:hover {
        background: #3182ce;
      }
      
      .delete-btn {
        background: #f56565;
        color: white;
      }
      
      .delete-btn:hover {
        background: #e53e3e;
      }
      
      .prompt-empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .prompt-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        padding: 20px;
      }
      
      .prompt-modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .prompt-modal-content {
        background: white;
        border-radius: 12px;
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      .prompt-modal-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .prompt-modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
      }
      
      .prompt-modal-body {
        padding: 20px;
      }
      
      .prompt-form-group {
        margin-bottom: 20px;
      }
      
      .prompt-form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }
      
      .prompt-form-group input,
      .prompt-form-group textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
      }
      
      .prompt-form-group textarea {
        min-height: 150px;
        resize: vertical;
        font-family: inherit;
      }
      
      .prompt-modal-footer {
        padding: 20px;
        border-top: 1px solid #e2e8f0;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      
      .prompt-toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #48bb78;
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: none;
        animation: slideInPrompt 0.3s ease;
        z-index: 1001;
      }
      
      .prompt-toast.show {
        display: block;
      }
      
      .prompt-toast.error {
        background: #f56565;
      }
      
      @keyframes slideInPrompt {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>
    
    <div class="prompts-container">
      <!-- Prompts Section Header -->
      <div class="prompts-header">
        <h2>üìù Saved Prompts</h2>
        <p>Your saved AI prompts collection</p>
      </div>
      
      <!-- Toolbar -->
      <div class="prompts-toolbar">
        <button class="prompt-btn" onclick="openAddPromptModal()">‚ûï Add New Prompt</button>
        <button class="prompt-btn secondary" onclick="exportPrompts()">üì• Download All</button>
        <button class="prompt-btn secondary" onclick="document.getElementById('importPromptFile').click()">üì§ Upload Prompts</button>
        <input type="file" id="importPromptFile" accept=".json" style="display: none;" onchange="importPrompts(event)">
        <div class="prompt-search-box">
          <input type="text" id="promptSearchInput" placeholder="üîç Search prompts..." oninput="renderPrompts()">
        </div>
      </div>
      
      <!-- Filter Bar -->
      <div class="prompt-filter-bar">
        <label>Sort by:</label>
        <select id="promptSortSelect" onchange="renderPrompts()">
          <option value="alphabetical">A-Z (Title)</option>
          <option value="newest">Newest First</option>
          <option value="category">Category</option>
        </select>
        
        <label class="checkbox-label">
          <input type="checkbox" id="promptFavoritesOnly" onchange="renderPrompts()">
          Show Favorites Only
        </label>
      </div>
      
      <!-- Prompts Container -->
      <div id="promptsContainer"></div>
      
      <!-- Empty State -->
      <div class="prompt-empty-state" id="promptEmptyState" style="display: none;">
        <h3>No prompts yet</h3>
        <p>Click "Add New Prompt" to get started!</p>
      </div>
    </div>
    
    <!-- Add/Edit Modal -->
    <div class="prompt-modal" id="promptModal">
      <div class="prompt-modal-content">
        <div class="prompt-modal-header">
          <h2 id="promptModalTitle">Add New Prompt</h2>
          <button class="prompt-modal-close" onclick="closePromptModal()">‚úï</button>
        </div>
        <div class="prompt-modal-body">
          <div class="prompt-form-group">
            <label>Prompt Title *</label>
            <input type="text" id="promptTitleInput" placeholder="Give your prompt a name...">
          </div>
          <div class="prompt-form-group">
            <label>Prompt Content *</label>
            <textarea id="promptContentInput" placeholder="Enter your prompt here..."></textarea>
          </div>
          <div class="prompt-form-group">
            <label>Category (optional)</label>
            <input type="text" id="promptCategoryInput" placeholder="e.g., Email, Social Media, Reports">
          </div>
        </div>
        <div class="prompt-modal-footer">
          <button class="prompt-btn" onclick="closePromptModal()">Cancel</button>
          <button class="prompt-btn" onclick="savePrompt()">Save Prompt</button>
        </div>
      </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="prompt-toast" id="promptToast"></div>
    
    <script>
      // Prompt Manager Data and Functions
      let prompts = [];
      let currentEditPromptId = null;
      
      // Load prompts from localStorage
      function loadPromptsFromStorage() {
        try {
          const stored = localStorage.getItem('simplePrompts');
          if (stored) {
            prompts = JSON.parse(stored);
            console.log(`Loaded ${prompts.length} prompts from localStorage`);
          } else {
            prompts = [];
            console.log('No prompts found in localStorage, starting fresh');
          }
        } catch (error) {
          console.error('Error loading prompts from localStorage:', error);
          prompts = [];
        }
      }
      
      // Save prompts to localStorage
      function savePromptsToStorage() {
        try {
          localStorage.setItem('simplePrompts', JSON.stringify(prompts));
          console.log(`Saved ${prompts.length} prompts to localStorage`);
        } catch (error) {
          console.error('Error saving prompts to localStorage:', error);
          showPromptToast('Failed to save prompts locally', true);
        }
      }
      
      // Initialize prompts when tab is shown
      function initializePrompts() {
        loadPromptsFromStorage();
        renderPrompts();
      }
      
      // Load prompts on page load
      loadPromptsFromStorage();
      
      function renderPrompts() {
        const container = document.getElementById('promptsContainer');
        const emptyState = document.getElementById('promptEmptyState');
        const searchTerm = document.getElementById('promptSearchInput').value.toLowerCase();
        const sortBy = document.getElementById('promptSortSelect').value;
        const favoritesOnly = document.getElementById('promptFavoritesOnly').checked;
        
        // Filter prompts
        let filtered = prompts.filter(p => {
          const matchesSearch = p.title.toLowerCase().includes(searchTerm) || 
            p.content.toLowerCase().includes(searchTerm) ||
            (p.category || '').toLowerCase().includes(searchTerm);
          const matchesFavorite = !favoritesOnly || p.isFavorite;
          return matchesSearch && matchesFavorite;
        });
        
        // Sort prompts
        filtered.sort((a, b) => {
          if (sortBy === 'alphabetical') {
            return a.title.localeCompare(b.title);
          } else if (sortBy === 'newest') {
            return new Date(b.createdAt) - new Date(a.createdAt);
          } else if (sortBy === 'category') {
            const catA = a.category || 'zzz';
            const catB = b.category || 'zzz';
            if (catA === catB) {
              return a.title.localeCompare(b.title);
            }
            return catA.localeCompare(catB);
          }
          return 0;
        });
        
        if (filtered.length === 0) {
          container.innerHTML = '';
          emptyState.style.display = 'block';
          if (favoritesOnly) {
            emptyState.querySelector('h3').textContent = 'No favorite prompts yet';
            emptyState.querySelector('p').textContent = 'Star some prompts to see them here!';
          } else if (searchTerm) {
            emptyState.querySelector('h3').textContent = 'No prompts found';
            emptyState.querySelector('p').textContent = 'Try a different search term';
          } else {
            emptyState.querySelector('h3').textContent = 'No prompts yet';
            emptyState.querySelector('p').textContent = 'Click "Add New Prompt" to get started!';
          }
          return;
        }
        
        emptyState.style.display = 'none';
        
        container.innerHTML = '<div class="prompt-grid">' + 
          filtered.map(prompt => `
            <div class="prompt-card">
              <button class="favorite-btn ${prompt.isFavorite ? 'active' : ''}" onclick="togglePromptFavorite('${prompt.id}')">
                ${prompt.isFavorite ? '‚≠ê' : '‚òÜ'}
              </button>
              <div class="prompt-title">${escapeHtmlPrompt(prompt.title)}</div>
              ${prompt.category ? `<div style="color: #667eea; font-size: 0.9rem; margin-bottom: 10px;">üìÅ ${escapeHtmlPrompt(prompt.category)}</div>` : ''}
              <div class="prompt-content">${escapeHtmlPrompt(prompt.content)}</div>
              <div class="prompt-card-actions">
                <button class="card-btn copy-btn" onclick="copyPrompt('${prompt.id}')">üìã Copy</button>
                <button class="card-btn edit-btn" onclick="editPrompt('${prompt.id}')">‚úèÔ∏è Edit</button>
                <button class="card-btn delete-btn" onclick="deletePrompt('${prompt.id}')">üóëÔ∏è Delete</button>
              </div>
            </div>
          `).join('') + '</div>';
      }
      
      function togglePromptFavorite(id) {
        const prompt = prompts.find(p => p.id === id);
        if (!prompt) return;
        
        prompt.isFavorite = !prompt.isFavorite;
        savePromptsToStorage();
        renderPrompts();
        showPromptToast(prompt.isFavorite ? 'Added to favorites!' : 'Removed from favorites');
      }
      
      function openAddPromptModal() {
        document.getElementById('promptModalTitle').textContent = 'Add New Prompt';
        document.getElementById('promptTitleInput').value = '';
        document.getElementById('promptContentInput').value = '';
        document.getElementById('promptCategoryInput').value = '';
        currentEditPromptId = null;
        document.getElementById('promptModal').classList.add('active');
      }
      
      function editPrompt(id) {
        const prompt = prompts.find(p => p.id === id);
        if (!prompt) return;
        
        document.getElementById('promptModalTitle').textContent = 'Edit Prompt';
        document.getElementById('promptTitleInput').value = prompt.title;
        document.getElementById('promptContentInput').value = prompt.content;
        document.getElementById('promptCategoryInput').value = prompt.category || '';
        currentEditPromptId = id;
        document.getElementById('promptModal').classList.add('active');
      }
      
      function closePromptModal() {
        document.getElementById('promptModal').classList.remove('active');
      }
      
      function savePrompt() {
        const title = document.getElementById('promptTitleInput').value.trim();
        const content = document.getElementById('promptContentInput').value.trim();
        const category = document.getElementById('promptCategoryInput').value.trim();
        
        if (!title || !content) {
          showPromptToast('Please fill in all required fields', true);
          return;
        }
        
        if (currentEditPromptId) {
          // Edit existing
          const index = prompts.findIndex(p => p.id === currentEditPromptId);
          prompts[index] = { ...prompts[index], title, content, category };
          showPromptToast('Prompt updated successfully!');
        } else {
          // Add new
          const newPrompt = {
            id: Date.now().toString(),
            title,
            content,
            category,
            isFavorite: false,
            createdAt: new Date().toISOString()
          };
          prompts.unshift(newPrompt);
          showPromptToast('Prompt added successfully!');
        }
        
        savePromptsToStorage();
        renderPrompts();
        closePromptModal();
      }
      
      function copyPrompt(id) {
        const prompt = prompts.find(p => p.id === id);
        if (!prompt) return;
        
        navigator.clipboard.writeText(prompt.content).then(() => {
          showPromptToast('Prompt copied to clipboard!');
        }).catch(() => {
          showPromptToast('Failed to copy', true);
        });
      }
      
      function deletePrompt(id) {
        if (!confirm('Are you sure you want to delete this prompt?')) return;
        
        prompts = prompts.filter(p => p.id !== id);
        savePromptsToStorage();
        renderPrompts();
        showPromptToast('Prompt deleted');
      }
      
      function exportPrompts() {
        const dataStr = JSON.stringify(prompts, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
        const link = document.createElement('a');
        link.href = dataUri;
        link.download = `prompts-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        showPromptToast('Prompts downloaded!');
      }
      
      function importPrompts(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const imported = JSON.parse(e.target.result);
            if (Array.isArray(imported)) {
              imported.forEach(p => {
                if (p.isFavorite === undefined) p.isFavorite = false;
              });
              prompts = [...imported, ...prompts];
              savePromptsToStorage();
              renderPrompts();
              showPromptToast(`Imported ${imported.length} prompts!`);
            }
          } catch (err) {
            showPromptToast('Invalid file format', true);
          }
        };
        reader.readAsText(file);
        event.target.value = '';
      }
      
      function showPromptToast(message, isError = false) {
        const toast = document.getElementById('promptToast');
        toast.textContent = message;
        toast.className = 'prompt-toast show' + (isError ? ' error' : '');
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
      
      function escapeHtmlPrompt(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // Close modal on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.getElementById('promptModal').classList.contains('active')) {
          closePromptModal();
        }
      });
      
      // Auto-save prompts before page unload
      window.addEventListener('beforeunload', () => {
        if (prompts.length > 0) {
          savePromptsToStorage();
        }
      });
      
      // Verify localStorage is working
      window.addEventListener('DOMContentLoaded', () => {
        // Test localStorage availability
        try {
          const testKey = '__localStorageTest__';
          localStorage.setItem(testKey, 'test');
          localStorage.removeItem(testKey);
          console.log('‚úÖ localStorage is available and working');
        } catch (e) {
          console.error('‚ùå localStorage is not available:', e);
          showPromptToast('Warning: Cannot save prompts locally. Your browser may have storage disabled.', true);
        }
      });
    </script>
  </div>

<!-- HTML Converter Tab -->
<div id="html-converter-tab" class="tab-content" style="display: none;">
  <style>
    #html-converter-tab {
      padding: 0;
      height: calc(100vh - 60px); /* Full height minus navigation bar */
      overflow: hidden;
    }

    .html-converter-container {
      height: 100%;
      display: flex;
      flex-direction: column;
      background: #f8f9fa;
    }

    .html-converter-header {
      background: white;
      padding: 20px 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-bottom: 1px solid #e2e8f0;
    }

    .html-converter-iframe-container {
      flex: 1;
      padding: 20px;
      overflow: hidden;
    }

    .html-converter-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      background: white;
    }
  </style>

  <div class="html-converter-container">
    <div class="html-converter-header">
      <h2 style="font-size: 28px; font-weight: 700; margin: 0 0 10px 0; display: flex; align-items: center; gap: 12px;">
        <i class="fas fa-code" style="color: #8b5cf6;"></i>
        HTML Email Converter
        <span style="background: linear-gradient(135deg, #8b5cf6, #a855f7); color: white; padding: 6px 14px; border-radius: 999px; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Pro</span>
      </h2>
      <p style="font-size: 16px; color: #64748b; margin: 0;">Convert and optimize HTML for professional email templates. Full-page editor for better visibility.</p>
    </div>
    <div class="html-converter-iframe-container">
      <iframe src="html-converter.html" class="html-converter-iframe"></iframe>
    </div>
  </div>
</div>

<!-- SNL Tab (No Loss Statement Link Generator with SMS) -->
<div id="snl-tab" class="tab-content" style="display: none;">
    <style>
        #snl-tab * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #snl-tab {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: calc(100vh - 60px);
            padding: 20px 10px;
        }

        #snl-tab .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        #snl-tab .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        #snl-tab .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        #snl-tab .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        #snl-tab .system-badge {
            display: inline-block;
            background: #FF9800;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        #snl-tab .form-container {
            padding: 25px 20px;
        }

        #snl-tab .section-title {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 20px -20px 15px -20px;
            border-left: 4px solid #667eea;
            font-weight: 600;
            color: #2a5298;
        }

        #snl-tab .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        #snl-tab .form-group {
            margin-bottom: 15px;
        }

        #snl-tab .form-group.full-width {
            grid-column: span 2;
        }

        #snl-tab label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
        }

        #snl-tab .required {
            color: #f44336;
        }

        #snl-tab input[type="text"],
        #snl-tab input[type="email"],
        #snl-tab input[type="tel"],
        #snl-tab input[type="date"],
        #snl-tab select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        #snl-tab input:focus,
        #snl-tab select:focus {
            outline: none;
            border-color: #667eea;
            background: #f8f9ff;
        }

        #snl-tab .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 25px;
        }

        #snl-tab .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        #snl-tab .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            grid-column: span 2;
        }

        #snl-tab .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        #snl-tab .btn-copy {
            background: #4CAF50;
            color: white;
        }

        #snl-tab .btn-copy:hover {
            background: #45a049;
        }

        #snl-tab .btn-email {
            background: #2196F3;
            color: white;
        }

        #snl-tab .btn-email:hover {
            background: #0b7dda;
        }

        #snl-tab .btn-text {
            background: #FF9800;
            color: white;
        }

        #snl-tab .btn-text:hover {
            background: #e68900;
        }

        #snl-tab .btn-sms {
            background: #25D366;
            color: white;
        }

        #snl-tab .btn-sms:hover {
            background: #128C7E;
        }

        #snl-tab .btn-clear {
            background: #f44336;
            color: white;
        }

        #snl-tab .btn-clear:hover {
            background: #da190b;
        }

        #snl-tab .btn-matrix {
            background: #2196F3;
            color: white;
        }

        #snl-tab .btn-matrix:hover {
            background: #0b7dda;
        }

        #snl-tab .btn-open {
            background: #9C27B0;
            color: white;
        }

        #snl-tab .btn-open:hover {
            background: #7B1FA2;
        }

        #snl-tab .result-section {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        #snl-tab .result-section h3 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 18px;
        }

        #snl-tab .link-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            word-break: break-all;
            font-family: monospace;
            font-size: 13px;
            color: #333;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            user-select: all;
        }

        #snl-tab .message-templates {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        #snl-tab .template {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        #snl-tab .template h4 {
            color: #2a5298;
            font-size: 14px;
            margin-bottom: 8px;
        }

        #snl-tab .template-text {
            font-size: 13px;
            line-height: 1.5;
            color: #555;
            white-space: pre-wrap;
        }

        #snl-tab .copy-status {
            display: none;
            color: #4CAF50;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
        }

        #snl-tab .instructions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        #snl-tab .instructions h4 {
            color: #856404;
            margin-bottom: 8px;
        }

        #snl-tab .instructions ol {
            margin-left: 20px;
            color: #856404;
            font-size: 14px;
        }

        #snl-tab .instructions li {
            margin-bottom: 5px;
        }

        #snl-tab .email-notice {
            color: #d9534f;
            font-weight: bold;
        }

        /* SMS Modal Styles */
        #snl-tab .sms-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        #snl-tab .sms-modal-overlay.show {
            display: flex;
        }

        #snl-tab .sms-modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: snlModalSlideIn 0.3s ease-out;
        }

        @keyframes snlModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #snl-tab .sms-modal h3 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #snl-tab .sms-input-group {
            margin-bottom: 20px;
        }

        #snl-tab .sms-input-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        #snl-tab .sms-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        #snl-tab .sms-input-group input:focus {
            outline: none;
            border-color: #667eea;
            background: #f8f9ff;
        }

        #snl-tab .sms-preview {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #e0e0e0;
        }

        #snl-tab .sms-modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        #snl-tab .sms-loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        #snl-tab .sms-loading.show {
            display: block;
        }

        #snl-tab .sms-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: snlSpin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes snlSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #snl-tab .sms-status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            display: none;
            animation: snlStatusFadeIn 0.3s ease-out;
        }

        @keyframes snlStatusFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #snl-tab .sms-status.success {
            background: #4CAF50;
            color: white;
        }

        #snl-tab .sms-status.error {
            background: #f44336;
            color: white;
        }

        @media (max-width: 600px) {
            #snl-tab .row {
                grid-template-columns: 1fr;
            }

            #snl-tab .form-group.full-width {
                grid-column: span 1;
            }

            #snl-tab .button-group {
                grid-template-columns: 1fr;
            }

            #snl-tab .btn-generate {
                grid-column: span 1;
            }

            #snl-tab .header h1 {
                font-size: 20px;
            }

            #snl-tab .sms-modal {
                width: 95%;
                padding: 20px;
            }
        }
    </style>

    <div class="container">
        <div class="header">
            <h1>üìã No Loss Statement Link Generator</h1>
            <p>Bill Layne Insurance Agency - Staff Tool</p>
            <span class="system-badge">DOCS EMAIL SYSTEM</span>
        </div>

        <div class="form-container">
            <div class="instructions">
                <h4>üìå Quick Instructions:</h4>
                <ol>
                    <li>Fill in customer's information below</li>
                    <li>Click "Generate Link"</li>
                    <li>Copy the link or send via SMS/email</li>
                    <li>Customer receives link - they just need to sign!</li>
                    <li class="email-notice">‚ö†Ô∏è Forms send to Docs@BillLayneInsurance.com</li>
                </ol>
            </div>

            <form id="snlLinkGenerator">
                <div class="section-title">Customer Information</div>

                <div class="row">
                    <div class="form-group full-width">
                        <label for="snlCustomerName">Customer Name <span class="required">*</span></label>
                        <input type="text" id="snlCustomerName" required placeholder="John Smith">
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label for="snlEmail">Email Address</label>
                        <input type="email" id="snlEmail" placeholder="customer@email.com">
                    </div>

                    <div class="form-group">
                        <label for="snlPhone">Phone Number</label>
                        <input type="tel" id="snlPhone" placeholder="(336) 555-1234">
                    </div>
                </div>

                <div class="section-title">Policy Information</div>

                <div class="row">
                    <div class="form-group">
                        <label for="snlPolicyNumber">Policy Number <span class="required">*</span></label>
                        <input type="text" id="snlPolicyNumber" required placeholder="ABC123456">
                    </div>

                    <div class="form-group">
                        <label for="snlInsuranceCompany">Insurance Company <span class="required">*</span></label>
                        <select id="snlInsuranceCompany" required>
                            <option value="">Select Company</option>
                            <option value="Nationwide">Nationwide</option>
                            <option value="Progressive">Progressive</option>
                            <option value="National General">National General</option>
                            <option value="Alamance">Alamance</option>
                            <option value="Travelers">Travelers</option>
                            <option value="Foremost">Foremost</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label for="snlPolicyType">Policy Type</label>
                        <select id="snlPolicyType">
                            <option value="">Select Type</option>
                            <option value="Auto">Auto Insurance</option>
                            <option value="Home">Homeowners Insurance</option>
                            <option value="Renters">Renters Insurance</option>
                            <option value="Life">Life Insurance</option>
                            <option value="Business">Business Insurance</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="snlAmountPaid">Reinstatement Amount <span class="required">*</span></label>
                        <input type="text" id="snlAmountPaid" required placeholder="425.00">
                    </div>
                </div>

                <div class="section-title">Important Dates</div>

                <div class="row">
                    <div class="form-group">
                        <label for="snlCancelDate">Cancellation/Lapse Date <span class="required">*</span></label>
                        <input type="date" id="snlCancelDate" required>
                    </div>

                    <div class="form-group">
                        <label for="snlReinstateDate">Reinstatement Date <span class="required">*</span></label>
                        <input type="date" id="snlReinstateDate" required>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-generate">üîó Generate Link</button>
                </div>
            </form>

            <div id="snlResultSection" class="result-section">
                <h3>‚úÖ Link Generated Successfully!</h3>
                <p style="color: #856404; font-weight: bold; margin-bottom: 10px;">üìß This form sends to: Docs@BillLayneInsurance.com</p>

                <div class="link-display" id="snlGeneratedLink"></div>

                <div class="button-group">
                    <button class="btn btn-copy" onclick="snlCopyLink()">üìã Copy Link</button>
                    <button class="btn btn-open" onclick="snlOpenLink()">üîó Open Form</button>
                    <button class="btn btn-clear" onclick="snlClearForm()">üîÑ Start Over</button>
                </div>

                <div class="copy-status" id="snlCopyStatus">‚úî Link copied to clipboard!</div>

                <div class="message-templates">
                    <div class="template">
                        <h4>üì± Text Message Template:</h4>
                        <div class="template-text" id="snlTextTemplate"></div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <button class="btn btn-text" onclick="snlCopyText()">Copy Text</button>
                            <button class="btn btn-sms" onclick="snlOpenSMSModal()">üì± Send SMS</button>
                            <button class="btn btn-matrix" onclick="snlOpenAgencyMatrix()">üîç Agency Matrix</button>
                        </div>
                    </div>

                    <div class="template">
                        <h4>üìß Email Template:</h4>
                        <div class="template-text" id="snlEmailTemplate"></div>
                        <button class="btn btn-email" style="margin-top: 10px; width: 100%;" onclick="snlCopyEmail()">Copy Email</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SMS Modal -->
    <div class="sms-modal-overlay" id="snlSmsModal">
        <div class="sms-modal">
            <h3>üì± Send No Loss Statement Link via SMS</h3>

            <div class="sms-input-group">
                <label for="snlSmsPhone">Customer Phone Number:</label>
                <input type="tel" id="snlSmsPhone" placeholder="(336) 555-1234">
            </div>

            <div class="sms-input-group">
                <label>Message Preview:</label>
                <div class="sms-preview" id="snlSmsPreview"></div>
            </div>

            <div class="sms-loading" id="snlSmsLoading">
                <div class="sms-spinner"></div>
                <p>Sending text message...</p>
            </div>

            <div class="sms-status" id="snlSmsStatus"></div>

            <div class="sms-modal-buttons" id="snlSmsButtons">
                <button class="btn btn-clear" onclick="snlCloseSMSModal()">Cancel</button>
                <button class="btn btn-sms" onclick="snlSendSMS()">Send Text</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const SNL_BASE_URL = 'https://billlayne.github.io/no-loss-statement/';
        const SNL_GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMR6JkqwOFjLUR4BRo7QE0mRiEwKxbcpdCDwJi5AKOmM4MMorM1EROWYMcH7gH1Vke/exec';

        // Store the generated URL and text message globally
        let snlCurrentGeneratedUrl = '';
        let snlCurrentTextMessage = '';

        // Auto-format phone number
        document.getElementById('snlPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = '(' + value;
                } else if (value.length <= 6) {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
                } else {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
                }
            }
            e.target.value = value;
        });

        // Auto-format SMS phone input
        document.getElementById('snlSmsPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = '(' + value;
                } else if (value.length <= 6) {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
                } else {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
                }
            }
            e.target.value = value;
        });

        // Auto-format amount
        document.getElementById('snlAmountPaid').addEventListener('blur', function(e) {
            let value = e.target.value.replace(/[^\d.]/g, '');
            if (value && !isNaN(value)) {
                e.target.value = parseFloat(value).toFixed(2);
            }
        });

        // Handle form submission
        document.getElementById('snlLinkGenerator').addEventListener('submit', function(e) {
            e.preventDefault();
            snlGenerateLink();
        });

        function snlGenerateLink() {
            // Get form values
            const name = document.getElementById('snlCustomerName').value;
            const email = document.getElementById('snlEmail').value;
            const phone = document.getElementById('snlPhone').value;
            const policyNumber = document.getElementById('snlPolicyNumber').value;
            const company = document.getElementById('snlInsuranceCompany').value;
            const policyType = document.getElementById('snlPolicyType').value;
            const amount = document.getElementById('snlAmountPaid').value;
            const cancelDate = document.getElementById('snlCancelDate').value;
            const reinstateDate = document.getElementById('snlReinstateDate').value;

            // Build URL parameters with correct parameter names
            let params = new URLSearchParams();
            params.append('policyNumber', policyNumber);
            params.append('amountPaid', amount);
            params.append('insuranceCompany', company);
            params.append('insuredName', name);
            params.append('cancellationDate', cancelDate);
            params.append('reinstatementDate', reinstateDate);

            // Add optional fields
            if (email) params.append('email', email);
            if (phone) params.append('phone', phone);
            if (policyType) params.append('policyType', policyType);

            // Generate the full URL
            const fullUrl = SNL_BASE_URL + '?' + params.toString();

            // Store the URL globally
            snlCurrentGeneratedUrl = fullUrl;

            // Display the link
            document.getElementById('snlGeneratedLink').textContent = fullUrl;
            document.getElementById('snlResultSection').style.display = 'block';

            // Generate message templates
            snlGenerateTemplates(name, policyNumber, amount, cancelDate, reinstateDate, fullUrl);

            // Scroll to results
            document.getElementById('snlResultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function snlGenerateTemplates(name, policy, amount, cancelDate, reinstateDate, url) {
            // Format dates for display
            const formatDate = (dateStr) => {
                const date = new Date(dateStr + 'T12:00:00');
                return date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' });
            };

            const cancelFormatted = formatDate(cancelDate);
            const reinstateFormatted = formatDate(reinstateDate);
            const firstName = name.split(' ')[0];

            // Text message template
            const textMsg = `Hi ${firstName},

To reinstate your insurance policy #${policy}, please complete the No Loss Statement:

Amount: $${amount}
Cancelled: ${cancelFormatted}

Click here: ${url}

Just verify info & sign. Takes 2 minutes!

Questions? Call 336-835-1993

-Bill Layne Insurance`;

            // Email template
            const emailMsg = `Subject: Action Required - Complete No Loss Statement for Policy Reinstatement

Dear ${name},

To complete the reinstatement of your insurance policy, we need you to sign a Statement of No Loss.

Policy Details:
‚Ä¢ Policy Number: ${policy}
‚Ä¢ Cancellation Date: ${cancelFormatted}
‚Ä¢ Reinstatement Date: ${reinstateFormatted}
‚Ä¢ Amount Due: $${amount}

Please click the link below to complete the form. All your information has been pre-filled - you just need to verify and sign:

${url}

This takes less than 2 minutes to complete on any device.

If you have any questions, please don't hesitate to call us at 336-835-1993.

Thank you,
Bill Layne Insurance Agency
1283 N Bridge St, Elkin NC 28621
Save@BillLayneInsurance.com`;

            document.getElementById('snlTextTemplate').textContent = textMsg;
            document.getElementById('snlEmailTemplate').textContent = emailMsg;

            // Store the text message globally for SMS
            snlCurrentTextMessage = textMsg;
        }

        function snlCopyLink() {
            const link = document.getElementById('snlGeneratedLink').textContent;
            navigator.clipboard.writeText(link).then(function() {
                snlShowCopyStatus('‚úî Link copied to clipboard!');
            }).catch(function(err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                snlShowCopyStatus('‚úî Link copied to clipboard!');
            });
        }

        function snlOpenLink() {
            if (snlCurrentGeneratedUrl) {
                window.open(snlCurrentGeneratedUrl, '_blank');
            } else {
                alert('Please generate a link first');
            }
        }

        function snlCopyText() {
            const text = document.getElementById('snlTextTemplate').textContent;
            navigator.clipboard.writeText(text).then(function() {
                snlShowCopyStatus('‚úî Text message copied!');
            }).catch(function(err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                snlShowCopyStatus('‚úî Text message copied!');
            });
        }

        function snlCopyEmail() {
            const email = document.getElementById('snlEmailTemplate').textContent;
            navigator.clipboard.writeText(email).then(function() {
                snlShowCopyStatus('‚úî Email template copied!');
            }).catch(function(err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = email;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                snlShowCopyStatus('‚úî Email template copied!');
            });
        }

        // SMS Modal Functions
        function snlOpenSMSModal() {
            const phone = document.getElementById('snlPhone').value;
            const textMsg = document.getElementById('snlTextTemplate').textContent;

            if (!snlCurrentGeneratedUrl) {
                alert('Please generate a link first');
                return;
            }

            // Pre-fill phone if available
            document.getElementById('snlSmsPhone').value = phone;

            // Show message preview
            document.getElementById('snlSmsPreview').textContent = textMsg;

            // Reset status
            document.getElementById('snlSmsStatus').style.display = 'none';
            document.getElementById('snlSmsLoading').classList.remove('show');
            document.getElementById('snlSmsButtons').style.display = 'grid';

            // Show modal
            document.getElementById('snlSmsModal').classList.add('show');

            // Focus on phone input
            setTimeout(() => {
                if (!phone) {
                    document.getElementById('snlSmsPhone').focus();
                }
            }, 100);
        }

        function snlCloseSMSModal() {
            document.getElementById('snlSmsModal').classList.remove('show');
        }

        async function snlSendSMS() {
            const phone = document.getElementById('snlSmsPhone').value;

            if (!phone) {
                alert('Please enter a phone number');
                return;
            }

            // Clean phone number
            const cleanPhone = phone.replace(/\D/g, '');

            if (cleanPhone.length !== 10) {
                alert('Please enter a valid 10-digit phone number');
                return;
            }

            // Get customer info
            const customerName = document.getElementById('snlCustomerName').value;
            const policyNumber = document.getElementById('snlPolicyNumber').value;

            // Prepare SMS data
            const smsData = {
                action: 'send_link_sms',
                to: cleanPhone,
                customerName: customerName,
                policyNumber: policyNumber,
                message: snlCurrentTextMessage
            };

            // Show loading
            document.getElementById('snlSmsLoading').classList.add('show');
            document.getElementById('snlSmsButtons').style.display = 'none';
            document.getElementById('snlSmsStatus').style.display = 'none';

            try {
                const response = await fetch(SNL_GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(smsData)
                });

                const result = await response.json();

                // Hide loading
                document.getElementById('snlSmsLoading').classList.remove('show');

                if (result.success) {
                    // Show success
                    const statusDiv = document.getElementById('snlSmsStatus');
                    statusDiv.textContent = '‚úÖ Text message sent successfully!';
                    statusDiv.className = 'sms-status success';
                    statusDiv.style.display = 'block';

                    // Auto close after 3 seconds
                    setTimeout(() => {
                        snlCloseSMSModal();
                    }, 3000);
                } else {
                    // Show error
                    const statusDiv = document.getElementById('snlSmsStatus');
                    statusDiv.textContent = '‚ùå Failed: ' + (result.error || 'Unknown error');
                    statusDiv.className = 'sms-status error';
                    statusDiv.style.display = 'block';

                    // Show buttons again
                    document.getElementById('snlSmsButtons').style.display = 'grid';
                }

            } catch (error) {
                console.error('SMS Error:', error);

                // Hide loading
                document.getElementById('snlSmsLoading').classList.remove('show');

                // Show error
                const statusDiv = document.getElementById('snlSmsStatus');
                statusDiv.textContent = '‚ùå Failed to send text message';
                statusDiv.className = 'sms-status error';
                statusDiv.style.display = 'block';

                // Show buttons again
                document.getElementById('snlSmsButtons').style.display = 'grid';
            }
        }

        function snlOpenAgencyMatrix() {
            const phoneValue = document.getElementById('snlPhone').value;

            if (!phoneValue) {
                alert('Please enter a phone number first');
                document.getElementById('snlPhone').focus();
                return;
            }

            // Strip all non-numeric characters from phone
            const phoneDigits = phoneValue.replace(/\D/g, '');

            if (phoneDigits.length < 10) {
                alert('Please enter a complete 10-digit phone number');
                return;
            }

            // First, copy the text message to clipboard
            const text = document.getElementById('snlTextTemplate').textContent;
            navigator.clipboard.writeText(text).then(function() {
                // Then open Agency Matrix
                const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneDigits}`;
                window.open(agencyMatrixUrl, '_blank');

                // Show status message
                snlShowCopyStatus('‚úî Text copied! Opening Agency Matrix - paste the message there');
            }).catch(function(err) {
                // Fallback if clipboard fails
                alert('Please copy the text message manually, then click OK to open Agency Matrix');
                const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneDigits}`;
                window.open(agencyMatrixUrl, '_blank');
            });
        }

        function snlShowCopyStatus(message = '‚úî Link copied to clipboard!') {
            const status = document.getElementById('snlCopyStatus');
            status.textContent = message;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function snlClearForm() {
            document.getElementById('snlLinkGenerator').reset();
            document.getElementById('snlResultSection').style.display = 'none';
            snlCurrentGeneratedUrl = '';
            snlCurrentTextMessage = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close modal when clicking outside
        document.getElementById('snlSmsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                snlCloseSMSModal();
            }
        });

        // Set today's date as default for reinstatement date
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const reinstateField = document.getElementById('snlReinstateDate');
            if (reinstateField) {
                reinstateField.value = today;
            }
        });
    </script>
  <!-- Cancellation Tab (ACORD 35 Cancellation Link Generator) -->
  <div id="cancellation-tab" class="tab-content" style="display: none;">
    <div style="padding: 20px;">
      <h1>TEST - CANCELLATION TAB IS WORKING</h1>
      <p>If you can see this text, the tab switching is working correctly.</p>
    </div>
    <div style="padding: 20px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); min-height: calc(100vh - 60px);">
      <div style="max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;">
        <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 25px 20px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 10px;">üìÑ ACORD 35 Cancellation Link Generator</h1>
            <p style="font-size: 14px; opacity: 0.9;">Bill Layne Insurance Agency - Staff Tool</p>
            <span style="display: inline-block; background: #dc3545; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-top: 10px;">‚ö†Ô∏è CANCELLATION SYSTEM</span>
        </div>

        <div style="padding: 25px 20px;">
            <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="color: #856404; margin-bottom: 8px;">üìå Instructions:</h4>
                <ol style="margin-left: 20px; color: #856404; font-size: 14px;">
                    <li>Fill in all customer and policy information</li>
                    <li>Double-check cancellation date and time</li>
                    <li>Add any special notes (optional)</li>
                    <li>Click "Generate Link"</li>
                    <li>Send link to customer for signature</li>
                    <li style="color: #dc3545; font-weight: bold;">‚ö†Ô∏è This creates a cancellation request!</li>
                </ol>
            </div>

            <form id="cancelLinkGenerator">
                <div style="background: #f8f9fa; padding: 10px 15px; margin: 20px -20px 15px -20px; font-weight: 600; color: #495057; border-left: 4px solid #dc3545;">Customer Information</div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Insured Name *</label>
                    <input type="text" id="cancelInsuredName" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Address</label>
                    <input type="text" id="cancelInsuredAddress" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Phone</label>
                        <input type="tel" id="cancelInsuredPhone" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Email</label>
                        <input type="email" id="cancelInsuredEmail" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 10px 15px; margin: 20px -20px 15px -20px; font-weight: 600; color: #495057; border-left: 4px solid #dc3545;">Policy Information</div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Policy Number *</label>
                        <input type="text" id="cancelPolicyNumber" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Insurance Company *</label>
                        <select id="cancelCompany" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                            <option value="">Select Company...</option>
                            <option value="Progressive">Progressive</option>
                            <option value="Nationwide">Nationwide</option>
                            <option value="National General">National General</option>
                            <option value="Alamance Farmers">Alamance Farmers</option>
                            <option value="Travelers">Travelers</option>
                            <option value="Foremost">Foremost</option>
                            <option value="NC Grange">NC Grange</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Policy Type *</label>
                        <select id="cancelPolicyType" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                            <option value="">Select Type...</option>
                            <option value="Auto">Auto</option>
                            <option value="Home">Home</option>
                            <option value="Renters">Renters</option>
                            <option value="Motorcycle">Motorcycle</option>
                            <option value="RV">RV</option>
                            <option value="Boat">Boat</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Effective Date</label>
                        <input type="date" id="cancelEffectiveDate" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Expiration Date</label>
                    <input type="date" id="cancelExpirationDate" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>

                <div style="background: #f8f9fa; padding: 10px 15px; margin: 20px -20px 15px -20px; font-weight: 600; color: #495057; border-left: 4px solid #dc3545;">Cancellation Details</div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Cancellation Date *</label>
                    <input type="date" id="cancelCancelDate" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Reason for Cancellation *</label>
                    <select id="cancelReason" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                        <option value="">Select Reason...</option>
                        <option value="Sold Vehicle" selected>Sold Vehicle</option>
                        <option value="Moved Out of State">Moved Out of State</option>
                        <option value="Found Better Rate">Found Better Rate</option>
                        <option value="No Longer Need Coverage">No Longer Need Coverage</option>
                        <option value="Financial Hardship">Financial Hardship</option>
                        <option value="Dissatisfied with Service">Dissatisfied with Service</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div style="background: #f8f9fa; padding: 10px 15px; margin: 20px -20px 15px -20px; font-weight: 600; color: #495057; border-left: 4px solid #dc3545;">Special Notes (Optional)</div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 5px;">Staff Notes / Special Instructions</label>
                    <textarea id="cancelNotes" placeholder="Add any special notes or instructions here (e.g., pending refund check, follow-up required, etc.)" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; min-height: 100px; resize: vertical;"></textarea>
                    <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 6px; padding: 10px; margin-top: 5px; font-size: 12px; color: #0c5460;">
                        ‚ÑπÔ∏è These notes will appear on the PDF and in the Google Sheet but will NOT be visible to the customer
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-top: 30px;">
                    <button type="button" onclick="cancelGenerateLink()" style="padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white;">
                        üîó Generate Cancellation Link
                    </button>
                    <button type="button" onclick="cancelClearForm()" style="padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; background: #6c757d; color: white;">
                        üîÑ Clear Form
                    </button>
                </div>
            </form>

            <div id="cancelResultSection" style="display: none; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #28a745;">
                <div style="font-size: 18px; font-weight: bold; color: #28a745; margin-bottom: 15px;">‚úÖ Cancellation Link Generated!</div>
                <div id="cancelGeneratedUrl" style="background: white; padding: 15px; border-radius: 8px; word-break: break-all; font-family: 'Courier New', monospace; font-size: 13px; border: 1px solid #ddd; margin-bottom: 15px;"></div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <button onclick="cancelCopyLink()" style="padding: 10px 15px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; background: #007bff; color: white;">
                        üìã Copy Link
                    </button>
                    <button onclick="cancelEmailToCustomer()" style="padding: 10px 15px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; background: #2196F3; color: white;">
                        üìß Email Customer
                    </button>
                    <button onclick="cancelSendToAgencyMatrix()" style="padding: 10px 15px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; background: #ffc107; color: #212529;">
                        üì± Text Customer
                    </button>
                </div>

                <div id="cancelTextTemplate" style="display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid #ffc107; white-space: pre-wrap;">
                    <strong>üì± Text Message Template:</strong><br><br>
                    <span id="cancelTextMessage"></span>
                    <br><br>
                    <button onclick="cancelCopyTextMessage()" style="width: 100%; margin-bottom: 10px; padding: 10px 15px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; background: #007bff; color: white;">
                        üìã Copy Text Message
                    </button>
                </div>

                <div id="cancelEmailTemplate" style="display: none; margin-top: 15px; background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107; white-space: pre-wrap;">
                    <strong>üìß Email Template:</strong><br><br>
                    <span id="cancelEmailMessage"></span>
                    <br><br>
                    <button onclick="cancelCopyEmailMessage()" style="width: 100%; padding: 10px 15px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; background: #007bff; color: white;">
                        üìã Copy Email Template
                    </button>
                </div>

                <div id="cancelCopyStatus" style="display: none; color: #28a745; font-weight: 600; text-align: center; margin-top: 10px;"></div>
            </div>
        </div>
      </div>
    </div>

    <script>
        let cancelCurrentGeneratedUrl = '';

        function cancelGenerateLink() {
            // Get form values
            const insuredName = document.getElementById('cancelInsuredName').value;
            const policyNumber = document.getElementById('cancelPolicyNumber').value;
            const company = document.getElementById('cancelCompany').value;
            const policyType = document.getElementById('cancelPolicyType').value;
            const cancelDate = document.getElementById('cancelCancelDate').value;
            const reason = document.getElementById('cancelReason').value;

            // Validate required fields
            if (!insuredName || !policyNumber || !company || !policyType || !cancelDate || !reason) {
                alert('Please fill in all required fields marked with *');
                return;
            }

            // Build URL parameters
            const params = new URLSearchParams({
                insuredName: insuredName,
                insuredAddress: document.getElementById('cancelInsuredAddress').value || '',
                insuredPhone: document.getElementById('cancelInsuredPhone').value || '',
                insuredEmail: document.getElementById('cancelInsuredEmail').value || '',
                policyNumber: policyNumber,
                company: company,
                policyType: policyType,
                effectiveDate: document.getElementById('cancelEffectiveDate').value || '',
                expirationDate: document.getElementById('cancelExpirationDate').value || '',
                cancelDate: cancelDate,
                cancelTime: '12:01 AM (Start of Day)',
                reason: reason,
                notes: document.getElementById('cancelNotes').value || ''
            });

            // Generate the URL
            const baseUrl = 'https://billlayne.github.io/cancellation-form/';
            cancelCurrentGeneratedUrl = baseUrl + '?' + params.toString();

            // Display result
            document.getElementById('cancelGeneratedUrl').textContent = cancelCurrentGeneratedUrl;
            document.getElementById('cancelResultSection').style.display = 'block';

            // Generate text message
            const phone = document.getElementById('cancelInsuredPhone').value || 'No phone';
            const textMsg = `Hi ${insuredName.split(' ')[0]},

Per your request, here's the link to sign your ${policyType} policy cancellation form (Policy: ${policyNumber}).

Cancellation Date: ${cancelFormatDate(cancelDate)} at 12:01 AM (Start of Day)

Please review and sign:
${cancelCurrentGeneratedUrl}

Thank you,
Bill Layne Insurance Agency
336-835-1993`;

            // Generate email template
            const emailMsg = `Subject: Action Required - Sign Cancellation Request for Policy ${policyNumber}

Dear ${insuredName},

Per your request to cancel your ${policyType} policy, please complete the electronic cancellation form.

Policy Details:
‚Ä¢ Policy Number: ${policyNumber}
‚Ä¢ Insurance Company: ${company}
‚Ä¢ Cancellation Date: ${cancelFormatDate(cancelDate)}
‚Ä¢ Cancellation Time: 12:01 AM (Start of Day)
‚Ä¢ Reason: ${reason}

Please click the link below to review and sign your cancellation request:

${cancelCurrentGeneratedUrl}

IMPORTANT: Your coverage will terminate on the date and time shown above. Please ensure you have replacement coverage if needed.

If you have any questions or wish to discuss alternatives, please call us at 336-835-1993.

Thank you,
Bill Layne Insurance Agency
1283 N Bridge St, Elkin NC 28621
Save@BillLayneInsurance.com`;

            document.getElementById('cancelTextMessage').textContent = textMsg;
            document.getElementById('cancelEmailMessage').textContent = emailMsg;
            document.getElementById('cancelTextTemplate').style.display = 'block';
            document.getElementById('cancelEmailTemplate').style.display = 'block';

            // Scroll to results
            document.getElementById('cancelResultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelFormatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' });
        }

        function cancelCopyLink() {
            navigator.clipboard.writeText(cancelCurrentGeneratedUrl).then(function() {
                cancelShowCopyStatus('‚úî Link copied to clipboard!');
            }).catch(function(err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = cancelCurrentGeneratedUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                cancelShowCopyStatus('‚úî Link copied to clipboard!');
            });
        }

        function cancelEmailToCustomer() {
            const insuredName = document.getElementById('cancelInsuredName').value;
            const insuredEmail = document.getElementById('cancelInsuredEmail').value;
            const policyNumber = document.getElementById('cancelPolicyNumber').value;
            const policyType = document.getElementById('cancelPolicyType').value;
            const cancelDate = document.getElementById('cancelCancelDate').value;
            const reason = document.getElementById('cancelReason').value;
            const company = document.getElementById('cancelCompany').value;

            if (!insuredEmail) {
                alert('Please enter customer email address first');
                document.getElementById('cancelInsuredEmail').focus();
                return;
            }

            // Create email subject
            const subject = `Action Required - Sign Cancellation Request for Policy ${policyNumber}`;

            // Create email body
            const body = `Dear ${insuredName},

Per your request to cancel your ${policyType} policy, please complete the electronic cancellation form.

Policy Details:
‚Ä¢ Policy Number: ${policyNumber}
‚Ä¢ Insurance Company: ${company}
‚Ä¢ Cancellation Date: ${cancelFormatDate(cancelDate)}
‚Ä¢ Cancellation Time: 12:01 AM (Start of Day)
‚Ä¢ Reason: ${reason}

Please click the link below to review and sign your cancellation request:

${cancelCurrentGeneratedUrl}

IMPORTANT: Your coverage will terminate on the date and time shown above. Please ensure you have replacement coverage if needed.

If you have any questions or wish to discuss alternatives, please call us at 336-835-1993.

Thank you,
Bill Layne Insurance Agency
1283 N Bridge St, Elkin NC 28621
Save@BillLayneInsurance.com`;

            // Copy the email content to clipboard
            const emailContent = `To: ${insuredEmail}\nSubject: ${subject}\n\n${body}`;
            navigator.clipboard.writeText(emailContent).then(function() {
                cancelShowCopyStatus('‚úî Email copied! Opening Gmail...');
            }).catch(function(err) {
                // Fallback if clipboard fails
                const textArea = document.createElement('textarea');
                textArea.value = emailContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                cancelShowCopyStatus('‚úî Email copied! Opening Gmail...');
            });

            // Open Gmail compose in new tab
            const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(insuredEmail)}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(gmailUrl, '_blank');
        }

        function cancelCopyTextMessage() {
            const text = document.getElementById('cancelTextMessage').textContent;
            navigator.clipboard.writeText(text).then(function() {
                cancelShowCopyStatus('‚úî Text message copied!');
            }).catch(function(err) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                cancelShowCopyStatus('‚úî Text message copied!');
            });
        }

        function cancelCopyEmailMessage() {
            const email = document.getElementById('cancelEmailMessage').textContent;
            navigator.clipboard.writeText(email).then(function() {
                cancelShowCopyStatus('‚úî Email template copied!');
            }).catch(function(err) {
                const textArea = document.createElement('textarea');
                textArea.value = email;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                cancelShowCopyStatus('‚úî Email template copied!');
            });
        }

        function cancelSendToAgencyMatrix() {
            const phone = document.getElementById('cancelInsuredPhone').value;

            if (!phone) {
                alert('Please enter a phone number to use Agency Matrix');
                document.getElementById('cancelInsuredPhone').focus();
                return;
            }

            const phoneDigits = phone.replace(/\D/g, '');

            if (phoneDigits.length < 10) {
                alert('Please enter a complete 10-digit phone number');
                return;
            }

            const textMessage = document.getElementById('cancelTextMessage').textContent;

            navigator.clipboard.writeText(textMessage).then(function() {
                cancelShowCopyStatus('‚úî Text copied! Opening Agency Matrix - paste the message there');
                setTimeout(() => {
                    const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneDigits}`;
                    window.open(agencyMatrixUrl, '_blank');
                }, 1000);
            }).catch(function(err) {
                alert('Please copy the text message manually, then click OK to open Agency Matrix');
                const agencyMatrixUrl = `https://agents.agencymatrix.com/#/customer/search?selection=Phone&query=${phoneDigits}`;
                window.open(agencyMatrixUrl, '_blank');
            });
        }

        function cancelShowCopyStatus(message = '‚úî Link copied to clipboard!') {
            const status = document.getElementById('cancelCopyStatus');
            status.textContent = message;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function cancelClearForm() {
            if (confirm('Are you sure you want to clear all fields?')) {
                document.getElementById('cancelLinkGenerator').reset();
                document.getElementById('cancelResultSection').style.display = 'none';
                cancelCurrentGeneratedUrl = '';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Set default values
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default for cancellation date
            const today = new Date().toISOString().split('T')[0];
            const cancelDateField = document.getElementById('cancelCancelDate');
            if (cancelDateField) {
                cancelDateField.value = today;
            }

            // Auto-format phone number
            const phoneField = document.getElementById('cancelInsuredPhone');
            if (phoneField) {
                phoneField.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 0) {
                        if (value.length <= 3) {
                            value = '(' + value;
                        } else if (value.length <= 6) {
                            value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
                        } else {
                            value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
                        }
                    }
                    e.target.value = value;
                });
            }
        });
    </script>
  </div>

  <!-- Load external JavaScript -->
  <script src="js/scripts.js"></script>
</body>
</html>